"use strict";(self.webpackChunkn2_trees=self.webpackChunkn2_trees||[]).push([[6442],{21666:(e,t,s)=>{s.d(t,{I:()=>d});var r=s(54099),i=s(81806),n=s(42294),o=s(77859),a=s(80332);class d{constructor(){this._chunks=new Map,this._chunksToRemove=[],this.events=new r.bk,this.featureAdapter=new o.Z}destroy(){this.clear()}clear(){for(const e of this._chunks.values())this._chunksToRemove.push(e);this._chunks.clear(),this._overrides?.clearWeakOverrides()}get usedMemory(){let e=0;for(const t of this._chunks.values())e+=t.usedMemory;return e}async update(e){if(this._overrides){const t=await a.HJ.create(e);this._overrides.update(t)}this._schema=e}*chunks(){this._overrides&&(yield this._overrides.asChunk()),yield*this._chunks.values()}insert(e){(0,i.A)("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] SourceChunkStore.insert`),this._overrides?.onChunkInsert(e),this._chunks.set(e.chunkId,e),this.events.emit("changed")}remove(e){(0,i.A)("esri-2d-update-debug")&&console.debug(`Chunk[${e.chunkId}] SourceChunkStore.remove`),this._chunks.delete(e.chunkId),this._chunksToRemove.push(e)}removeById(e){(0,i.A)("esri-2d-update-debug")&&console.debug(`Chunk[${e}] SourceChunkStore.remove`);const t=this._chunks.get(e);this._chunks.delete(e),t&&this._chunksToRemove.push(t)}cleanup(){const e=this._chunksToRemove;return this._chunksToRemove=[],this._overrides?.cleanup(this._chunks.values()),e}async applyOverride(e){if(null==this._overrides){const e=await a.HJ.create(this._schema);this._overrides=new a.Im(e);for(const t of this._chunks.values())this._overrides.onChunkInsert(t)}this._overrides.apply(e,this),this.events.emit("changed");for(const t of this._chunks.values())t.invalidate()}takeOverrideUpdate(){return this._overrides?.takeOverrideUpdate()}refresh(){this.events.emit("refresh")}forEach(e){const t=new Set;for(const s of this.chunks()){const r=s.reader.getCursor();for(;r.next();){const s=r.getObjectId();t.has(s)||(e(r.copy()),t.add(s))}}}forEachUnsafe(e){const t=new Set;for(const s of this.chunks()){const r=s.reader.getCursor();for(;r.next();){const s=r.getObjectId();t.has(s)||(e(r),t.add(s))}}}mapObjectIdsFromGlobalIds(e,t){const s=new Map,r=new Set(e);return this._overrides?.putWeakObjectIdsFromGlobalIds(s,r,t),this._forEachUnsafeIgnoreOverrides(e=>{const i=e.readAttribute(t);if(i&&r.has(i)&&!s.has(i)){const t=e.getObjectId();s.set(i,t)}}),s}forEachInBounds(e,t){const s=new Set;for(const r of this.chunks()){const i=r.queryFeaturesInBounds(e);for(;i.next();){const e=i.getObjectId();s.has(e)||(t(i.copy()),s.add(e))}}}forEachBounds(e,t){const s=(0,n.vt)();for(const r of e)r.getBounds(s)&&t(s)}_forEachUnsafeIgnoreOverrides(e){const t=new Set;for(const s of this._chunks.values()){const r=s.reader.withoutOverrides().getCursor();for(;r.next();){const s=r.getObjectId();t.has(s)||(e(r),t.add(s))}}}}},27428:(e,t,s)=>{s.d(t,{s:()=>d});s(81806);var r=s(97255),i=s(1484),n=s(25655),o=s(93210);let a;class d extends o.Y{constructor(e,t,s,i,n){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new Uint32Array(s.size());super(e),this._fields=t,this._inner=s,this._chunkId=i,this._fileIndex=n,this._displayIds=o,this._index=-1,this.usedMemory=r.qK,this._size=this._inner.size(),e.featureIdInfo.type,this._chunkId>65535&&console.error("Exceeded max allowed parquet reader size")}destroy(){super.destroy(),this._inner.free()}get fields(){return this._fields}get geometryType(){return this.metadata.geometryType}get hasFeatures(){return!0}get hasNext(){throw new Error("Method not implemented.")}get exceededTransferLimit(){return!1}get hasZ(){return!1}get hasM(){return!1}getInTransform(){return null}getSize(){return this._size}getCursor(){return this.copy()}getAttributeHash(){let e="";for(const t of this.fields.fields)e+=this._readAttribute(t.name,!1)+".";return e}getObjectId(){return this._fileIndex<<24|this._inner.rowId(this._index)}getDisplayId(){return this._displayIds[this._index]}setDisplayId(e){this._displayIds[this._index]=e}setIndex(e){this._index=e}getBoundsXMin(){return this._inner.boundsXMin(this._index)}getBoundsYMin(){return this._inner.boundsYMin(this._index)}getBoundsXMax(){return this._inner.boundsXMax(this._index)}getBoundsYMax(){return this._inner.boundsYMax(this._index)}setBoundsXMin(e){throw new Error("InternalError: Setting bounds is unsupported")}setBoundsYMin(e){throw new Error("InternalError: Setting bounds is unsupported")}setBoundsXMax(e){throw new Error("InternalError: Setting bounds is unsupported")}setBoundsYMax(e){throw new Error("InternalError: Setting bounds is unsupported")}getIndex(){return this._index}next(){for(;++this._index<this._size&&!this._getExists(););return this._index<this._size}readGeometryArea(){return this.readGeometryForDisplay()?.area()??0}copy(){const e=new d(this.metadata,this._fields,this._inner,this._chunkId,this._fileIndex,this._displayIds);return this.copyInto(e),e}copyInto(e){super.copyInto(e),e._index=this._index}readGeometryForDisplayTransformed(e){const[t,s]=e.translate,[r,o]=e.scale;return a||(a=n.QuantizedGeometryBuffer.new()),this._inner.transformGeometry(a,t,s,r,o,this._index)?new i.A(a.readLengthsUnsafe(),a.readCoordsUnsafe()):null}_readGeometry(e){const t=this._inner.readCoords(this._index),s=this._inner.readLengths(this._index);return t&&s?new i.A(s,t):null}_readX(){return this._inner.readX(this._index)}_readY(){return this._inner.readY(this._index)}_readServerCentroid(){return null}_readAttribute(e,t){const s=this.fields.get(e);if(!s)return;if(null==s.column)return this.getObjectId();const r=this._inner.readAttribute(this._index,s.column);if(null==r)return r;const i=this.fields.isDateField(s.name);return t?null==r?r:i?new Date(r):r:r}_readAttributes(){const e={};for(const t of this._fields.fields)null!=t.column&&(this._inner.isEmpty(t.column)||(e[t.name]=this._readAttribute(t.name,!1)));return e.__OBJECTID=this.getObjectId(),e}}},30248:(e,t,s)=>{s.d(t,{e:()=>a});var r=s(97255),i=s(76279),n=s(98618),o=s(93210);class a extends o.Y{static from(e,t){if(e instanceof this){const s=new Set(t),r=e._indices.filter(e=>s.has(e));return new a(e._reader,r)}return new a(e.copy(),t)}constructor(e,t){super(e.metadata),this._currentIndex=-1,this._displayTransform=null,this._reader=e,this._indices=t}setTransformForDisplay(e){const t=this._reader.getInTransform();if(null==t)return void(this._displayTransform=(0,i.Q1)(e));const s=(0,i.Q1)(t),r=(0,i.Q1)(e),[n,o]=s.scale,[a,d]=s.translate,[h,u]=r.scale,[l,c]=r.translate,_=n/h,p=o/u,f=(a-l)/h,g=(d-c)/u;this._displayTransform={originPosition:"lowerLeft",scale:[1/_,1/p,1,1],translate:[-f/_,-g/p,0,0]}}getInTransform(){return this._reader.getInTransform()}get fields(){return this._reader.fields}get hasNext(){return this._currentIndex+1<this._indices.length}getSize(){return this._indices.length}getCursor(){return this.copy()}copy(){const e=new a(this._reader.copy(),this._indices);return e._currentIndex=this._currentIndex,e._displayTransform=this._displayTransform,e._processorAttributes=this._processorAttributes,e}get contextTimeZone(){return this._reader.contextTimeZone}set contextTimeZone(e){this._reader.contextTimeZone=e}get usedMemory(){return r.qK+this._reader.usedMemory}setProcessorAttributes(e){this._processorAttributes=Object.assign(this._processorAttributes??{},e)}_nextIndex(){return++this._currentIndex<this._indices.length&&(this._reader.setIndex(this._indices[this._currentIndex]),!0)}next(){for(;this._nextIndex()&&!this._reader._getExists(););return this._currentIndex<this._indices.length}readXForDisplay(){return this._displayTransform?(0,i.IE)(this._displayTransform,this._reader.readXForDisplay()):this._reader.readXForDisplay()}readYForDisplay(){return this._displayTransform?(0,i.B2)(this._displayTransform,this._reader.readYForDisplay()):this._reader.readYForDisplay()}readGeometryForDisplay(){return this._displayTransform?this._reader.readGeometryForDisplayTransformed(this._displayTransform):this._reader.readGeometryForDisplay()}readCentroidForDisplay(){const e=this._reader.readCentroidForDisplay()?.clone();if(e){const[t,s]=e.coords;this._displayTransform?(e.coords[0]=(0,i.IE)(this._displayTransform,t),e.coords[1]=(0,i.B2)(this._displayTransform,s)):(e.coords[0]=t,e.coords[1]=s)}return e}get geometryType(){return this._reader.geometryType}get hasFeatures(){return this._reader.hasFeatures}get exceededTransferLimit(){return this._reader.exceededTransferLimit}get hasZ(){return this._reader.hasZ}get hasM(){return this._reader.hasM}readAttribute(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=this._reader.readAttribute(e,t);return null==s&&this._processorAttributes?this._processorAttributes[e]:s}readAttributes(){return{...this._processorAttributes,...this._reader.readAttributes()}}joinAttributes(e){return this._reader.joinAttributes(e)}getBounds(e){return this._reader.getBounds(e)}getAttributeHash(){return this._reader.getAttributeHash()}getObjectId(){return this._reader.getObjectId()}getDisplayId(){return this._reader.getDisplayId()}setDisplayId(e){return this._reader.setDisplayId(e)}setIndex(e){return this._reader.setIndex(e)}getIndex(){return this._reader.getIndex()}readXWorldSpace(){return this._reader.readXWorldSpace()}readYWorldSpace(){return this._reader.readYWorldSpace()}_readX(){return this._reader.readXForDisplay()}_readY(){return this._reader.readYForDisplay()}_readServerCentroid(){return this._reader._readServerCentroid()}readLegacyFeatureForDisplay(){const e=this.readCentroidForDisplay();return{attributes:this.readAttributes(),geometry:this.readLegacyGeometryForDisplay(),centroid:(e&&{x:e.coords[0],y:e.coords[1]})??null}}readLegacyGeometryForDisplay(){const e=this.readGeometryForDisplay();return(0,n.zv)(e,this.geometryType,!1,!1)}readGeometryArea(){return this._displayTransform?this._reader.readGeometryForDisplayTransformed(this._displayTransform)?.area()??0:this._reader.readGeometryArea()}readGeometryWorldSpace(){return this._reader.readGeometryWorldSpace()}_readGeometry(){return this._reader._readGeometry()}_readAttribute(e,t){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}_readAttributes(){throw new Error("Error: Should not be called. Underlying _reader should be used instead")}readArcadeFeature(){return this._reader.readArcadeFeature()}geometry(){return this._reader.geometry()}field(e){return this._reader.field(e)}hasField(e){return this._reader.hasField(e)}setField(e,t){return this._reader.setField(e,t)}keys(){return this._reader.keys()}castToText(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this._reader.castToText(e)}}},35495:(e,t,s)=>{s.d(t,{o:()=>o});var r=s(97255),i=s(58817);const n=Math.PI/180;class o{static create(e){return new o(e.map(e=>function(e){switch(e.statisticType){case"min":return new d(e);case"max":return new h(e);case"avg":return new l(e);case"avg_angle":return new c(e);case"sum":case"count":return new u(e);case"mode":return new _(e)}}(e)))}constructor(e){this._statistics=e}static get estimatedMemory(){return r.qK+4*r.qK}values(){return this._statistics.values()}insert(e,t){for(const s of this._statistics)s.insert(e,t)}merge(e){for(let t=0;t<this._statistics.length;t++){const s=this._statistics[t],r=e._statistics[t];if(s.field.name!==r.field.name)throw new Error("InternalError: Tried to merge incompatible statistics");s.merge(r)}}clone(){return new o(this._statistics.map(e=>e.clone()))}}class a{constructor(e){this.field=e}insert(e,t){if(!this.field.computed)return;const s=this.field.computed.read(e,t);(0,i.rZ)(s)||this._insertValue(s)}}class d extends a{constructor(){super(...arguments),this.type="min",this.value=Number.MAX_VALUE}_insertValue(e){this.value=Math.min(this.value,e)}merge(e){this.value=Math.min(this.value,e.value)}clone(){const e=new d(this.field);return e.value=this.value,e}}class h extends a{constructor(){super(...arguments),this.type="max",this.value=Number.MIN_VALUE}_insertValue(e){this.value=Math.max(this.value,e)}merge(e){this.value=Math.max(this.value,e.value)}clone(){const e=new h(this.field);return e.value=this.value,e}}class u extends a{constructor(){super(...arguments),this.type="sum",this.value=0}_insertValue(e){this.value+=e}merge(e){this.value+=e.value}clone(){const e=new u(this.field);return e.value=this.value,e}}class l extends a{constructor(){super(...arguments),this.type="avg",this._total=0,this._count=0}get value(){return this._total/this._count}_insertValue(e){this._total+=e,this._count+=1}merge(e){this._total+=e._total,this._count+=e._count}clone(){const e=new l(this.field);return e._total=this._total,e._count=this._count,e}}class c extends a{constructor(){super(...arguments),this.type="avg_angle",this._x=0,this._y=0,this._count=0}get value(){const e=this._x/this._count,t=this._y/this._count,s=180/Math.PI;return Math.atan2(t,e)*s}_insertValue(e){this._x=this._x+Math.cos(e*n),this._y=this._y+Math.sin(e*n),this._count+=1}merge(e){this._x+=e._x,this._y+=e._y,this._count+=e._count}clone(){const e=new c(this.field);return e._x=this._x,e._y=this._y,e._count=this._count,e}}class _ extends a{constructor(){super(...arguments),this._frequencies=new Map}get value(){let e,t=0;for(const[s,r]of this._frequencies.entries())r>t&&(t=r,e=s);return e}_insertValue(e){const t=this._frequencies.get(e);null!=t?this._frequencies.set(e,t+1):this._frequencies.set(e,1)}merge(e){for(const[t,s]of e._frequencies.entries()){const e=this._frequencies.get(t);null!=e?this._frequencies.set(t,e+s):this._frequencies.set(t,s)}}clone(){const e=new _(this.field);return e._frequencies=new Map(this._frequencies),e}}},36794:(e,t,s)=>{s.d(t,{B:()=>r});class r{constructor(e){this._statistics=e}get statistics(){return this._statistics}}},40296:(e,t,s)=>{s.d(t,{F0:()=>a,Vx:()=>u,e2:()=>c,f:()=>_});var r=s(81806),i=s(53084),n=s(8298),o=s(44460);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.Cb:"esriGeometryPolyline"===e?o.yM:o.WR}}}const d=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let h=1;function u(e,t){if((0,r.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let s=`this${l(t)} = null;`;for(const t in e)s+=`this${l(t)} = ${JSON.stringify(e[t])};`;const r=new Function(`\n      return class AttributesClass$${h++} {\n        constructor() {\n          ${s};\n        }\n      }\n    `)();return()=>new r}catch(s){return()=>({[t]:null,...e})}}function l(e){return d.test(e)?`.${e}`:`["${e}"]`}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,i.o8)(e)}}]}function _(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:n.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:n.P,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},51681:(e,t,s)=>{s.d(t,{K:()=>M});var r=s(97255),i=s(15863),n=s(42294);class o{static fromReader(e){const t=[],s=e.copy(),r=(0,n.vt)();for(;s.next();)s.getBounds(r)&&t.push(s.getIndex());const a=(0,i.r)(9,e=>(s.setIndex(e),{minX:s.getBoundsXMin(),minY:s.getBoundsYMin(),maxX:s.getBoundsXMax(),maxY:s.getBoundsYMax()}));return a.load(t),new o(a,t.length)}constructor(e,t){this._index=e,this._size=t}get usedMemory(){return this._size*r.RS}search(e){const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}s(81806);var a=s(15941),d=(s(19555),s(72745)),h=s(65215),u=s(13312),l=s(2413),c=s(14556),_=s(98618),p=s(1484),f=s(24586);(0,d.vt)(),(0,d.vt)();function g(e,t,s,r){if(r.isWebMercator){const r=(0,a.KJ)(e/c.$O.radius),i=r-360*Math.floor((r+180)/360),n=[0,0];return m(n,0,(0,a.KJ)(Math.PI/2-2*Math.atan(Math.exp(-t/c.$O.radius))),i,s),n}const i=(0,f.Cv)({x:e,y:t},r,u.A.WGS84);if(!i)return null;const n=[0,0];return m(n,0,i.y,i.x,s),n}function m(e,t,s,r,i){i%2&&(i+=1);let n=0,o=0,a=-90,d=90,h=-180,u=180;for(let l=0;l<i/2;l++){for(let e=0;e<5;e++){const t=(h+u)/2,s=r>t?1:0;n|=s<<29-(e+5*l),h=(1-s)*h+s*t,u=(1-s)*t+s*u}for(let e=0;e<5;e++){const t=(a+d)/2,r=s>t?1:0;o|=r<<29-(e+5*l),a=(1-r)*a+r*t,d=(1-r)*t+r*d}}e[2*t]=n,e[2*t+1]=o}var y=s(36794),x=s(35495);class v extends y.B{static create(e,t,s,r){const i=x.o.create(e),n=new Array(32);for(let o=0;o<n.length;o++)n[o]=null;return new v(i,t,s,r,n)}constructor(e,t,s,r,i){super(e),this.xNode=t,this.yNode=s,this.depth=r,this.children=i,this._objectIds=new Set,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._xGeohashTotal=0,this._yGeohashTotal=0,this.next=null}static get estimatedMemory(){let e=0;return e+=2*r.qK,e+=32*r.RS,e+=x.o.estimatedMemory,e}get id(){return`${this.xNode}.${this.yNode}`}get containedObjectIds(){return this._objectIds}get count(){return this._count}clone(){const e=new v(this._statistics.clone(),this.xNode,this.yNode,this.depth,this.children);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._xGeohashTotal=this._xGeohashTotal,e._yGeohashTotal=this._yGeohashTotal,e.next=this.next,e._objectIds=new Set(this._objectIds),e}insert(e,t,s,r,i,n){this._count+=1,this._xWorldTotal+=t,this._yWorldTotal+=s,this._xGeohashTotal+=r,this._yGeohashTotal+=i,this._statistics.insert(e,n),this._objectIds.add(e.getObjectId())}merge(e){if(0!==e._count){this._count+=e._count,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._xGeohashTotal+=e._xWorldTotal,this._yGeohashTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);for(const t of e._objectIds.values())this._objectIds.add(t)}}getCentroid(e){throw new Error("getCentroid not supported for GeohashNode")}getGeometry(e,t){const s=this._getLngLatBounds(),[r,i,n,o]=s,a=(0,f.Cv)({rings:[[[r,i],[r,o],[n,o],[n,i],[r,i]]]},u.A.WGS84,e),d=(0,_.Ye)(new p.A,a,!1,!1);return null!=t?(0,_.Nl)(new p.A,d,!1,!1,"esriGeometryPolygon",t,!1,!1):d}getGeometricCentroid(e,t){const s=this._getLngLatBounds(),[r,i,n,o]=s,a=(0,f.Cv)({x:(r+n)/2,y:(i+o)/2},u.A.WGS84,e),d=(0,_.qN)(new p.A,a);return null!=t?(0,_.Nl)(new p.A,d,!1,!1,"esriGeometryPoint",t,!1,!1):d}getAttributes(){const e={aggregateId:this.id};for(const t of this._statistics.values())e[t.field.name]=t.value;return e.aggregateCount=this._count,e}find(e,t,s,r,i,n){if(r>=s)return this;const o=1-r%2,a=3*o+2*(1-o),d=2*o+3*(1-o),h=30-i-a,u=30-n-d,l=((e&7*o+3*(1-o)<<h)>>h)+((t&3*o+7*(1-o)<<u)>>u)*(8*o+4*(1-o)),c=this.children[l];return null==c?null:c.find(e,t,s,r+1,i+a,n+d)}_getLngLatBounds(){const e=this.depth,t=Math.ceil(e/2),s=Math.floor(e/2),r=30-(3*t+2*s),i=30-(2*t+3*s);return function(e,t){let s=-90,r=90,i=-180,n=180;for(let o=0;o<t;o++){const t=Math.ceil((o+1)/2),a=Math.floor((o+1)/2),d=1-o%2,h=30-(3*t+2*a),u=30-(2*t+3*a),l=3*d+2*(1-d),c=2*d+3*(1-d),_=3*d+7*(1-d)<<u,p=(7*d+3*(1-d)<<h&e.geohashX)>>h,f=(_&e.geohashY)>>u;for(let e=l-1;e>=0;e--){const t=(i+n)/2,s=p&1<<e?1:0;i=(1-s)*i+s*t,n=(1-s)*t+s*n}for(let e=c-1;e>=0;e--){const t=(s+r)/2,i=f&1<<e?1:0;s=(1-i)*s+i*t,r=(1-i)*t+i*r}}return[i,s,n,r]}({geohashX:this.xNode<<r,geohashY:this.yNode<<i},this.depth)}}class I{constructor(e){this._fields=e,this._size=0,this._depth=0,this._root=v.create(this._fields,0,0,0)}destroy(){}get size(){return this._size}get depth(){return this._depth}get usedMemory(){return this._size*v.estimatedMemory}find(e,t,s){return this._root.find(e,t,s,0,0,0)}insert(e,t,s,r,i,n,o){let a=this._root,d=0,h=0,u=0;for(;null!==a;){if(a.insert(e,t,s,r,i,o),d>=n)return;const l=Math.ceil((d+1)/2),c=Math.floor((d+1)/2),_=1-d%2,p=30-(3*l+2*c),f=30-(2*l+3*c),g=(r&7*_+3*(1-_)<<p)>>p,m=(i&3*_+7*(1-_)<<f)>>f,y=g+m*(8*_+4*(1-_));h=h<<3*_+2*(1-_)|g,u=u<<2*_+3*(1-_)|m,null==a.children[y]&&(a.children[y]=v.create(this._fields,h,u,d+1),this._depth=Math.max(this._depth,d+1),this._size+=1),d+=1,a=a.children[y]}}putBins(e,t){for(const s of this.getNodes(t)){const t=e.get(s.id);t?t.merge(s):e.set(s.id,s.clone())}}getNodes(e){const t=[],{geohashBounds:s,level:r}=e;let i=this._root;for(;null!==i;){const e=i.depth,n=i.xNode,o=i.yNode;if(e>=r){t.push(i),i=i.next;continue}const a=Math.ceil((e+1)/2),d=Math.floor((e+1)/2),h=1-e%2,u=30-(3*a+2*d),l=30-(2*a+3*d),c=~((1<<u)-1),_=~((1<<l)-1),p=(s.xLL&c)>>u,f=(s.yLL&_)>>l,g=(s.xTR&c)>>u,m=(s.yTR&_)>>l,y=n<<3*h+2*(1-h),x=o<<2*h+3*(1-h),v=y+8*h+4*(1-h),I=x+4*h+8*(1-h),b=Math.max(y,p),w=Math.max(x,f),T=Math.min(v,g),k=Math.min(I,m);let M=null,W=null;for(let t=w;t<=k;t++)for(let e=b;e<=T;e++){const s=e-y+(t-x)*(8*h+4*(1-h)),r=i.children[s];r&&(M||(M=r,M.next=i.next),W&&(W.next=r),W=r,r.next=i.next)}i=M||i.next}return t}}var b=s(77350);class w extends b.n{constructor(e){super(e),this._tree=new I(this._options.fields)}get usedMemory(){return this._tree.usedMemory}put(e){throw new Error("Geohash tree does not support put")}putBounded(e,t,s){const{geohashLevel:r,spatialReference:i}=this._options,n=function(e,t,s,r){const i=[e.xmin,e.ymin,e.xmax,e.ymax],n=h.A.fromExtent((0,l.w1)(i,r)),o=(0,f.Cv)(n,r,u.A.WGS84,{extendedParams:{densificationStep:64*t}});if(!o)return null;const a=(0,_.Ye)(new p.A,o,!1,!1),d=a.coords.filter((e,t)=>!(t%2)),c=a.coords.filter((e,t)=>t%2),m=Math.min(...d),y=Math.min(...c),x=Math.max(...d),v=Math.max(...c),I=g(m,y,s,u.A.WGS84),b=g(x,v,s,u.A.WGS84);return I&&b?{bounds:i,geohashBounds:{xLL:I[0],yLL:I[1],xTR:b[0],yTR:b[1]},level:s}:null}(t,s,r,i);null!=n&&this._tree.putBins(e,n)}_insert(e,t,s,r){const{geohashLevel:i,spatialReference:n}=this._options,o=g(t,s,i,n);o&&this._tree.insert(e,t,s,o[0],o[1],i,r)}}var T=s(91996),k=s(30248);class M{size(){return this.reader.getSize()}get fields(){return this.reader.fields}invalidate(){this._aggregateIndex=null,this._aggregateIndexHash=null,this._spatialIndex=null}get usedMemory(){let e=0;return e+=this.reader.underlyingMemory,this._aggregateIndex&&(e+=this._aggregateIndex.usedMemory),this._spatialIndex&&(e+=this._spatialIndex.usedMemory),e}registerOverrides(e){this.reader.registerOverrides(e),this.invalidate()}queryFeaturesInBounds(e){const t=this._getSpatialIndex().search(e);return k.e.from(this.reader,t)}getAggregateIndex(e){const t=JSON.stringify(e);if(t!==this._aggregateIndexHash){switch(this._aggregateIndexHash=t,e.type){case"grid":this._aggregateIndex=new T.H(e);break;case"geohash":this._aggregateIndex=new w(e)}this._aggregateIndex.insert(this.reader,this.isTiled)}return this._aggregateIndex}_getSpatialIndex(){return this._spatialIndex||(this._spatialIndex=o.fromReader(this.reader)),this._spatialIndex}}},61137:(e,t,s)=>{s.d(t,{j:()=>i});var r=s(51681);class i extends r.K{constructor(e,t,s,r){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;super(),this._reader=e,this._queryJSON=t,this._page=s,this._end=r,this._fileIndex=i,this.chunkId=`${this._fileIndex}.${this._page}${this.end?"e":""}`,this.normalizedChunkId=this.chunkId}get reader(){return this._reader}get first(){return 0===this._page}get end(){return this._end}get queryInfo(){return{type:"snapshot",chunkId:this.chunkId,queryJSON:this._queryJSON,page:this._page,size:this.size(),end:this.end}}get isTiled(){return!1}getTileReader(e){const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}},62812:(e,t,s)=>{s.d(t,{L:()=>a});var r=s(98618),i=s(1484),n=s(36794),o=s(35495);class a extends n.B{static createId(e,t){return`${e}.${t}`}static create(e,t,s,r){return new a(e,t,o.o.create(s),r)}constructor(e,t,s,r){super(s),this.gridX=e,this.gridY=t,this._worldUnitsPerCell=r,this._count=0,this._xWorldTotal=0,this._yWorldTotal=0,this._objectIds=new Set}get id(){return a.createId(this.gridX,this.gridY)}get containedObjectIds(){return this._objectIds}get count(){return this._count}get firstObjectId(){return this._objectIds.values().next().value}get centroidXWorld(){return this._xWorldTotal/this._count}get centroidYWorld(){return this._yWorldTotal/this._count}get usedMemory(){return 48}clone(){const e=new a(this.gridX,this.gridY,this._statistics.clone(),this._worldUnitsPerCell);return e._count=this._count,e._xWorldTotal=this._xWorldTotal,e._yWorldTotal=this._yWorldTotal,e._firstFeatureAttributes=this._firstFeatureAttributes,e._objectIds=new Set(this._objectIds),e}insert(e,t,s,r){0===this._count?this._firstFeatureAttributes=e.readAttributes():this._firstFeatureAttributes=null,this._count+=1,this._xWorldTotal+=s,this._yWorldTotal+=r,this._statistics.insert(e,t),this._objectIds.add(e.getObjectId())}merge(e){if(0!==e._count){this._count+=e._count,this._firstFeatureAttributes=e._firstFeatureAttributes,this._xWorldTotal+=e._xWorldTotal,this._yWorldTotal+=e._yWorldTotal,this._statistics.merge(e._statistics);for(const t of e._objectIds.values())this._objectIds.add(t)}}getCentroidX(e){return null==e?this.centroidXWorld:(0,r.IE)(e,this.centroidXWorld)}getCentroidY(e){return null==e?this.centroidYWorld:(0,r.B2)(e,this.centroidYWorld)}getGeometry(e,t){const s=this.gridX*this._worldUnitsPerCell,n=this.gridY*this._worldUnitsPerCell,o=new i.A([4],[s,n,s+this._worldUnitsPerCell,n,s+this._worldUnitsPerCell,n+this._worldUnitsPerCell,s,n+this._worldUnitsPerCell]);if(null!=t){const e=new i.A;return(0,r.Nl)(e,o,!1,!1,"esriGeometryPolygon",t)}return o}getCentroid(e){const t=new i.A([],[this.centroidXWorld,this.centroidYWorld]);if(null!=e){const s=new i.A;return(0,r.Nl)(s,t,!1,!1,"esriGeometryPoint",e)}return t}getGeometricCentroid(e,t){const s=this.gridX*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,n=this.gridY*this._worldUnitsPerCell+.5*this._worldUnitsPerCell,o=new i.A([],[s,n]);if(null!=t){const e=new i.A;return(0,r.Nl)(e,o,!1,!1,"esriGeometryPoint",t)}return o}getAttributes(){const e={aggregateId:this.id};for(const t of this._statistics.values())e[t.field.name]=t.value;return null!=this._firstFeatureAttributes?{...e,...this._firstFeatureAttributes}:e}}},77350:(e,t,s)=>{s.d(t,{n:()=>n});var r=s(5095),i=s(66422);class n{constructor(e){this._options=e}insert(e,t){const s=e.getCursor(),{arcadeContextInfo:r,scale:n}=this._options,o=(0,i.N)(n,r);for(;s.next();)this._insertFeature(s,o,this._options.sqlOptions,t)}_insertFeature(e,t,s,i){const{featureFilter:n}=this._options;if(null!==n&&!n.check(e,s))return;let o=0,a=0;if("esriGeometryPoint"===e.geometryType)o=e.readXWorldSpace(),a=e.readYWorldSpace();else{if(i){const t=e.readCentroidForDisplay();if(null==t)return;const[s,i]=t.coords;if(s<0||s>r.CQ||i<0||i>r.CQ)return}const t=e.readCentroidWorldSpace();if(null==t)return;o=t.coords[0],a=t.coords[1]}this._insert(e,o,a,t)}}},80332:(e,t,s)=>{s.d(t,{HJ:()=>o,Im:()=>u,KN:()=>d});var r=s(34154),i=s(51681),n=s(88284);class o{static async create(e){const{metadata:t,definitionExpression:s}=e,i=s?await(0,r.GP)(s,t.fieldsIndex):null;return new o(t,i,s)}constructor(e,t,s){this.metadata=e,this._clause=t,this._definitionExpression=s}get hash(){return this._definitionExpression}testFeature(e){return null==this._clause||this._clause.testFeature(e)}}class a{constructor(){this.modified=new Map,this.removed=new Set}modify(e){this.modified.set(e.objectId,e),this.removed.has(e.objectId)&&this.removed.delete(e.objectId)}remove(e){this.modified.delete(e),this.removed.add(e)}get isEmpty(){return 0===this.modified.size&&0===this.removed.size}applyWhereClause(e){const t=new a;for(const[s,r]of this.modified)e.testFeature(r)?t.modified.set(s,r):t.removed.add(r.objectId);for(const s of this.removed)t.removed.add(s);return t}}class d extends i.K{constructor(e){super(),this._reader=e,this.chunkId="override",this.normalizedChunkId="override"}static fromFeatures(e,t){const s=n.K.fromOptimizedFeatures(e,t);return new d(s)}get reader(){return this._reader}get queryInfo(){return{}}get first(){return!1}get end(){return!1}get isTiled(){return!1}getTileReader(e){if(!this._reader.getSize())return null;const t=this.queryFeaturesInBounds(e.bounds);return t.setTransformForDisplay(e.transform),t}}class h{constructor(e,t){this.inner=e,this.isWeak=t,this.lastWeak=null}get isStrong(){return!this.isWeak}}class u{constructor(e){this._parameters=e,this._overrides=new Map,this._update=new a,this._lastCleanup=0}update(e){this._parameters=e}hasOverride(e){return this._overrides.has(e)}onChunkInsert(e){if(this._overrides.size){const t=e.reader.getCursor();for(;t.next();){const e=t.getObjectId(),s=this._overrides.get(e);if(s?.lastWeak&&(s.lastWeak=null),s?.isWeak){const e=t.readOptimizedFeatureWorldSpace(),r=s.inner?.attributes??{};e.attributes={...r,...e.attributes},s.inner=e,this._update.modify(e),this.invalidate()}}}e.registerOverrides(this)}apply(e,t){const{updateWeak:s,removeWeak:r,update:i,remove:n,release:o}=e.commands;this.invalidate();for(const a of s){const e=new h(a,!0),t=this._overrides.get(a.objectId);t?.isStrong?t.lastWeak=e:(this._overrides.set(a.objectId,e),this._update.modify(a))}for(const a of i){const e=new h(a,!1),t=this._overrides.get(a.objectId);e.lastWeak=t?.isWeak?t:t?.lastWeak??null,this._overrides.set(a.objectId,e),this._update.modify(a)}for(const a of r){const e=new h(null,!0),t=this._overrides.get(a);t?.isStrong?t.lastWeak=e:(this._overrides.set(a,e),this._update.remove(a))}for(const a of n){const e=new h(null,!1),t=this._overrides.get(a);e.lastWeak=t?.isWeak?t:t?.lastWeak??null,this._overrides.set(a,e),this._update.remove(a)}if(o.length){const e=new Set;for(const t of o){const s=this._overrides.get(t);s?.lastWeak?(this._overrides.set(t,s.lastWeak),null==s.lastWeak.inner?this._update.remove(t):this._update.modify(s.lastWeak.inner)):s&&!s.isWeak&&(this._overrides.delete(t),e.add(t))}t.forEachUnsafe(t=>{const s=t.getObjectId();e.has(s)&&(this._update.modify(t.readOptimizedFeatureWorldSpace()),e.delete(s))});for(const t of e.values())this._update.remove(t)}}clearWeakOverrides(){for(const[e,t]of this._overrides.entries())t.isWeak&&this._overrides.delete(e);this.invalidate()}cleanup(e){if(this._overrides.size<1e4)return;const t=performance.now();if(t-this._lastCleanup<1e3)return;this._lastCleanup=t;const s=this._getWeakDeletions();if(!(s.size<1e4)){for(const t of e){const e=t.reader.withoutOverrides().getCursor();for(;e.next();){const t=e.getObjectId();s.delete(t)}}for(const e of s)this._overrides.delete(e);s.size&&this.invalidate()}}takeOverrideUpdate(){const e=this._update;return e.isEmpty?null:(this._update=new a,e.applyWhereClause(this._parameters))}asChunk(){const e=this._parameters;if(this._lastOverrideParametersHash!==e.hash&&(this._lastOverrideParametersHash=e.hash,this._chunk=null),!this._chunk){const t=[];for(const s of this._overrides.values())null!=s.inner&&e.testFeature(s.inner)&&t.push(s.inner);this._chunk=d.fromFeatures(t,e.metadata)}return this._chunk}invalidate(){this._chunk=null}putWeakObjectIdsFromGlobalIds(e,t,s){for(const[r,i]of this._overrides.entries()){if(i.isWeak&&null!=i.inner){const n=i.inner.attributes[s];n&&t.has(n)&&!e.has(n)&&e.set(n,r);continue}if(null!=i.lastWeak&&null!=i.lastWeak.inner){const n=i.lastWeak.inner.attributes[s];n&&t.has(n)&&!e.has(n)&&e.set(n,r)}}}_getWeakDeletions(){const e=new Set;for(const[t,s]of this._overrides.entries())s.isWeak&&null==s.inner&&e.add(t);return e}}},91996:(e,t,s)=>{s.d(t,{H:()=>h,p:()=>d});var r=s(97255),i=s(31633),n=s(77350),o=s(62812);const a=96;function d(e,t){return(0,i.GA)(e)*i.dy*a/t}class h extends n.n{constructor(e){super(e),this._cells=new Map,this._pixelsPerMapUnit=d(e.spatialReference,e.scale)}get usedMemory(){const e=this._cells.values().next().value;return e?(r.RS+e.usedMemory)*this._cells.size:0}put(e){for(const t of this._cells.values()){const s=e.get(t.id);s?s.merge(t):e.set(t.id,t.clone())}}putBounded(e,t,s){const r=[t.xmin,t.ymin,t.xmax,t.ymax],[i,n,o,a]=r,d=Math.floor(i*this._pixelsPerMapUnit/this._options.cellSize),h=Math.floor(n*this._pixelsPerMapUnit/this._options.cellSize),u=Math.ceil(o*this._pixelsPerMapUnit/this._options.cellSize),l=Math.ceil(a*this._pixelsPerMapUnit/this._options.cellSize);for(let c=h;c<=l;c++)for(let t=d;t<=u;t++){const s=`${t}.${c}`,r=this._cells.get(s);if(!r)continue;const i=e.get(r.id);i?r&&!e.has(r.id)&&i.merge(r):e.set(r.id,r.clone())}}_insert(e,t,s,r){const i=t*this._pixelsPerMapUnit,n=s*this._pixelsPerMapUnit,o=Math.floor(i/this._options.cellSize),a=Math.floor(n/this._options.cellSize);this._getCellOrCreate(o,a).insert(e,r,t,s)}_getCellOrCreate(e,t){const s=o.L.createId(e,t);let r=this._cells.get(s);if(!r){const i=1*this._options.cellSize/this._pixelsPerMapUnit;r=o.L.create(e,t,this._options.fields,i),this._cells.set(s,r)}return r}}}}]);
//# sourceMappingURL=6442.40a0b998.chunk.js.map