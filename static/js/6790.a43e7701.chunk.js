"use strict";(self.webpackChunkn2_trees=self.webpackChunkn2_trees||[]).push([[6790],{12482:(e,t,o)=>{o.d(t,{$7:()=>E,B:()=>R,Fo:()=>w,M7:()=>T,Q5:()=>S,Tq:()=>P,Up:()=>b,XF:()=>I,Ze:()=>v,bK:()=>l,bh:()=>h,id:()=>A,ky:()=>d,qt:()=>k,tW:()=>M,v9:()=>f,w7:()=>u,wF:()=>a,wS:()=>x,x:()=>p,xS:()=>_,ze:()=>c});var n=o(56002),r=o(31633),i=o(81478);function s(e){return e?k:P}function a(e,t){return t?.mode?t.mode:s(e).mode}function l(e,t){return null!=t?t:s(e)}function u(e,t){return a(null==e||(e.hasZ??!1),t)}function c(e,t){return l(null==e||(e.hasZ??!1),t)}function d(e){const t=m(e);return u(e.geometry,t)}function h(e){const t=m(e),o=u(e.geometry,t),n=null!=t&&"on-the-ground"!==o?T(t):0,r=t?.featureExpressionInfo;return{mode:o,offset:n,featureExpressionInfo:r}}function f(e){return g(e)||p(e)}function p(e){return"0"===e?.featureExpressionInfo?.expression}function g(e){if(!e)return!1;if("on-the-ground"===e.mode)return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||"0"===t)}function m(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}const y=(0,n.B)((e,t,o)=>{if(!e)return 0;if("decimal-degrees"===t)return 0;const n="unknown"!==t&&t?t:"meters",i=(0,r.mq)(o);return i?(0,r.oU)(e,n,i):0});function v(e,t){return y(e?.offset,e?.unit,t)}function A(e,t,o){if(!o?.mode)return;const n=e.hasZ?e.z:0,r=v(o,e.spatialReference);switch(o.mode){case"absolute-height":return n-r;case"on-the-ground":return 0;case"relative-to-ground":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"ground")??0)+r);case"relative-to-scene":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"scene")??0)+r)}}function x(e,t,o){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return w(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,o,n)}function _(e,t,o,n){let r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return w(e,t[0],t[1],t.length>2?t[2]:0,o,n,r)}function w(e,t,o,n,r,i){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;if(null==i)return;const a=null!=s?s.mode:"absolute-height";if("on-the-ground"===a)return 0;const{absoluteZ:l}=S(t,o,n,r,e,i);return function(e,t,o,n,r,i,s,a){const l=v(s,r);switch(a){case"absolute-height":return e-l;case"relative-to-ground":return e-((i.elevationProvider.getElevation(t,o,n,r,"ground")??0)+l);case"relative-to-scene":return e-((i.elevationProvider.getElevation(t,o,n,r,"scene")??0)+l)}}(l,t,o,n,r,e,s,a)}function S(e,t,o,n,r,i){const s=v(i,n);switch(i.mode){case"absolute-height":return{absoluteZ:o+s,elevation:0};case"on-the-ground":{const o=r.elevationProvider.getElevation(e,t,0,n,"ground")??0;return{absoluteZ:o,elevation:o}}case"relative-to-ground":{const i=r.elevationProvider.getElevation(e,t,o,n,"ground")??0;return{absoluteZ:o+i+s,elevation:i}}case"relative-to-scene":{const i=r.elevationProvider.getElevation(e,t,o,n,"scene")??0;return{absoluteZ:o+i+s,elevation:i}}}}function b(e,t){if(null==t)return!1;const{mode:o}=t;return null!=o&&("scene"===e&&"relative-to-scene"===o||"ground"===e&&"absolute-height"!==o)}function R(e,t,o){return o&&o.mode!==t?`${e} only support ${t} elevation mode`:null}function E(e,t,o){return o?.mode===t?`${e} do not support ${t} elevation mode`:null}function M(e,t){return null!=t?.featureExpressionInfo&&"0"!==t.featureExpressionInfo.expression?`${e} do not support featureExpressionInfo`:null}function I(e,t){t&&e.warn(".elevationInfo=",t)}function T(e){return(e?.offset??0)*(0,i.Ao)(e?.unit)}const k={mode:"absolute-height",offset:0},P={mode:"on-the-ground",offset:null}},23456:(e,t,o)=>{o.d(t,{_8:()=>p,uB:()=>g});var n=o(15941),r=o(20664),i=o(9392),s=o(34111),a=o(76797),l=o(91605),u=o(13312),c=o(45308);function d(e,t){if(!Array.isArray(e)||e.length<t)return!1;for(const o of e)if("number"!=typeof o)return!1;return!0}const h=7645211,f={xmin:-180,ymin:-90,zmin:-450,xmax:180,ymax:90,zmax:8850};new Map([[5773,new l.A({heightModel:"gravity-related-height",heightUnit:"meters",vertCRS:"EGM96_Geoid"})],[3855,new l.A({heightModel:"gravity-related-height",heightUnit:"meters",vertCRS:"EGM2008_Geoid"})],[115700,new l.A({heightModel:"ellipsoidal",heightUnit:"meters",vertCRS:"WGS_1984"})],[115701,new l.A({heightModel:"ellipsoidal",heightUnit:"meters",vertCRS:"ETRS_1989"})],[6360,new l.A({heightModel:"gravity-related-height",heightUnit:"us-feet",vertCRS:"NAVD88_height_(ftUS)"})],[7837,new l.A({heightModel:"gravity-related-height",heightUnit:"meters",vertCRS:"DHHN2016_(height) "})]]);function p(e){return!(!(e.extensions?.ESRI_crs?.wkid||e.extensions?.ESRI_crs?.latestWkid||e.extensions?.ESRI_crs?.wkt)||!e.root?.extensions?.ESRI_crs?.boundingVolume?.box&&!e.root?.extensions?.ESRI_crs?.boundingVolume?.sphere)}function g(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=new u.A({wkid:4326,vcsWkid:115700}),l=e.root?.boundingVolume,p=!1,g=e?.root?.transform;if(t&&(e.extensions?.ESRI_crs?.wkid||e.extensions?.ESRI_crs?.latestWkid||e.extensions?.ESRI_crs?.wkt)&&(e.root?.extensions?.ESRI_crs?.boundingVolume?.box||e.root?.extensions?.ESRI_crs?.boundingVolume?.sphere))o=new u.A(e.extensions?.ESRI_crs),l=e.root?.extensions?.ESRI_crs?.boundingVolume,g=e.root?.transform,p=!0;else if(!l)return new a.A(-180,-90,180,90,o);if(l.box){const e=l?.box;if(e[3]>h&&e[7]>h&&e[11]>h)return new a.A({...f,spatialReference:o})}const m=(0,i.vt)();if(!p&&l.region&&d(l.region,6)){const e=l.region,t=(0,n.KJ)(e[0]),r=(0,n.KJ)(e[1]),i=e[4],s=(0,n.KJ)(e[2]),u=(0,n.KJ)(e[3]),c=e[5];return new a.A({xmin:t,ymin:r,zmin:i,xmax:s,ymax:u,zmax:c,spatialReference:o})}if(l.sphere&&d(l.sphere,4)){const e=l.sphere,t=(0,i.fA)(e[0],e[1],e[2]),n=e[3]/Math.sqrt(3),h=(0,i.vt)();(0,r.e)(h,t,(0,i.fA)(n,n,n));const f=(0,i.vt)();if((0,r.g)(f,t,(0,i.fA)(n,n,n)),g&&d(g,16)){const e=g;(0,r.t)(m,h,e),(0,r.d)(h,m),(0,r.t)(m,f,e),(0,r.d)(f,m)}p||((0,c.projectBuffer)(h,s.Ro,0,h,u.A.WGS84,0),(0,c.projectBuffer)(f,s.Ro,0,f,u.A.WGS84,0));const y=(0,i.vt)(),v=(0,i.vt)();return(0,r.A)(y,h,f),(0,r.z)(v,h,f),new a.A({xmin:y[0],ymin:y[1],zmin:y[2],xmax:v[0],ymax:v[1],zmax:v[2],spatialReference:o})}if(l.box&&d(l.box,12)){const e=l.box,t=(0,i.fA)(e[0],e[1],e[2]),n=(0,i.fA)(e[3],e[4],e[5]),h=(0,i.fA)(e[6],e[7],e[8]),f=(0,i.fA)(e[9],e[10],e[11]),m=[];for(let o=0;o<8;++o)m.push((0,i.vt)());if((0,r.g)(m[0],t,n),(0,r.g)(m[0],m[0],h),(0,r.g)(m[0],m[0],f),(0,r.a)(m[1],t,n),(0,r.g)(m[1],m[1],h),(0,r.g)(m[1],m[1],f),(0,r.g)(m[2],t,n),(0,r.a)(m[2],m[2],h),(0,r.g)(m[2],m[2],f),(0,r.a)(m[3],t,n),(0,r.a)(m[3],m[3],h),(0,r.g)(m[3],m[3],f),(0,r.g)(m[4],t,n),(0,r.g)(m[4],m[4],h),(0,r.a)(m[4],m[4],f),(0,r.a)(m[5],t,n),(0,r.g)(m[5],m[5],h),(0,r.a)(m[5],m[5],f),(0,r.g)(m[6],t,n),(0,r.a)(m[6],m[6],h),(0,r.a)(m[6],m[6],f),(0,r.a)(m[7],t,n),(0,r.a)(m[7],m[7],h),(0,r.a)(m[7],m[7],f),g&&d(g,16)){const e=g;for(let t=0;t<8;++t)(0,r.t)(m[t],m[t],e)}const y=(0,i.fA)(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),v=(0,i.fA)(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);for(let o=0;o<8;++o)p||(0,c.projectBuffer)(m[o],s.Ro,0,m[o],u.A.WGS84,0),(0,r.A)(v,v,m[o]),(0,r.z)(y,y,m[o]);return new a.A({xmin:v[0],ymin:v[1],zmin:v[2],xmax:y[0],ymax:y[1],zmax:y[2],spatialReference:o})}return new a.A(-180,-90,180,90,o)}},56002:(e,t,o)=>{function n(e){let t,o,n=[],r=!1;return function(){for(var i=arguments.length,s=new Array(i),a=0;a<i;a++)s[a]=arguments[a];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(let o=0;o<e.length;++o)if(e[o]!==t[o])return!1;return!0}(s,n)||(o=e.apply(this,s),t=this,n=s,r=!0),o}}o.d(t,{B:()=>n})},59518:(e,t,o)=>{o.d(t,{A:()=>A});var n,r=o(6326),i=o(3825),s=o(19276),a=o(42553),l=o(90534),u=o(46053),c=(o(81806),o(76460),o(47249),o(87990)),d=o(53084),h=o(62754),f=o(17707),p=o(37546),g=o(65215),m=o(56611);let y=n=class extends a.o{constructor(e){super(e),this.geometry=null,this.type="clip"}writeGeometry(e,t,o,n){if(n.layer?.spatialReference&&!n.layer.spatialReference.equals(this.geometry.spatialReference)){if(!(0,m.canProjectWithoutEngine)(e.spatialReference,n.layer.spatialReference))return void(n?.messages&&n.messages.push(new h.A("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",{modification:this,spatialReference:n.layer.spatialReference,context:n})));const r=new g.A;(0,m.projectPolygon)(e,r,n.layer.spatialReference),t[o]=r.toJSON(n)}else t[o]=e.toJSON(n)}clone(){return new n({geometry:(0,d.o8)(this.geometry),type:this.type})}};var v;(0,r.Cg)([(0,u.MZ)({type:g.A}),(0,p.P)()],y.prototype,"geometry",void 0),(0,r.Cg)([(0,f.K)(["web-scene","portal-item"],"geometry")],y.prototype,"writeGeometry",null),(0,r.Cg)([(0,u.MZ)({type:["clip","mask","replace"],nonNullable:!0}),(0,p.P)()],y.prototype,"type",void 0),y=n=(0,r.Cg)([(0,c.$)("esri.layers.support.SceneModification")],y);let A=v=class extends((0,a.T)(s.A.ofType(y))){constructor(e){super(e),this.url=null}clone(){return new v({url:this.url,items:this.items.map(e=>e.clone())})}toJSON(e){return this.toArray().map(t=>t.toJSON(e)).filter(e=>!!e.geometry)}static fromJSON(e,t){const o=new v;for(const n of e)o.add(y.fromJSON(n,t));return o}static async fromUrl(e,t,o){const n={url:(0,l.An)(e),origin:"service"},r=await(0,i.A)(e,{responseType:"json",signal:o?.signal}),s=t.toJSON(),a=[];for(const i of r.data)a.push(y.fromJSON({...i,geometry:{spatialReference:s,...i.geometry}},n));return new v({url:e,items:a})}};(0,r.Cg)([(0,u.MZ)({type:String})],A.prototype,"url",void 0),A=v=(0,r.Cg)([(0,c.$)("esri.layers.support.SceneModifications")],A)},76790:(e,t,o)=>{o.r(t),o.d(t,{default:()=>P});var n=o(6326),r=o(3825),i=o(50076),s=o(76460),a=o(77717),l=o(50346),u=o(68134),c=o(46053),d=(o(81806),o(47249),o(28379)),h=o(87990),f=o(37546),p=o(76797),g=o(13312),m=o(25515),y=o(12406),v=o(19502),A=o(31362),x=o(11270),_=o(94729),w=o(5682),S=o(95363),b=o(59518),R=o(23456),E=o(65308),M=o(12482),I=o(79453),T=o(50917);let k=class extends((0,v.b)((0,x.q)((0,_.A)((0,w.j)((0,a.P)((0,A.d)((0,y.p)(m.A)))))))){readModifications(e,t,o){this._modificationsSource={url:(0,I.f)(e,o),context:o}}initialize(){this.addHandles((0,u.on)(()=>this.modifications,"after-changes",()=>this.modifications=this.modifications,u.OH))}constructor(e){super(e),this.operationalLayerType="IntegratedMesh3DTilesLayer",this.modifications=null,this._modificationsSource=null,this.spatialReference=new g.A({wkid:4326,vcsWkid:115700}),this.fullExtent=new p.A(-180,-90,180,90,this.spatialReference),this.url=null,this.type="integrated-mesh-3dtiles",this.path=null,this.minScale=0,this.maxScale=0,this._rootTilesetJSON=null,this._rootTileset=null,this._key=null,this._session=null,this._rootRequestPromise=null}set elevationInfo(e){null!=e&&"absolute-height"!==e.mode||this._set("elevationInfo",e),this._validateElevationInfo(e)}async load(e){return this.addResolvingPromise(this._doLoad(e)),this}get rootTilesetJSON(){return this._rootTilesetJSON}get rootTileset(){return this._rootTileset}get key(){return this._key}get session(){return this._session}_findSessionParameter(e){const t=[e];for(;t?.length>0;){const e=t.pop();if(!e)return;for(const[n,r]of Object.entries(e)){if("uri"===n)try{const e=new URL("https://tmp"+r).searchParams.get("session");if(e)return e}catch(o){}"object"==typeof r&&null!==r&&t.push(r)}}return null}async requestRootAndSession(e){const t=(e,t)=>new i.A("3dtiles-init:"+e,t);return this._rootRequestPromise||(this._rootRequestPromise=new Promise((o,n)=>{this.url||n(t("url-missing","Layer url missing")),this._key=this.customParameters?this.customParameters.key:null,new Promise((e,o)=>{if(this.replacesTerrain&&!this._key){const n=this.portalItem?.portal||this.parent?.portalItem?.portal||E.A.getDefault();n.signIn().then(()=>{n.g3dTilesEnabled?(0,r.A)(n.restUrl+"/portals/self/modules/g3dtiles",{responseType:"json",query:{f:"json"}}).then(t=>{this._key=t.data.keyString,e()},()=>o(t("g3dtiles-key-error","Error fetching Google 3D Tiles key from portal"))):o(t("g3dTilesEnabled-false","Google 3D Tiles are not enabled on Portal "+n.url))},()=>o(t("sign-in-failed","Error signing in to Portal")))}else e()}).then(()=>{(0,r.A)(this.url,{query:this._key?{key:this._key,token:this.apiKey}:{token:this.apiKey},responseType:"array-buffer",authMode:"anonymous",signal:e}).then(e=>{try{this._rootTilesetJSON=JSON.parse((new TextDecoder).decode(e.data))}catch(r){return void n(t("root-parse-failed","Error parsing root tile, details: "+r))}this._rootTilesetJSON?(this._session=this._findSessionParameter(this._rootTilesetJSON),this._rootTileset=e.data,this.fullExtent=(0,R.uB)(this._rootTilesetJSON),o(),this._rootRequestPromise=null):n(t("root-is-null","Root tile is null."))},e=>{(0,l.QP)(e),n(t("root-load-failed","Error loading root tile")),this._rootRequestPromise=null,s.A.getLogger("IntegratedMesh3DTilesLayer").error("Layer loading failed",e)})},e=>n(e))})),this._rootRequestPromise}async _doLoad(e){const t=null!=e?e.signal:null;if(this._isUsedAsGroundLayer)throw new i.A("3dtiles-init:not-supported-in-groundlayers","Layer is not supported in basemap.");try{await this.loadFromPortal({supportedTypes:["3DTiles Service"],validateItem:e=>{if(e.typeKeywords?.includes("IntegratedMesh"))return!0;throw new i.A("portal:invalid-layer-item-type","Invalid layer item, expected '${expectedType}' ",{expectedType:"3DTiles Service containing IntegratedMesh"})}},e)}catch(o){(0,l.QP)(o)}if(null!=this._modificationsSource){const t=await b.A.fromUrl(this._modificationsSource.url,this.spatialReference,e);this.setAtOrigin("modifications",t,this._modificationsSource.context.origin),this._modificationsSource=null}await this.requestRootAndSession(t)}beforeSave(){if(null!=this._modificationsSource)return this.load().then(()=>{},()=>{})}get hasAttributionData(){return!1}async fetchAttributionData(){return{}}_validateElevationInfo(e){const t="Integrated mesh 3d tiles layers";(0,M.XF)(s.A.getLogger(this),(0,M.B)(t,"absolute-height",e)),(0,M.XF)(s.A.getLogger(this),(0,M.tW)(t,e))}get replacesTerrain(){return!1}get _isUsedAsGroundLayer(){return(0,T.S)(this.parent)}get hasGoogleUrl(){return!!this.url?.match(/.+\.googleapis.com/)}};(0,n.Cg)([(0,c.MZ)({type:["IntegratedMesh3DTilesLayer"]})],k.prototype,"operationalLayerType",void 0),(0,n.Cg)([(0,c.MZ)({type:b.A,clonable:e=>e.clone()}),(0,f.P)({origins:["web-scene","portal-item"],type:"resource",prefix:"modifications"})],k.prototype,"modifications",void 0),(0,n.Cg)([(0,d.w)(["web-scene","portal-item"],"modifications")],k.prototype,"readModifications",null),(0,n.Cg)([(0,c.MZ)({type:g.A})],k.prototype,"spatialReference",void 0),(0,n.Cg)([(0,c.MZ)({type:p.A})],k.prototype,"fullExtent",void 0),(0,n.Cg)([(0,c.MZ)(S.Yj)],k.prototype,"elevationInfo",null),(0,n.Cg)([(0,c.MZ)({type:["show","hide"]})],k.prototype,"listMode",void 0),(0,n.Cg)([(0,c.MZ)(S.OZ)],k.prototype,"url",void 0),(0,n.Cg)([(0,c.MZ)({readOnly:!0})],k.prototype,"type",void 0),(0,n.Cg)([(0,c.MZ)({type:String,json:{origins:{"web-scene":{read:!0,write:!0},"portal-item":{read:!0,write:!0}},read:!1}})],k.prototype,"path",void 0),(0,n.Cg)([(0,c.MZ)({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:!1,write:!1}}}})],k.prototype,"minScale",void 0),(0,n.Cg)([(0,c.MZ)({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:!1,write:!1}}}})],k.prototype,"maxScale",void 0),(0,n.Cg)([(0,c.MZ)()],k.prototype,"replacesTerrain",null),(0,n.Cg)([(0,c.MZ)()],k.prototype,"_isUsedAsGroundLayer",null),(0,n.Cg)([(0,c.MZ)()],k.prototype,"hasGoogleUrl",null),k=(0,n.Cg)([(0,h.$)("esri.layers.IntegratedMesh3DTilesLayer")],k);const P=k}}]);
//# sourceMappingURL=6790.a43e7701.chunk.js.map