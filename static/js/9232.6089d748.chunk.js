"use strict";(self.webpackChunkn2_trees=self.webpackChunkn2_trees||[]).push([[9232],{55:(e,t,r)=>{r.d(t,{cZ:()=>S,XW:()=>x,fe:()=>L});var i=r(3825),n=r(50076),s=r(87663),o=(r(98618),r(1484)),a=r(13312);class l{constructor(){this.version="",this.queryResult=new p}}class p{constructor(){this.featureResult=new d}}class d{constructor(){this.objectIdFieldName="",this.uniqueIdField=new u,this.globalIdFieldName="",this.geohashFieldName="",this.geometryProperties=new c,this.geometryType=null,this.spatialReference=new a.A,this.exceededTransferLimit=!1,this.hasZ=!1,this.hasM=!1,this.transform=new y,this.fields=[],this.fieldNameToAttributeIndexMap={},this.values=[],this.features=[],this.geometryFields=[]}}class u{constructor(){this.name="",this.isSystemMaintained=!1}}class c{constructor(){this.shapeAreaFieldName="",this.shapeLengthFieldName="",this.units=""}}class y{constructor(){this.quantizeOriginPosition="upperLeft",this.scale=new h,this.translate=new g}}class h{constructor(){this.xScale=0,this.yScale=0,this.mScale=0,this.zScale=0}}class g{constructor(){this.xTranslate=0,this.yTranslate=0,this.mTranslate=0,this.zTranslate=0}}class m{constructor(){this.name="",this.fieldType="esriFieldTypeString",this.alias="",this.sqlType="sqlTypeVarchar",this.domain="",this.defaultValue=""}}class f{constructor(){this.attributes=[],this.compressedGeometry=new b,this.centroid=new b,this.aggregateGeometries=[]}}class b{constructor(){this.geometryType=null,this.lengths=[],this.coords=[]}}const w=["ELEMENTUID","TYPENAME"];var T=r(57502),C=r(31830);const M={upperLeft:0,lowerLeft:1},I={sqlTypeBigInt:0,sqlTypeBinary:1,sqlTypeBit:2,sqlTypeChar:3,sqlTypeDate:4,sqlTypeDecimal:5,sqlTypeDouble:6,sqlTypeFloat:7,sqlTypeGeometry:8,sqlTypeGUID:9,sqlTypeInteger:10,sqlTypeLongNVarchar:11,sqlTypeLongVarbinary:12,sqlTypeLongVarchar:13,sqlTypeNChar:14,sqlTypeNVarChar:15,sqlTypeOther:16,sqlTypeReal:17,sqlTypeSmallInt:18,sqlTypeSqlXml:19,sqlTypeTime:20,sqlTypeTimestamp:21,sqlTypeTimestamp2:22,sqlTypeTinyInt:23,sqlTypeVarbinary:24,sqlTypeVarchar:25};var v=r(48611);function A(e){const t=new b;t.geometryType=(0,v.i7)(C.bV,e.geometry_type.value);const r=[],i=[];for(let n=0;n<e.lengths.length;n++)r.push(e.lengths[n]);for(let n=0;n<e.coords.length;n++)i.push(e.coords[n]);return t.lengths=r,t.coords=i,t}function E(e){const t=new m;return t.name=e.name,t.alias=e.alias,t.fieldType=(0,v.i7)(C.r5,e.field_type.value),t.sqlType=(0,v.i7)(I,e.sql_type.value),t.domain=e.domain,t.defaultValue=e.default_value,t}function _(e){const t=E(e);return t.geometryType=(0,v.i7)(C.bV,e.geometry_type.value),t}function N(e){const t=new y;t.quantizeOriginPosition=(0,v.i7)(M,e.quantizeOriginPosition.value);const r=t.scale,i=e.scale;r.xScale=i.xScale,r.yScale=i.yScale,r.mScale=i.mScale,r.zScale=i.zScale;const n=t.translate,s=e.translate;return n.xTranslate=s.xTranslate,n.yTranslate=s.yTranslate,n.mTranslate=s.mTranslate,n.zTranslate=s.zTranslate,t}async function S(e,t){t??=!1;const r={generateAllSublayers:t,namedTypeDefinitions:new Map};return await async function(e){const t=await(0,i.A)(e,{responseType:"array-buffer"}),r=await t.data;return async function(e){const t=new((await(0,T.I)()).MapOfObjectIdentifierSetsDecoder),r=t.decode(new Uint8Array(e)),i=new Map;if(0!==r.error_code)throw new n.A("knowledge-graph:layer-support-utils",r.error_message);const s=t.get_map_of_identifier_sets(),o=s.keys,a=o.size();for(let l=0;l<a;l++){const e=o.get(l),t=s.query_identifier_set(e),r=[];if(1===t.id_array_type.value){const e=t.get_globalid_array(),i=e.count();for(let t=0;t<i;t++)r.push(e.get_globalid_at(t))}else if(3===t.id_array_type.value){const e=t.get_identifier_array(),i=e.count();for(let t=0;t<i;t++)r.push(e.get_identifier_at(t).toString())}else if(2===t.id_array_type.value){const e=t.get_string_array(),i=e.count();for(let t=0;t<i;t++)r.push(e.get_string_at(t))}else{if(0!==t.id_array_type.value)throw new n.A("knowledge-graph:layer-support-utils","Tried to encode an unexpected ID Array type.");{const e=t.get_oid_array(),i=e.count();for(let t=0;t<i;t++)r.push(e.get_objectid_at(t).toString())}}i.set(e,r)}return t.delete(),i}(new Uint8Array(r))}(e).then(e=>{!function(e,t){for(const[r,i]of e){const e=(0,s.tE)(t.namedTypeDefinitions,r,()=>({useAllData:!1,members:new Map}));for(const t of i)e.members.has(t)||e.members.set(t,{id:t})}}(e,r)}),r}async function L(e){const t=await(0,T.I)(),r=new t.MapOfObjectIdentifierSets;!function(e,t,r){for(const[i,n]of r.namedTypeDefinitions){if(!n.members||n.useAllData)continue;const r=n.members.keys();let s=!1,o=!0;const a=new t.ObjectIdArray,l=new t.StringArray,p=new t.GlobalIdArray,d=new t.IdentifierArray,u=new t.ObjectIdentifierSet;for(const e of r)o&&(s=!isNaN(Number(e)),o=!1),s?a.add_objectid(Number(e)):(l.add_string(e),p.add_globalid(e)),d.add_identifier(e);u.set_oid_array(a),u.set_string_array(l),u.set_globalid_array(p),u.set_identifier_array(d),a.delete(),l.delete(),p.delete(),d.delete(),e.put_identifier_set(i,u),u.delete()}}(r,t,e);const i=new t.MapOfObjectIdentifierSetsEncoder;try{i.set_map_of_identifier_sets(r),i.encode();const e=i.get_encoding_result();if(0!==e.error.error_code)throw new n.A("knowledge-graph:layer-support-utils",e.error.error_message);const t=structuredClone(e.get_byte_buffer());return i.delete(),t}finally{r.delete()}}async function k(e){const t=await(0,i.A)(e,{responseType:"array-buffer"});return async function(e){const t=new((await(0,T.I)()).FeatureCollectionDecoder),r=t.decode(new Uint8Array(e));if(0!==r.error_code)throw new n.A("knowledge-graph:layer-support-utils",r.error_message);const i=t.get_feature_collection(),s=function(e){const t=new l;t.version=e.version;const r=e.get_query_result();if(0!==r.results_type.value)throw new Error("Got a non-feature collection type");const i=r.get_feature_result(),n=t.queryResult.featureResult;n.objectIdFieldName=i.objectid_field_name,n.exceededTransferLimit=i.exceeded_transfer_limit,n.hasM=i.has_m,n.hasZ=i.has_z,n.geometryType=(0,v.i7)(C.bV,i.geometry_type.value),n.globalIdFieldName=i.globalid_field_name,n.geohashFieldName=i.geohash_field_name;const s=n.uniqueIdField,o=i.unique_id_field;s.name=o.name,s.isSystemMaintained=o.isSystemMaintained;const a=n.geometryProperties,p=i.geometry_properties;a.shapeAreaFieldName=p.shapeAreaFieldName,a.shapeLengthFieldName=p.shapeLengthFieldName,a.units=p.units;const d=n.spatialReference,u=i.spatial_reference;d.wkid=u.wkid,d.latestWkid=u.latestWkid,d.vcsWkid=u.vcsWkid,d.latestVcsWkid=u.latestVcsWkid,d.wkt=u.wkt,n.transform=N(i.transform);const c=n.fields,y=n.fieldNameToAttributeIndexMap,h=i.fields,g=h.size();for(let l=0;l<g;l++){const e=h.get(l),t=E(e);c.push(t),y[t.name]=l,e.delete()}h.delete();const m=n.values,b=i.values_count();for(let l=0;l<b;l++)m.push(i.get_value_at(l));const T=n.features,M=i.features,I=M.size();if(I>0)for(const l of w)if(void 0===y[l])throw new Error(`Feature collection missing required attribute: ${l}`);for(let l=0;l<I;l++){const e=new f,t=M.get(l),r=e.attributes,i=t.attributes_count();for(let l=0;l<i;l++)r.push(t.get_attribute_at(l));const n=t.get_compressed_geometry();n&&(e.compressedGeometry=A(n),e.centroid=A(t.get_centroid()));const s=e.aggregateGeometries,o=t.aggregate_geometries,a=o.size();for(let l=0;l<a;l++){const e=o.get(l),t=A(e);s.push(t),e.delete()}o.delete(),T.push(e),t.delete()}M.delete();const S=n.geometryFields,L=i.geometry_fields,k=L.size();for(let l=0;l<k;l++){const e=L.get(l),t=_(e);S.push(t),e.delete()}return L.delete(),t}(i);return t.delete(),s}(await t.data)}function D(e,t){if(!e?.queryResult?.featureResult)return t;const r=e.queryResult.featureResult.fieldNameToAttributeIndexMap;for(const i of e.queryResult.featureResult.features){const e=i.attributes[r.TYPENAME],n=(0,s.tE)(t.namedTypeDefinitions,e,()=>({useAllData:!1,members:new Map})),a=i.attributes[r.ELEMENTUID];if(i.compressedGeometry?.coords?.length>0){let e=i.compressedGeometry.lengths;"esriGeometryPoint"===i.compressedGeometry.geometryType&&(e=[]),n.members.set(a,{id:a,linkChartLocation:new o.A(e,i.compressedGeometry.coords)})}else n.members.set(a,{id:a})}return t}const x={fetchAndConvertSerializedLinkChart:e=>async function(e){const t=[],r={generateAllSublayers:!1,namedTypeDefinitions:new Map};return e.entitiesUrl&&t.push(k(e.entitiesUrl).then(e=>{D(e,r)})),e.relationshipsUrl&&t.push(k(e.relationshipsUrl).then(e=>{D(e,r)})),await Promise.all(t),r}(e)}},536:(e,t,r)=>{r.d(t,{A:()=>ye});var i=r(6326),n=r(16868),s=r(50076),o=r(53084),a=r(76460),l=r(77717),p=(r(16783),r(46053)),d=(r(81806),r(87990)),u=r(17707),c=r(76797),y=r(19247),h=r(65215),g=r(23701),m=r(56611),f=r(13312),b=r(80963),w=r(31608),T=r(74398),C=r(61024),M=r(57274),I=r(9465);const v=Symbol("isKnowledgeGraphGraphicOriginSymbol");var A;class E extends I.A{get[(A=v,C.ym)](){return this.sublayer}get[T.e](){return this.sublayer}get[M.Q](){return this.sublayer}constructor(e,t){super(),this[A]=!0,this.type="knowledge-graph",this.layer=e,this.sublayer=t}get id(){return this.layer.id}}const _=Symbol("isLinkChartGraphicOriginSymbol");var N;class S extends I.A{get[(N=_,M.Q)](){return this.layer}constructor(e,t){super(),this[N]=!0,this.type="link-chart",this.layer=e,this.sublayer=t}get id(){return`${this.layer.id}:__${this.sublayer.id}__`}}var L=r(25515),k=r(72547),D=r(12034),x=r(40296),R=r(21009);r(47249);const F=(0,r(76350).p)(),O=e=>{const t=e;let r=class extends t{constructor(){super(...arguments),this.fields=[],this.fieldsIndex=null}};return(0,i.Cg)([(0,p.MZ)(F.fields)],r.prototype,"fields",void 0),(0,i.Cg)([(0,p.MZ)(F.fieldsIndex)],r.prototype,"fieldsIndex",void 0),r=(0,i.Cg)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayerBase")],r),r};var j=r(61064),Z=r(65624),G=r(30218),$=r(74440),P=r(20443),q=r(37534),U=r(21617),Q=r(5682),z=r(78817),B=r(95363),H=r(54490),W=r(44135),V=r(53430),J=r(95114),K=r(27937),Y=r(83982),X=r(5766),ee=r(86616),te=r(34373),re=r(6560),ie=r(77725),ne=r(97015),se=r(30973),oe=r(94439),ae=r(59989);function le(e){if(!e.json)return e;e.json.write=pe(e.json.write);const t=e.json.origins;if(!t)return e;let r;for(r in t){const e=t[r];e&&(e.write=pe(e.write))}return e}function pe(e){return"object"==typeof e&&e?(!1!==e.enabled&&(e.overridePolicy=function(e){const{target:t,writer:r,overridePolicy:i,...n}=e;return function(e,t){const r=ue.call(this,e,t);return r.enabled?{...n,...r}:r}}(e)),e):!0===e?de():e}function de(){return{overridePolicy:ue}}function ue(e,t){const r=!!this.geometryType;let i={enabled:r};return r&&(i={...i,...ce.call(this,e,t)}),i}function ce(e,t){return{ignoreOrigin:this.originIdOf(t)>0}}let ye=class extends(O((0,G.FJ)((0,P.J)((0,$.F)((0,Z.dM)((0,q.fY)((0,z.e)((0,Q.j)((0,U.J)((0,l.P)(L.A))))))))))){constructor(e){var t;super(e),t=this,this.blendMode="normal",this.charts=null,this.definitionExpression=null,this.displayFilterEnabled=!0,this.displayFilterInfo=null,this.effect=null,this.elevationInfo=null,this.featureEffect=null,this.graphType=null,this.labelsVisible=!0,this.layerType=null,this.legendEnabled=!0,this.maxScale=0,this.minScale=0,this.objectIdField=R.dr,this.objectType=null,this.opacity=1,this.orderBy=null,this.parent=null,this.parentCompositeLayer=null,this.persistenceEnabled=!0,this.popupEnabled=!0,this.popupTemplate=null,this.refreshInterval=0,this.source={openPorts:()=>this.load().then(()=>{const e=new MessageChannel;return new ae.A(e.port1,{channel:e,client:{queryFeatures:function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i=ne.A.fromJSON(e);return t.queryFeaturesJSON(i,r)}}}),[e.port2]})},this.type="knowledge-graph-sublayer",this.useViewTime=!0,this.visible=!0}get capabilities(){return this.parent?this.parent.sublayerCapabilities:(0,j.hZ)(null)}get userHasUpdateItemPrivileges(){return!!this.parent?.userHasUpdateItemPrivileges}get editingEnabled(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.capabilities.operations.supportsEditing}set editingEnabled(e){this._overrideIfSome("editingEnabled",e)}get isTable(){return"link-chart"!==this.parentCompositeLayer.type&&null==this.geometryFieldName}get defaultPopupTemplate(){return this.createPopupTemplate()}set featureReduction(e){const t=this._normalizeFeatureReduction(e);this._set("featureReduction",t)}get fields(){const e=[];return this.objectType?.properties?.forEach(t=>{const r="esriFieldTypeOID"===t.fieldType?"esriFieldTypeInteger":t.fieldType;e.push(W.A.fromJSON({name:t.name,type:r,alias:t.alias,defaultValue:t.defaultValue,editable:t.editable,nullable:t.nullable}))}),e.push(W.A.fromJSON({name:this.objectIdField,type:"esriFieldTypeString",alias:this.objectIdField,editable:!1}),W.A.fromJSON({name:R.M1,type:"esriFieldTypeInteger",alias:R.M1,editable:!1}),W.A.fromJSON({name:R.BL,type:"esriFieldTypeInteger",alias:R.BL,editable:!1})),e}get formTemplate(){return this._isOverridden("formTemplate")?this._get("formTemplate"):(0,j.dD)(this)}set formTemplate(e){this._overrideIfSome("formTemplate",e)}get geometryType(){if("link-chart"===this.parentCompositeLayer?.type)return"relationship"===this.graphType?"polyline":"point";const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.geometryType;return t&&"esriGeometryNull"!==t?w.gy.fromJSON(t):null}get geometryFieldName(){if("link-chart"===this.parentCompositeLayer?.type)return R.T1;const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name);return e?.name??null}get graphicOrigin(){if(!this.parent)return null;switch(this.parent.type){case"knowledge-graph":return new E(this.parent,this);case"link-chart":return new S(this.parent,this)}}get graphTypeName(){return this.objectType?.name}set graphTypeName(e){this._set("graphTypeName",e)}get hasM(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasM??!1}get hasZ(){const e=this.parentCompositeLayer?.dataManager.geographicLookup.get(this.objectType?.name),t=e?.name,r=t?this.objectType?.properties?.[t]:null;return r?.hasZ??!1}set labelingInfo(e){this._set("labelingInfo",e)}get labelingInfo(){if(this._isOverridden("labelingInfo"))return this._get("labelingInfo");if(!this.objectType||!this.parentCompositeLayer||!this.graphTypeName)return null;const e=this.objectType.properties?(0,j.MY)(this.objectType.properties):"ESRI__ID";return"link-chart"===this.parentCompositeLayer.type?(0,j.iW)(this.graphType,this.graphTypeName,e):(0,j.e$)(this.graphTypeName,this.geometryType,e)}set renderer(e){(0,V.yp)(e,this.fieldsIndex),this._set("renderer",e)}get renderer(){if(this._isOverridden("renderer"))return this._get("renderer");const e=this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel,t=[...e?.entityTypes??[],...e?.relationshipTypes??[]].map(e=>e.name).indexOf(this.graphTypeName),r=(0,j.Td)(t);if("link-chart"===this.parentCompositeLayer?.type){if("relationship"===this.graphType)return new X.A({type:"simple",symbol:(0,j.UT)(r)});const e=(0,ee.r)((0,x.F0)(w.gy.toJSON("point")).renderer);return(0,oe.dt)(e.symbol,r),e}const i=(0,ee.r)((0,x.F0)(w.gy.toJSON(this.geometryType)).renderer);return(0,oe.dt)(i.symbol,r),i}get spatialReference(){return this.parentCompositeLayer?.dataManager?.knowledgeGraph?.dataModel?.spatialReference??f.A.WGS84}get templates(){return this._isOverridden("templates")?this._get("templates"):(0,j.CP)(this)}set templates(e){this._overrideIfSome("templates",e)}set timeInfo(e){this._set("timeInfo",e)}get title(){return this._isOverridden("title")?this._get("title"):this.graphTypeName}set title(e){this._set("title",e)}writeTitle(e,t){t.title=e??"Layer"}createPopupTemplate(e){return(0,se.tn)(this,e)}createQuery(){return new ne.A({where:"1=1",outFields:["*"]})}getField(e){return this.fieldsIndex.get(e)}getFieldDomain(e,t){return null}async queryFeatures(e,t){await this.load();const{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(e),n=this.graphicOrigin,s=ie.A.fromJSON(await i.executeQuery(r.toJSON(),t?.signal));return s.features.forEach(e=>{e.sourceLayer=this,e.origin=n}),s}async queryFeaturesJSON(e,t){await this.load();const{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(e);return await i.executeQuery(r.toJSON(),t?.signal)}async queryFeatureCount(e,t){await this.load();const{resolvedQuery:r,queryEngine:i}=await this._setupQueryObjects(e);return i.executeQueryForCount(r.toJSON(),t?.signal)}async queryExtent(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;await this.load();const r={...e,returnGeometry:!0},{resolvedQuery:i,queryEngine:n}=await this._setupQueryObjects(r),s=await n.executeQueryForExtent(i.toJSON(),t?.signal);let o;return o=null!=s.extent?.xmin&&null!=s.extent?.xmax&&null!=s.extent?.ymin&&null!=s.extent?.ymax?new c.A(s.extent):new c.A,{count:s.count,extent:o}}async queryObjectIds(e,t){await this.load();const r=ne.A.from(e);let i;if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)i=this._cachedQueryEngine;else{const e=await this.parentCompositeLayer.dataManager.getData(r,this,t);i=this.loadQueryEngine(e)}return await i.executeQueryForIds(r.toJSON(),t?.signal)}async applyEdits(e){if(!this.parentCompositeLayer.dataManager.knowledgeGraph)throw new s.A("knowledge-graph-sublayer:no-knowledge-graph","ApplyEdits cannot be executed because the parent does not have a Knowledge Graph model.  This is usually caused by the layer not yet being loaded");const t=await(0,j.O9)(e,this);t.options={cascadeDelete:!0,cascadeProvenanceDelete:!!this.parent?.knowledgeGraph.serviceDefinition.supportsProvenance||void 0};const r=await(0,re.executeApplyEdits)(this.parentCompositeLayer.dataManager.knowledgeGraph,t),i=(0,j.Gz)(r,this.graphTypeName),n={addedFeatures:i.addFeatureResults,updatedFeatures:i.updateFeatureResults,deletedFeatures:i.deleteFeatureResults,addedAttachments:i.addAttachmentResults,deletedAttachments:i.deleteAttachmentResults,updatedAttachments:i.updateAttachmentResults,exceededTransferLimit:!1,historicMoment:new Date,edits:void 0};return this.emit("edits",n),this.emit("apply-edits",{result:Promise.resolve(n)}),"link-chart"===this.parentCompositeLayer.type&&await this.parentCompositeLayer.refreshLinkChartCache([...n.addedFeatures.map(e=>e.globalId),...n.updatedFeatures.map(e=>e.globalId),...n.deletedFeatures.map(e=>e.globalId)]),i}loadQueryEngine(e){const t=new k.A({geometryType:w.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ}),r=new D.do({fieldsIndex:this.fieldsIndex.toJSON(),geometryType:w.gy.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,featureIdInfo:{type:"object-id",fieldName:this.objectIdField},spatialReference:this.spatialReference.toJSON(),timeInfo:this.timeInfo?.toJSON(),featureStore:t});return r.featureStore.addMany(e),r}async refreshCachedQueryEngine(){const e=await this.parentCompositeLayer.dataManager.getData(new ne.A({where:"1=1",outFields:[R.dr]}),this);this._cachedQueryEngine=this.loadQueryEngine(e)}load(e){return this.addResolvingPromise(this.parent.load(e).then(()=>(0,V.sv)(this.timeInfo,this.fieldsIndex))),Promise.resolve(this)}async _setupQueryObjects(e,t){const r=ne.A.from(e),i=r.geometry;if(i&&!i.spatialReference?.isWGS84&&(await(0,m.initializeProjection)(i.spatialReference,b.KK),r.geometry=(0,m.project)(i instanceof h.A||i instanceof g.A||i instanceof y.A?i:i.extent,b.KK)),"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)return{resolvedQuery:r,queryEngine:this._cachedQueryEngine};const n=await this.parentCompositeLayer.dataManager.getData(r,this,t);return{resolvedQuery:r,queryEngine:this.loadQueryEngine(n)}}};(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(Z.sU)))],ye.prototype,"blendMode",void 0),(0,i.Cg)([(0,p.MZ)({readOnly:!0})],ye.prototype,"capabilities",null),(0,i.Cg)([(0,p.MZ)({readOnly:!0})],ye.prototype,"userHasUpdateItemPrivileges",null),(0,i.Cg)([(0,p.MZ)({type:Boolean})],ye.prototype,"editingEnabled",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"isTable",null),(0,i.Cg)([(0,p.MZ)({json:{origins:{"web-scene":{write:!1}},write:de()}})],ye.prototype,"charts",void 0),(0,i.Cg)([(0,p.MZ)({readOnly:!0})],ye.prototype,"defaultPopupTemplate",null),(0,i.Cg)([(0,p.MZ)({type:String,json:{origins:{service:{read:!1}},name:"layerDefinition.definitionExpression",write:{ignoreOrigin:!0}}})],ye.prototype,"definitionExpression",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(G.Dp)))],ye.prototype,"displayFilterEnabled",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(G.KV)))],ye.prototype,"displayFilterInfo",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(Z.LF)))],ye.prototype,"effect",void 0),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"elevationInfo",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)($.Y)))],ye.prototype,"featureEffect",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(H.d)))],ye.prototype,"featureReduction",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"fields",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"formTemplate",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"geometryType",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"geometryFieldName",null),(0,i.Cg)([(0,p.MZ)({readOnly:!0})],ye.prototype,"graphicOrigin",null),(0,i.Cg)([(0,p.MZ)({type:["entity","relationship"],nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],ye.prototype,"graphType",void 0),(0,i.Cg)([(0,p.MZ)({type:String,nonNullable:!0,json:{write:{isRequired:!0,ignoreOrigin:!0}}})],ye.prototype,"graphTypeName",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"hasM",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"hasZ",null),(0,i.Cg)([(0,p.MZ)({type:String,json:{origins:{service:{read:!1},"portal-item":{read:!1}},write:{ignoreOrigin:!0}}})],ye.prototype,"id",void 0),(0,i.Cg)([(0,p.MZ)({type:Boolean,value:!0,nonNullable:!0,json:{name:"showLabels",default:!1,write:{overridePolicy(){return{enabled:!!this.geometryType,alwaysWriteDefaults:!0,ignoreOrigin:!0}}}}})],ye.prototype,"labelsVisible",void 0),(0,i.Cg)([(0,p.MZ)({type:[J.A],json:{name:"layerDefinition.drawingInfo.labelingInfo",read:function(e,t,r){const i=[["ESRI__AGGREGATION_COUNT",R.M1],["ESRI__ORIGIN_ID",R.Cz],["ESRI__DESTINATION_ID",R.KQ],["ESRI__LAYOUT_GEOMETRY",R.T1]];try{for(const t of e)for(const[e,r]of i)t.labelExpression=t.labelExpression?.replaceAll(e,r),t.labelExpressionInfo?.expression&&(t.labelExpressionInfo.expression=t.labelExpressionInfo.expression.replaceAll(e,r))}catch(S){a.A.getLogger(this).warn("Error updating labelingInfo",S)}return(0,K.w)(e,t,r)},write:de()}})],ye.prototype,"labelingInfo",null),(0,i.Cg)([(0,p.MZ)({readOnly:!0,json:{read:!1,write:{writer(e,t){switch(this.parentCompositeLayer?.type){case"link-chart":t.layerType="LinkChartSubLayer";break;case"knowledge-graph":t.layerType=this.geometryType?"KnowledgeGraphSubLayer":"KnowledgeGraphSubTable"}},isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],ye.prototype,"layerType",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(B.fV)))],ye.prototype,"legendEnabled",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(B.hG)))],ye.prototype,"maxScale",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(B.hn)))],ye.prototype,"minScale",void 0),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"objectIdField",void 0),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"objectType",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(B.ke)))],ye.prototype,"opacity",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(q.ne)))],ye.prototype,"orderBy",void 0),(0,i.Cg)([(0,p.MZ)({clonable:!1})],ye.prototype,"parent",void 0),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"parentCompositeLayer",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(B.M6)))],ye.prototype,"popupEnabled",void 0),(0,i.Cg)([(0,p.MZ)({type:n.A,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],ye.prototype,"popupTemplate",void 0),(0,i.Cg)([(0,p.MZ)({type:Number,json:{write:{overridePolicy:ce}}})],ye.prototype,"refreshInterval",void 0),(0,i.Cg)([(0,p.MZ)({types:te.Hg,json:{name:"layerDefinition.drawingInfo.renderer",write:de()}})],ye.prototype,"renderer",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"source",void 0),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"spatialReference",null),(0,i.Cg)([(0,p.MZ)()],ye.prototype,"templates",null),(0,i.Cg)([(0,p.MZ)({type:Y.A,json:{name:"layerDefinition.timeInfo",write:{overridePolicy:ce},origins:{"web-document":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:ce}},"portal-item":{name:"layerDefinition.timeInfo",read:!0,write:{overridePolicy:ce}}}}})],ye.prototype,"timeInfo",null),(0,i.Cg)([(0,p.MZ)({type:String,json:{write:{isRequired:!0,ignoreOrigin:!0,writerEnsuresNonNull:!0}}})],ye.prototype,"title",null),(0,i.Cg)([(0,u.K)("title")],ye.prototype,"writeTitle",null),(0,i.Cg)([(0,p.MZ)({json:{read:!1}})],ye.prototype,"type",void 0),(0,i.Cg)([(0,p.MZ)(le((0,o.o8)(z.B)))],ye.prototype,"useViewTime",void 0),(0,i.Cg)([(0,p.MZ)({type:Boolean,json:{name:"visibility",write:de()}})],ye.prototype,"visible",void 0),ye=(0,i.Cg)([(0,d.$)("esri.layers.knowledgeGraph.KnowledgeGraphSublayer")],ye)},8893:(e,t,r)=>{r.d(t,{k5:()=>d,aq:()=>p,Wq:()=>u});r(39356);var i=r(50076),n=(r(19247),r(65215),r(23701),r(63733),r(33750),r(85646),r(45802));(0,n.O)()({none:"none",startAndEnd:"start-and-end",startOnly:"start-only"}),(0,n.O)()({absoluteValue:"absolute-value",multiplier:"multiplier"});const s=new Map([["basic-grid","basic-grid"],["geographic-organic-standard","geographic-organic-standard"],["hierarchical-bottom-to-top","hierarchical-bottom-to-top"],["hierarchical-top-to-bottom","hierarchical-bottom-to-top"],["organic-community","organic-community"],["organic-fusiform","organic-standard"],["organic-leaf-circle","organic-standard"],["organic-standard","organic-standard"],["radial-node-centric","radial-root-centric"],["radial-root-centric","radial-root-centric"],["tree-bottom-to-top","tree-left-to-right"],["tree-left-to-right","tree-left-to-right"],["tree-right-to-left","tree-left-to-right"],["tree-top-to-bottom","tree-left-to-right"],["chronological-mono-timeline","chronological-mono-timeline"],["chronological-multi-timeline","chronological-multi-timeline"]]);var o=r(6560),a=r(35380);r(89465),r(86875),r(86659);function l(e,t){const r=new Map;if(t.dataModel?.relationshipTypes)for(const i of t.dataModel.relationshipTypes)i.name&&r.set(i.name,[]);for(const i of e)r.has(i.typeName)&&r.get(i.typeName)?.push(i.id);return r}async function p(e,t,r){const i=[],n=l(e,t),s={},p=[];for(const[o,a]of n){if(a.length<1)continue;const e=`${o}_ids`;s[e]=a,p.push(`MATCH (n)-[r:${o}]->(m) WHERE id(r) in $${e} RETURN id(n), labels(n)[0], id(m), labels(m)[0]`)}if(0===p.length)return[];const d=p.join(" UNION "),u=new a.A({openCypherQuery:d,bindParameters:s}),c=(await(0,o.executeQueryStreaming)(t,u,r?.requestOptions)).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await c.read();if(e)break;for(const r of t)i.push({id:r[0],typeName:r[1]}),i.push({id:r[2],typeName:r[3]})}return i}const d=e=>s.get(e)??"radial-root-centric";function u(e){if(!e.spatialReference.isWGS84)throw new i.A("knowledge-graph:layer-support-utils","The utilsExtentToInBoundsRings function only supports WGS84 spatial references.");return e.clone().normalize().map(e=>[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]])}},9505:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(6326),n=r(46053),s=(r(81806),r(76460),r(47249),r(87990)),o=r(19247),a=r(27544);let l=class extends a.A{constructor(e){super(e),this.layoutGeometry=null}};(0,i.Cg)([(0,n.MZ)({type:o.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,i.Cg)([(0,s.$)("esri.rest.knowledgeGraph.Entity")],l)},12831:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(6326),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(87990));let a=class extends n.o{constructor(e){super(e),this.properties=null}};(0,i.Cg)([(0,s.MZ)({json:{write:!0}})],a.prototype,"properties",void 0),a=(0,i.Cg)([(0,o.$)("esri.rest.knowledgeGraph.GraphObject")],a)},21009:(e,t,r)=>{r.d(t,{BL:()=>l,Cz:()=>n,KQ:()=>s,M1:()=>a,T1:()=>o,dr:()=>i});const i="ESRI__ID",n="ESRI__OriginID",s="ESRI__DestID",o="ESRI__LayoutGeometry",a="ESRI__AggregationCount",l="LC.ESRI__IsSpatial"},23908:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(6326),n=r(46053),s=(r(81806),r(76460),r(47249),r(87990)),o=r(23701),a=r(27544);let l=class extends a.A{constructor(e){super(e),this.originId=null,this.destinationId=null,this.layoutGeometry=null}};(0,i.Cg)([(0,n.MZ)({type:String,json:{write:!0}})],l.prototype,"originId",void 0),(0,i.Cg)([(0,n.MZ)({type:String,json:{write:!0}})],l.prototype,"destinationId",void 0),(0,i.Cg)([(0,n.MZ)({type:o.A,json:{write:!0}})],l.prototype,"layoutGeometry",void 0),l=(0,i.Cg)([(0,s.$)("esri.rest.knowledgeGraph.Relationship")],l)},27544:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(6326),n=r(46053),s=(r(81806),r(76460),r(47249),r(87990)),o=r(12831);let a=class extends o.A{constructor(e){super(e),this.typeName=null,this.id=null}};(0,i.Cg)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"typeName",void 0),(0,i.Cg)([(0,n.MZ)({type:String,json:{write:!0}})],a.prototype,"id",void 0),a=(0,i.Cg)([(0,s.$)("esri.rest.knowledgeGraph.GraphNamedObject")],a)},33750:(e,t,r)=>{r.d(t,{A:()=>a});var i=r(19902),n=r(98618),s=r(20176),o=r(21009);class a{constructor(){this._featureLookup=new Map}static getInstance(){return a.instance||(a.instance=new a),a.instance}static resetInstance(){a.instance&&(a.instance=null)}deleteFromStore(e){e.forEach(e=>{this._featureLookup.delete(e)})}readFromStoreByList(e){const t=[];return e.forEach(e=>{const r=this.readFromStoreById(e);r&&t.push(r)}),t}readFromStoreById(e){return this._featureLookup.get(e)??null}writeToStore(e,t,r){const a=[];return e.forEach(e=>{if(!e?.id)return;e.properties||(e.properties=[]);let l,p=null;if(r&&e.properties[r]&&(p=(0,n.Ux)(e.properties[r])),"originId"in e&&"destinationId"in e&&(e.properties[o.Cz]=e.originId,e.properties[o.KQ]=e.destinationId),e.properties[t]=e.id,e.id&&this._featureLookup.has(e.id)&&this._featureLookup.get(e.id).attributes){const n=this._featureLookup.get(e.id),o=JSON.parse(JSON.stringify(Object.assign(n.attributes,e.properties)));r&&e.properties[r]&&(o[r]=(0,i.rS)(e.properties[r])),l=new s.Om(p?JSON.parse(JSON.stringify(p)):n?.geometry?JSON.parse(JSON.stringify(n.geometry)):null,o,null,e.properties[t])}else l=new s.Om(p?JSON.parse(JSON.stringify(p)):null,e.properties,null,e.properties[t]);this._featureLookup.set(`${e.typeName?`${e.typeName}__${e.id}`:e.id}`,l),a.push(l)}),a}}},35380:(e,t,r)=>{r.d(t,{A:()=>p});var i=r(6326),n=r(46053),s=(r(81806),r(76460),r(47249),r(87990)),o=r(13312),a=r(91967);let l=class extends a.A{constructor(e){super(e),this.openCypherQuery=""}};(0,i.Cg)([(0,n.MZ)()],l.prototype,"openCypherQuery",void 0),l=(0,i.Cg)([(0,s.$)("esri.rest.knowledgeGraph.GraphQuery")],l);let p=class extends l{constructor(e){super(e),this.bindParameters=null,this.bindGeometryQuantizationParameters=null,this.outputQuantizationParameters=null,this.outputSpatialReference=null,this.provenanceBehavior=null}};(0,i.Cg)([(0,n.MZ)()],p.prototype,"bindParameters",void 0),(0,i.Cg)([(0,n.MZ)()],p.prototype,"bindGeometryQuantizationParameters",void 0),(0,i.Cg)([(0,n.MZ)()],p.prototype,"outputQuantizationParameters",void 0),(0,i.Cg)([(0,n.MZ)({type:o.A})],p.prototype,"outputSpatialReference",void 0),(0,i.Cg)([(0,n.MZ)()],p.prototype,"provenanceBehavior",void 0),p=(0,i.Cg)([(0,s.$)("esri.rest.knowledgeGraph.GraphQueryStreaming")],p)},38156:(e,t,r)=>{r.d(t,{A:()=>o});var i=r(6326),n=(r(76460),r(81806),r(47249),r(50076),r(87990)),s=r(12831);let o=class extends s.A{constructor(e){super(e)}};o=(0,i.Cg)([(0,n.$)("esri.rest.knowledgeGraph.ObjectValue")],o)},40296:(e,t,r)=>{r.d(t,{F0:()=>a,Vx:()=>d,e2:()=>c,f:()=>y});var i=r(81806),n=r(53084),s=r(8298),o=r(44460);function a(e){return{renderer:{type:"simple",symbol:"esriGeometryPoint"===e||"esriGeometryMultipoint"===e?o.Cb:"esriGeometryPolyline"===e?o.yM:o.WR}}}const l=/^[_$a-zA-Z][_$a-zA-Z0-9]*$/;let p=1;function d(e,t){if((0,i.A)("esri-csp-restrictions"))return()=>({[t]:null,...e});try{let r=`this${u(t)} = null;`;for(const t in e)r+=`this${u(t)} = ${JSON.stringify(e[t])};`;const i=new Function(`\n      return class AttributesClass$${p++} {\n        constructor() {\n          ${r};\n        }\n      }\n    `)();return()=>new i}catch(r){return()=>({[t]:null,...e})}}function u(e){return l.test(e)?`.${e}`:`["${e}"]`}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return[{name:"New Feature",description:"",prototype:{attributes:(0,n.o8)(e)}}]}function y(e,t){return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:e},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:t,supportsDelete:t,supportsEditing:t,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!0,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:t,supportsExceedsLimitStatistics:!0,supportsAsyncConvert3D:!1},query:s.F,queryRelated:{supportsCount:!0,supportsOrderBy:!0,supportsPagination:!0,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:s.P,editing:{supportsGeometryUpdate:t,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},45495:(e,t,r)=>{r.d(t,{P:()=>I});var i=r(6326),n=r(91967),s=r(50076),o=r(76460),a=r(87663),l=r(50346),p=r(34154),d=r(46053),u=(r(81806),r(47249),r(87990)),c=r(76797),y=r(65215),h=r(56611),g=r(80963),m=r(21009);const f=(e,t)=>{if("column-reference"===e.type)return e.column===t.systemOidFieldName?"ID(n)":`n.${e.column}`;if("string"===e.type)return`'${e.value}'`;if("number"===e.type)return`${e.value}`;if("binary-expression"===e.type&&t.supportedSqlTypes.has(e.left.type)&&t.supportedSqlTypes.has(e.right.type)&&t.supportedSqlOperators.has(e.operator))return`${f(e.left,t)} ${e.operator} ${f(e.right,t)}`;if("binary-expression"===e.type&&"LIKE"===e.operator){let r="";if("function"===e.left.type&&"column-reference"===e.left.args.value[0].type)r+=`lower(n.${e.left.args.value[0].column})`;else{if("column-reference"!==e.left.type)return t.unsupportedOperationFound=!0,"";r+=`lower(n.${e.left.column})`}if(r+=" CONTAINS (","string"!==e.right.type)return t.unsupportedOperationFound=!0,"";{let t=e.right.value;t.startsWith("%")&&(t=t.slice(1)),t.endsWith("%")&&(t=t.slice(0,-1)),r+=`'${t.toLowerCase()}')`}return r}return t.unsupportedOperationFound=!0,""};var b=r(33750),w=r(8893),T=r(6560),C=r(35380),M=r(97015);let I=class extends n.A{constructor(e){super(e),this._processingCacheUpdatesLookup=new Map,this.knowledgeGraph=null,this.inclusionModeDefinition={generateAllSublayers:!0,namedTypeDefinitions:new Map},this.entityTypeNames=new Set,this.relationshipTypeNames=new Set,this.geographicLookup=new Map,this.sublayerCaches=new Map,this.nodeConnectionsLookup=new Map,this.relationshipConnectionsLookup=new Map,this.memberIdTypeLookup=new Map;const t=new Map;e.knowledgeGraph.dataModel.entityTypes?.forEach(r=>{r.name&&(t.set(r.name,"entity"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.entityTypeNames.add(r.name),r.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.knowledgeGraph.dataModel.relationshipTypes?.forEach(r=>{r.name&&(t.set(r.name,"relationship"),this._processingCacheUpdatesLookup.set(r.name,[]),e.inclusionModeDefinition&&!e.inclusionModeDefinition?.generateAllSublayers||this.relationshipTypeNames.add(r.name),r.properties?.forEach(e=>{e.geometryType&&"esriGeometryNull"!==e.geometryType&&this.geographicLookup.set(r.name,{name:e.name??"",geometryType:e.geometryType})}))}),e.inclusionModeDefinition?.namedTypeDefinitions.forEach((r,i)=>{if("entity"===t.get(i))this.entityTypeNames.add(i);else{if("relationship"!==t.get(i))return o.A.getLogger(this).warn(`A named type, ${i}, was in the inclusion list that wasn't in the data model and will be removed`),void e.inclusionModeDefinition?.namedTypeDefinitions.delete(i);this.relationshipTypeNames.add(i)}const n=new Map;r.members?.forEach(e=>{(0,a.tE)(this.memberIdTypeLookup,e.id,()=>new Set).add(i)}),this.sublayerCaches.set(i,n)})}addToLayer(e){e.forEach(e=>{let{typeName:t,id:r}=e;if(!this.inclusionModeDefinition)throw new s.A("knowledge-graph:layer-data-manager","You cannot add to a layer's exclusion list if it was not created with an exclusion list originally");if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){if(this.inclusionModeDefinition.namedTypeDefinitions.has(t)){const e=this.inclusionModeDefinition.namedTypeDefinitions.get(t);e.members||(e.members=new Map),e.members.set(r,{id:r}),(0,a.tE)(this.memberIdTypeLookup,r,()=>new Set).add(t)}}else{const e=new Map;e.set(r,{id:r}),this.inclusionModeDefinition.namedTypeDefinitions.set(t,{useAllData:!1,members:e}),(0,a.tE)(this.memberIdTypeLookup,r,()=>new Set).add(t)}})}getById(e){return b.A.getInstance().readFromStoreById(e)}async getData(e,t,r){if(t.objectType.name&&this.inclusionModeDefinition?.namedTypeDefinitions&&this.inclusionModeDefinition.namedTypeDefinitions.size>0&&!this.inclusionModeDefinition.namedTypeDefinitions.has(t.objectType.name))return[];let i;if(i=e||new M.A({where:"1=1",outFields:["*"]}),"link-chart"===t.parentCompositeLayer.type){const e=t.parentCompositeLayer,r=this._processingCacheUpdatesLookup.get(t.objectType.name??""),n=i.outFields;n&&1===n.length&&n[0]===m.dr&&"1=1"===i.where||await Promise.all(r??[]);const s=this.sublayerCaches.has(t.objectType.name??"")?Array.from(this.sublayerCaches.get(t.objectType.name)?.values()):[],o=[];return s.forEach(r=>{if(this.relationshipTypeNames.has(t.objectType.name)){r.geometry=e.relationshipLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);const i=this.memberIdTypeLookup.get(r.attributes[m.Cz]),n=this.memberIdTypeLookup.get(r.attributes[m.KQ]),s=this._isEndEntitySpatial(i,r,m.Cz),o=this._isEndEntitySpatial(n,r,m.KQ);r.attributes[m.BL]=Number(s&&o)}else{r.geometry=e.entityLinkChartDiagramLookup.get(r.attributes[t.objectIdField]);const i=this.geographicLookup.get(t.objectType.name);i&&r.attributes[i.name]?r.attributes[m.BL]=1:r.attributes[m.BL]=0}r.attributes[m.T1]=r.geometry,o.push(r)}),o}return this.retrieveDataFromService(i,t,r)}async getConnectedRecordIds(e,t,r){const i=[];let n="";const s=this._getNamedTypeIdMapFromNodeIds(e);if(t&&0!==t?.length){for(const e of t)n=n+e+"|";n=n.slice(0,-1)}const o={},a=[];for(const[d,u]of s){const e=`${d}_ids`;o[e]=u,t&&0!==t?.length?a.push(`MATCH (n:${d}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r:${n}]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`):a.push(`MATCH (n:${d}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]-(m) RETURN id(r), type(r), id(m), labels(m)[0]`)}if(!a.length)return i;const l=a.join(" UNION "),p=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new C.A({openCypherQuery:l,bindParameters:o}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(let r=0;r<t.length;r++){const e=t[r];i.push({id:e[0],typeName:e[1]}),i.push({id:e[2],typeName:e[3]})}}return i}async getRelationshipsBetweenNodes(e,t,r){const i=this._getNamedTypeIdMapFromNodeIds(e);if(0===i.size)return[];const n={relationshipExclusionIds:t,possibleConnectionEntityIds:e},s=[];for(const[p,d]of i.entries()){const e=`${p}_ids`;n[e]=d,s.push(`MATCH (n:${p}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]->(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const o=s.join(" UNION "),a=[],l=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new C.A({openCypherQuery:o,bindParameters:n}),{signal:r?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await l.read();if(e)break;for(let r=0;r<t.length;r++){const e=t[r];a.push({id:e[0],typeName:e[1]})}}return a}async getRelationshipsFromNodes(e,t,r,i){const n=this._getNamedTypeIdMapFromNodeIds(e);if(0===n.size||0===t.length)return[];const s={relationshipExclusionIds:r,possibleConnectionEntityIds:t},o=[];for(const[u,c]of n.entries()){const e=`${u}_ids`;s[e]=c,o.push(`MATCH (n:${u}) WHERE id(n) IN $${e} WITH n MATCH (n)-[r]-(m) WHERE id(m) IN $possibleConnectionEntityIds AND NOT id(r) IN $relationshipExclusionIds RETURN id(r), type(r)`)}const a=o.join(" UNION "),l=new Map,p=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,new C.A({openCypherQuery:a,bindParameters:s}),{signal:i?.signal})).resultRowsStream.getReader();for(;;){const{done:e,value:t}=await p.read();if(e)break;for(let r=0;r<t.length;r++){const e=t[r];let i=l.get(e[1]);i||(i=new Set,l.set(e[1],i)),i.add(e[0])}}const d=[];for(const[u,c]of l)for(const e of c)d.push({id:e,typeName:u});return d}async refreshCacheContent(e,t,r){let i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],n=arguments.length>4?arguments[4]:void 0;const o=b.A.getInstance(),p=[],d=new Map,u=new Map;this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&u.set(e.name,e)}),this.knowledgeGraph.dataModel.relationshipTypes?.forEach(e=>{e.name&&u.set(e.name,e)}),e||this.inclusionModeDefinition?e?e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(const t of this.memberIdTypeLookup.get(e))d.has(t)?d.get(t)?.push(e):d.set(t,[e])}):this.inclusionModeDefinition?.namedTypeDefinitions?.forEach((e,t)=>{e.useAllData?d.set(t,null):e.members&&e.members.forEach(e=>{d.has(t)&&null!==d.get(t)?d.get(t)?.push(e.id):d.set(t,[e.id])})}):(this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&d.set(e.name,null)}),this.knowledgeGraph.dataModel.entityTypes?.forEach(e=>{e.name&&d.set(e.name,null)}));for(const[l,c]of d){const e=new Set(c),d=new Promise((p,d)=>{(async()=>{const p=new Set,d=[];let y,h="",g=!1;if(t||u.get(l)?.properties?.forEach(e=>{e.name&&p.add(e.name)}),r&&this.geographicLookup.has(l)){const e=this.geographicLookup.get(l)?.name;e&&p.add(e)}if(this.entityTypeNames.has(l))h=`MATCH (n:${l}) ${c?"WHERE id(n) IN $ids ":""}return ID(n)`,p.forEach(e=>{h+=`, n.${e}`,d.push(e)});else{if(!this.relationshipTypeNames.has(l))throw new s.A("knowledge-graph:layer-data-manager",`The graph type of ${l} could not be determined. Was this type set in the KG data model and inclusion definition?`);g=!0,h=`MATCH ()-[n:${l}]->() ${c?"WHERE id(n) IN $ids ":""}return ID(n), id(startNode(n)), id(endNode(n))`,p.forEach(e=>{h+=`, n.${e}`,d.push(e)})}y=new C.A(c?{openCypherQuery:h,bindParameters:{ids:c}}:{openCypherQuery:h});const f=(await(0,T.executeQueryStreaming)(this.knowledgeGraph,y,{signal:n?.signal})).resultRowsStream.getReader();for(;;){const{done:t,value:r}=await f.read();if(t)break;const n=[];for(let i=0;i<r.length;i++){const t=r[i];let s=0,o=0;const l={properties:{}};for(l.id=t[s],s++,o++,g&&(l.originId=t[s],s++,o++,l.destinationId=t[s],s++,o++,(0,a.tE)(this.nodeConnectionsLookup,l.originId,()=>new Set).add(l.id),(0,a.tE)(this.nodeConnectionsLookup,l.destinationId,()=>new Set).add(l.id),(0,a.tE)(this.relationshipConnectionsLookup,l.id,()=>[l.originId,l.destinationId]));s<t.length;s++)l.properties[d[s-o]]=t[s];e.delete(l.id),n.push(l)}const s=o.writeToStore(n,m.dr,this.geographicLookup.get(l)?.name);this.sublayerCaches.has(l)||this.sublayerCaches.set(l,new Map),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.has(l)&&this.inclusionModeDefinition?.namedTypeDefinitions.set(l,{useAllData:!1,members:new Map}),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members&&(this.inclusionModeDefinition.namedTypeDefinitions.get(l).members=new Map);const p=this.sublayerCaches.get(l);s.forEach(e=>{p?.set(e.attributes[m.dr],e),i&&!this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.has(e.attributes[m.dr])&&(this.inclusionModeDefinition?.namedTypeDefinitions.get(l).members.set(e.attributes[m.dr],{id:e.attributes[m.dr]}),(0,a.tE)(this.memberIdTypeLookup,e.attributes[m.dr],()=>new Set).add(l))})}const b=this.inclusionModeDefinition?.namedTypeDefinitions.get(l);if(b)for(const t of e)b.members?.delete(t)})().then(()=>{p(null)}).catch(e=>{"AbortError"===e.name?p(null):d(e)})});p.push(d),this._processingCacheUpdatesLookup.get(l)?.push(d)}if(await Promise.all(p),n?.signal?.aborted)throw(0,l.NK)()}removeFromLayer(e){const t=new Set,r=new Set(e.map(e=>e.id));for(const i of e)t.add(i.typeName),1===this.memberIdTypeLookup.get(i.id)?.size?this.memberIdTypeLookup.delete(i.id):this.memberIdTypeLookup.get(i.id)?.delete(i.typeName),this.inclusionModeDefinition?.namedTypeDefinitions.forEach((e,t)=>{t===i.typeName&&e.members?.has(i.id)&&e.members.delete(i.id)});t.forEach(e=>{this.sublayerCaches.get(e)?.forEach((t,i)=>{r.has(i)&&this.sublayerCaches.get(e)?.delete(i)})})}async retrieveDataFromService(e,t,r){const i=b.A.getInstance(),n=new Set,o=[];let a,l="",d=[];const u="relationship"===t.graphType,M=this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData,I=t.parentCompositeLayer.sublayerIdsCache.get(t.objectType.name);let v=!M&&I?Array.from(I).sort():null;if(this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData)this.inclusionModeDefinition?.namedTypeDefinitions?.get(t.objectType.name)?.useAllData&&null!=e.objectIds&&(v=e.objectIds);else if(null!=e.objectIds&&v&&v.length>0){const t=e.objectIds;e.objectIds=v.filter(e=>t.includes(e))}else if(null!=e.objectIds)v=e.objectIds;else{if(this.inclusionModeDefinition?.namedTypeDefinitions.has(t.objectType.name)&&(!this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members||this.inclusionModeDefinition.namedTypeDefinitions.get(t.objectType.name)?.members?.size<1))return e.objectIds=[],[];e.objectIds=v}if(null!=e.outFields){const r=e.outFields;r.includes("*")?t.fields.forEach(e=>{n.add(e.name)}):r.forEach(e=>{e!==m.dr&&e!==t.geometryFieldName&&n.add(e)})}if(null!=e.geometry){const r=e.geometry;let i;const d=t.parentCompositeLayer.dataManager.knowledgeGraph.serviceDefinition,m=d?.spatialReference,f=d?.serviceCapabilities?.geometryCapabilities;let b=f?.geometryMaxBoundingRectangleSizeX,T=f?.geometryMaxBoundingRectangleSizeY;if("point"===r.type){let e=r;e.spatialReference?.isWGS84||(await(0,h.initializeProjection)(e.spatialReference,g.KK),e=(0,h.project)(e,g.KK)),i=new c.A({spatialReference:g.KK,xmin:e.x-1e-4,ymin:e.y-1e-4,xmax:e.x+1e-4,ymax:e.y+1e-4})}else r?.extent?.spatialReference&&!r.spatialReference?.isWGS84?(await(0,h.initializeProjection)(r.extent.spatialReference,g.KK),i=(0,h.project)(r.extent,g.KK)):i=r.extent;if(b&&T&&m){if(4326!==m.wkid){const e=new c.A({spatialReference:m,xmax:b,ymax:T}),t=(0,h.project)(e,g.KK);b=t.xmax,T=t.ymax}if(i.xmax-i.xmin>b)throw new s.A("knowledge-graph:layer-data-manager",`Extent x bounds should be within ${b}\xb0 latitude, limit exceeded`);if(i.ymax-i.ymin>T)throw new s.A("knowledge-graph:layer-data-manager",`Extent y bounds should be within ${T}\xb0 longitude, limit exceeded`)}if(null!=e.where&&"1=1"!==e.where){const r=await(0,p.GP)(e.where.toUpperCase(),t.fieldsIndex);t.fields.forEach(e=>{r.fieldNames.includes(e.name)&&n.add(e.name)})}l=u?`Match ()-[n:${t.objectType.name}]->() WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n), id(startNode(r)), id(endNode(r))`:`Match (n:${t.objectType.name}) WHERE esri.graph.ST_Intersects($param_filter_geom, n.${t.geometryFieldName}) return ID(n)`,t.geometryFieldName&&n.add(t.geometryFieldName),n.forEach(e=>{l+=`, n.${e}`,o.push(e)}),a=new C.A({openCypherQuery:l,bindParameters:{param_filter_geom:new y.A({rings:(0,w.Wq)(i)})}})}else{let r="";if(null!=e.where&&"1=1"!==e.where){const i=await(0,p.GP)(e.where,t.fieldsIndex);t.fields.forEach(e=>{i.fieldNames.includes(e.name)&&n.add(e.name)});const s={systemOidFieldName:m.dr,supportedSqlTypes:new Set(["column-reference","string","number","binary-expression"]),supportedSqlOperators:new Set(["=","<","<=","<>",">",">=","AND","OR","LIKE"]),unsupportedOperationFound:!1};r=f(i.parseTree,s),s.unsupportedOperationFound&&(r="")}let i="";i=u?`Match ()-[n:${t.objectType.name}]->()`:`Match (n:${t.objectType.name})`;let s=!1;v&&(s=!0,i+=" WHERE ID(n) IN $ids"),r&&(i+=s?" AND":" WHERE",i+=` ${r}`),i+=" return ID(n)",u&&(i+=", id(startNode(n)), id(endNode(n))"),e.returnGeometry&&t.geometryFieldName&&n.add(t.geometryFieldName),n.forEach(e=>{i+=`, n.${e}`,o.push(e)}),a=new C.A(v?{openCypherQuery:i,bindParameters:{ids:v}}:{openCypherQuery:i})}const A=(await(0,T.executeQueryStreaming)(t.parentCompositeLayer.dataManager.knowledgeGraph,a,r)).resultRowsStream.getReader();for(;;){const{done:e,value:r}=await A.read();if(e)break;const n=[];for(let t=0;t<r.length;t++){const e=r[t];let i=0,s=0;const a={properties:{}};for(a.id=e[i],i++,s++,u&&(a.originId=e[i],i++,s++,a.destinationId=e[i],i++,s++);i<e.length;i++)a.properties[o[i-s]]=e[i];n.push(a)}d=d.concat(i.writeToStore(n,m.dr,t.parentCompositeLayer.dataManager.geographicLookup.get(t.objectType.name)?.name))}return d}_isEndEntitySpatial(e,t,r){for(const i of e??[])if(this.entityTypeNames.has(i)){const e=this.geographicLookup.get(i),n=e&&this.sublayerCaches.get(i)?.get(t.attributes[r]);if(e&&n?.attributes[e.name])return!0}return!1}_getNamedTypeIdMapFromNodeIds(e){const t=new Map;return e.forEach(e=>{if(this.memberIdTypeLookup.has(e))for(const r of this.memberIdTypeLookup.get(e)){if(!this.entityTypeNames.has(r))return;t.has(r)?t.get(r)?.push(e):t.set(r,[e])}}),t}};(0,i.Cg)([(0,d.MZ)()],I.prototype,"knowledgeGraph",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"inclusionModeDefinition",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"entityTypeNames",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"relationshipTypeNames",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"geographicLookup",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"sublayerCaches",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"nodeConnectionsLookup",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"relationshipConnectionsLookup",void 0),(0,i.Cg)([(0,d.MZ)()],I.prototype,"memberIdTypeLookup",void 0),I=(0,i.Cg)([(0,u.$)("esri.layers.knowledgeGraph.KnowledgeGraphLayerDataManager")],I)},61064:(e,t,r)=>{r.d(t,{Gz:()=>P,O9:()=>$,hZ:()=>G,CP:()=>U,dD:()=>q,UT:()=>R,MY:()=>F,Td:()=>x,iW:()=>O,e$:()=>j,qN:()=>L});var i=r(69539),n=r(87663),s=(r(54373),r(87444));r(41968),r(36939),r(55884),r(26907);const o=s.A;var a=r(95278),l=r(56611),p=r(13312),d=r(1438),u=r(8298),c=r(21009),y=r(15427),h=r(95114),g=r(57491),m=r(31933),f=r(6560),b=r(9505),w=r(6326),T=r(91967),C=r(46053),M=(r(81806),r(76460),r(47249),r(87990));let I=class extends T.A{constructor(e){super(e),this.entityAdds=void 0,this.entityUpdates=void 0,this.entityDeletes=void 0,this.relationshipAdds=void 0,this.relationshipUpdates=void 0,this.relationshipDeletes=void 0,this.options=void 0}};(0,w.Cg)([(0,C.MZ)()],I.prototype,"entityAdds",void 0),(0,w.Cg)([(0,C.MZ)()],I.prototype,"entityUpdates",void 0),(0,w.Cg)([(0,C.MZ)()],I.prototype,"entityDeletes",void 0),(0,w.Cg)([(0,C.MZ)()],I.prototype,"relationshipAdds",void 0),(0,w.Cg)([(0,C.MZ)()],I.prototype,"relationshipUpdates",void 0),(0,w.Cg)([(0,C.MZ)()],I.prototype,"relationshipDeletes",void 0),(0,w.Cg)([(0,C.MZ)()],I.prototype,"options",void 0),I=(0,w.Cg)([(0,M.$)("esri.rest.knowledgeGraph.GraphApplyEdits")],I);var v=r(23908),A=r(85632),E=r(89465),_=r(86659);const N={initializeLayersFromClientData:async(e,t,r)=>{if(t||(t=[...e.layers,...e.tables].map(e=>e.graphTypeName)),0===t?.length)return;const i=new Map;for(const s of t)i.set(s,S(e,s));const n=await(0,f.fetchClientDataAtKeys)(e.dataManager.knowledgeGraph,Array.from(i.values()),{requestOptions:{signal:r?.signal}});for(const s of[...e.layers,...e.tables]){const t=s.objectType.name;if(null==t)continue;const r=n.get(S(e,t));if(r){const e=JSON.parse(r);null===e||"object"!=typeof e||e.hasOwnProperty("showLabels")||(e.showLabels=!1),s.read(e,{origin:"service"})}}}},S=(e,t)=>"knowledge-graph"===e.type?`${t}/Map`:`${t}/LinkChart/LinkChartSubLayer`;async function L(e,t,r){return N.initializeLayersFromClientData(e,t,r)}const k=["#4a0932","#b31515","#18382e","#a64f1b","#102432","#8c213f","#ed9310","#2c6954","#144d59","#ffc730","#75351e","#454f4b","#78b1c2","#191921","#8f8f82","#9be0c0","#dbb658","#87b051","#11495c","#c43541","#9c5596","#44498b","#ad9d63","#86afb3","#5c98ca","#b0bfa2","#73241f","#b86b53","#d9d78c","#3e756d","#f260a1","#a0d17d","#c27c30","#eb82eb","#ffdf3c","#ffb259","#ab52b3","#3cccb4","#0095ba","#d92b30"],D="#8f8f82";function x(e){return e<0||e>=k.length?new i.A(D):new i.A(k[e])}function R(e){const t=e.toArray();return new E.A({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,style:"solid",width:.75,color:t},{type:"CIMVectorMarker",enable:!0,size:6,markerPlacement:{type:"CIMMarkerPlacementOnLine",angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-10,ymin:-5,xmax:0,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[-12,-3.47],[-12,3.6],[1.96,-.03],[-12,-3.47]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:t}]}}]}]}}})}function F(e){let t="ESRI__ID",r=4;for(const i of e)if(i.name){if("name"===i.name.toLowerCase()){t=i.name;break}i.name.toLowerCase().includes("name")?(t=i.name,r=2):"esriFieldTypeString"===i.fieldType&&r>3&&(t=i.name,r=3)}return t}function O(e,t,r){const i={color:[80,80,80],haloColor:[255,255,255],haloSize:.7,font:{size:10,weight:"normal"}},n=new h.A({labelExpressionInfo:new g.A({expression:"ESRI__ID"===r?`${t}`:`$feature.${r}`}),labelPlacement:"above-center",symbol:new _.A(i)}),s=new h.A({labelExpressionInfo:new g.A({expression:`'${t}' + IIf($feature.ESRI__AggregationCount>1, ' (' + $feature.ESRI__AggregationCount + ')', '')`}),labelPlacement:"center-along",labelPosition:"parallel",repeatLabel:!1,symbol:new _.A({...i,yoffset:"12px"})});return"entity"===e?[n]:[s]}function j(e,t,r){const i={color:[255,255,255],haloColor:[0,0,0],haloSize:.7,font:{size:10,weight:"bold"}},n="ESRI__ID"===r?`${e}`:`$feature.${r}`;return"point"===t?[new h.A({labelExpressionInfo:new g.A({expression:n}),labelPlacement:"above-center",symbol:new _.A(i)})]:"polyline"===t?[new h.A({labelExpressionInfo:new g.A({expression:n}),labelPlacement:"center-along",repeatLabel:!0,symbol:new _.A(i)})]:"polygon"===t?[new h.A({labelExpressionInfo:new g.A({expression:n}),labelPlacement:"always-horizontal",symbol:new _.A(i)})]:null}const Z={capabilities:[],allowGeometryUpdates:!1,serviceCapabilities:{geometryCapabilities:{supportsZValues:!1,supportsMValues:!1}}};function G(e){const{capabilities:t,allowGeometryUpdates:r,serviceCapabilities:{geometryCapabilities:{supportsZValues:i,supportsMValues:n}}}=e?.serviceDefinition||Z,s=e?.dataModel.arcgisManaged?t:t.filter(e=>"Query"===e),o=new Set(s);return{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:n,supportsZ:i},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:o.has("Create"),supportsDelete:o.has("Delete"),supportsEditing:o.has("Editing"),supportsChangeTracking:!1,supportsQuery:o.has("Query"),supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:o.has("Update"),supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:u.F,queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},queryAttributeBins:u.P,editing:{supportsGeometryUpdate:!!e?.dataModel.arcgisManaged&&r,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:o.has("Delete"),supportsUpdateByAnonymous:!1,supportsUpdateByOthers:o.has("Update"),supportsAsyncApplyEdits:!1,zDefault:void 0}}}async function $(e,t){const r=new I,i=t.graphTypeName,s=t.graphType,o="knowledge-graph"===t.parentCompositeLayer.type?t.geometryFieldName:null,a=!!t.fieldsIndex.get(o)?.editable,u=e=>{const r={...e};for(const i of t.fields)i.editable||delete r[i.name];for(const t of Object.keys(e))t.includes("ESRI__")&&delete r[t];return r},y=async e=>{await(0,l.initializeProjection)(e.spatialReference,p.A.WGS84);const t=(0,l.project)(e,p.A.WGS84);return"point"===t.type?t.normalize():(await(0,d.el)(t))[0]};for(const n of e.addFeatures??[]){const e=u(n.attributes);(0,m.UC)(n.sourceLayer)&&n.sourceLayer.graphTypeName===i&&("entity"===s?(r.entityAdds||(r.entityAdds=[]),o&&n.geometry&&(e[o]=await y(n.geometry)),r.entityAdds.push(new b.A({properties:e,typeName:i}))):(r.relationshipAdds||(r.relationshipAdds=[]),r.relationshipAdds.push(new v.A({properties:e,typeName:i}))))}for(const n of e.updateFeatures??[]){const e=n.attributes[c.dr],t=u(n.attributes);(0,m.UC)(n.sourceLayer)&&n.sourceLayer.graphTypeName===i&&("entity"===s?(r.entityUpdates||(r.entityUpdates=[]),o&&a&&n.geometry&&(t[o]=await y(n.geometry)),r.entityUpdates.push(new b.A({id:e,properties:t,typeName:i}))):(r.relationshipUpdates||(r.relationshipUpdates=[]),r.relationshipUpdates.push(new v.A({id:e,properties:t,typeName:i}))))}const h=new Map;for(const l of e.deleteFeatures??[])if((0,A.DU)(l)){const e=l,t=(0,n.tE)(h,e.sourceLayer.graphTypeName,()=>({typeName:e.sourceLayer.graphTypeName,ids:[]}));e.sourceLayer.graphTypeName===i&&t.ids.push(e.attributes[c.dr])}else l.objectId&&"string"==typeof l.objectId&&(0,n.tE)(h,i,()=>({typeName:i,ids:[]})).ids.push(l.objectId);for(const n of h.values())n.ids.length>0&&("entity"===s?(r.entityDeletes||(r.entityDeletes=[]),r.entityDeletes.push({typeName:n.typeName,ids:n.ids})):(r.relationshipDeletes||(r.relationshipDeletes=[]),r.relationshipDeletes.push({typeName:n.typeName,ids:n.ids})));return r}function P(e,t){const r={addFeatureResults:[],updateFeatureResults:[],deleteFeatureResults:[],addAttachmentResults:[],updateAttachmentResults:[],deleteAttachmentResults:[]};for(const i of e.editResults)if(i.typeName===t){for(const e of i.adds)r.addFeatureResults.push({objectId:e.id,globalId:e.id});for(const e of i.updates)r.updateFeatureResults.push({objectId:e.id,globalId:e.id});for(const e of i.deletes)r.deleteFeatureResults.push({objectId:e.id,globalId:e.id})}return r}function q(e){if(!e.objectType)return null;const t=[];for(const r of e.fields)!r.name.includes("ESRI__")&&r.editable&&"geometry"!==r.type&&t.push(new o({fieldName:r.name}));return new a.A({elements:t})}function U(e){if(!e.objectType)return null;let t=null;switch(e.geometryType){case"point":case"multipoint":t="point";break;case"polyline":t="line";break;case"polygon":t="polygon";break;default:t=null}return[new y.A({name:e.graphTypeName,drawingTool:t,prototype:{}})]}},63733:(e,t,r)=>{r.d(t,{A:()=>c});var i=r(6326),n=r(46053),s=(r(81806),r(76460),r(47249),r(87990)),o=r(5364),a=r(25515),l=r(65624),p=r(5682),d=r(64519),u=r(731);let c=class extends((0,l.dM)((0,p.j)(a.A))){constructor(e){super(e),this.elevationInfo=null,this.graphics=new d.Y,this.screenSizePerspectiveEnabled=!0,this.type="graphics",this.internal=!1}destroy(){this.removeAll(),this.graphics.destroy()}get loaded(){return super.loaded}add(e){return this.graphics.add(e),this}addMany(e){return this.graphics.addMany(e),this}removeAll(){return this.graphics.removeAll(),this}remove(e){this.graphics.remove(e)}removeMany(e){this.graphics.removeMany(e)}graphicChanged(e){this.emit("graphic-update",e)}};(0,i.Cg)([(0,n.MZ)({type:u.A})],c.prototype,"elevationInfo",void 0),(0,i.Cg)([(0,n.MZ)((0,o.C)(d.Y,"graphics"))],c.prototype,"graphics",void 0),(0,i.Cg)([(0,n.MZ)({type:["show","hide"]})],c.prototype,"listMode",void 0),(0,i.Cg)([(0,n.MZ)()],c.prototype,"screenSizePerspectiveEnabled",void 0),(0,i.Cg)([(0,n.MZ)({readOnly:!0})],c.prototype,"type",void 0),(0,i.Cg)([(0,n.MZ)({constructOnly:!0})],c.prototype,"internal",void 0),c=(0,i.Cg)([(0,s.$)("esri.layers.GraphicsLayer")],c)},68325:(e,t,r)=>{r.d(t,{A:()=>l});var i=r(6326),n=r(42553),s=r(46053),o=(r(81806),r(76460),r(47249),r(87990)),a=r(12831);let l=class extends n.o{constructor(e){super(e),this.path=[]}};(0,i.Cg)([(0,s.MZ)({type:[a.A],json:{write:!0}})],l.prototype,"path",void 0),l=(0,i.Cg)([(0,o.$)("esri.rest.knowledgeGraph.Path")],l)},85646:(e,t,r)=>{r.d(t,{$C:()=>h,Hh:()=>o,Tu:()=>c,Wg:()=>y,Xq:()=>m,i6:()=>f,pM:()=>u,vJ:()=>g});var i=r(28899);let n,s=null;function o(){return n||(n=r.e(3884).then(r.bind(r,83884)).then(e=>e.l).then(e=>{let{default:t}=e;return t({locateFile:e=>(0,i.s)(`esri/libs/linkchartlayout/${e}`)})}).then(e=>{!function(e){s=e}(e)}),n)}const a={right:0,left:1,top:2,bottom:3},l={none:0,"start-only":1,"start-and-end":2};function p(e){const t={timeDirection:"right",timeBannerUTCOffsetInMinutes:0,eventsTicksVisualization:"start-and-end",showDurationLineForNonZeroDurationEntityEvents:!0,durationLineWidth:5,entityPositionAtDurationRatio:1,showNonZeroDurationIntervalBounds:!1,separateTimeOverlaps:!0,separateTimelineOverlaps:!0,moveFirstBends:!0,secondBendRatio:.3,lineSeparationMultiplier:1,spaceSeparatedLinesEvenly:!1,useBezierCurves:!1,separatedLineShapeRatio:0,...e?.toJSON(),eventsTicksVisualization:e?.eventsTicksVisualization??"start-and-end"};return{...t,timeDirection:{value:a[t.timeDirection]??a.right},eventsTicksVisualization:{value:l[t.eventsTicksVisualization]??l["start-and-end"]}}}function d(e,t,r,i,n,o){const a=r.length,l=n.length,p=Float64Array.BYTES_PER_ELEMENT,d=Uint32Array.BYTES_PER_ELEMENT,u=Uint8Array.BYTES_PER_ELEMENT,c=16+a*(u+2*p)+l*(2*d),y=s._malloc(c);try{const u=y+16-y%16,c=u+a*p,h=c+a*p,g=h+l*d,m=g+l*d,f=()=>[s.HEAPF64.subarray(u>>3,(u>>3)+a),s.HEAPF64.subarray(c>>3,(c>>3)+a),s.HEAPU32.subarray(h>>2,(h>>2)+l),s.HEAPU32.subarray(g>>2,(g>>2)+l),s.HEAPU8.subarray(m,m+a)],[b,w,T,C,M]=f();b.set(r),w.set(i),T.set(n),C.set(o),M.set(t);const I=e(a,m,u,c,l,h,g);let v=null,A=null;if(0===I.value){const e=s.getLayoutLinksTypes(),t=s.getLayoutLinksVerticesEndIndices(),r=s.getLayoutLinksVertices(),i=s.countLayoutLinksVertices();!l||e&&t?i&&!r?I.value=1:(v={types:new Uint8Array(s.HEAPU8.subarray(e,e+l)),vertexEndIndex:new Uint32Array(s.HEAPU32.subarray(t>>2,(t>>2)+l)),vertices:new Float64Array(s.HEAPF64.subarray(r>>3,(r>>3)+2*i))},A=s.getAuxiliaryGraphicElements()):I.value=1}const[E,_,N,S,L]=f();return r.set(E),i.set(_),n.set(N),o.set(S),t.set(L),{status:I.value,links:v,graphics:A}}finally{s._free(y),s.cleanupLayout()}}var u,c,y,h,g,m,f;!function(e){e.getMinIdealEdgeLength=function(){return s.getMinIdealEdgeLength()},e.apply=function(e,t,r,i,n,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;return d((t,r,i,n,o,d,u)=>s.applyForceDirectedLayout(e,t,r,i,n,o,d,u,a,l,p),t,r,i,n,o)}}(u||(u={})),function(e){e.apply=function(e,t,r,i,n,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,p=arguments.length>8&&void 0!==arguments[8]?arguments[8]:-1;return d((t,r,i,n,o,d,u)=>s.applyCommunityLayout(e,t,r,i,n,o,d,u,a,l,p),t,r,i,n,o)}}(c||(c={})),function(e){e.apply=function(e,t,r,i,n,o){return d((t,r,i,n,o,a,l)=>s.applySimpleLayout(e,t,r,i,n,o,a,l),t,r,i,n,o)}}(y||(y={})),function(e){e.apply=function(e,t,r,i,n,o){return d((t,r,i,n,o,a,l)=>s.applyHierarchicalLayout(e,t,r,i,n,o,a,l),t,r,i,n,o)}}(h||(h={})),function(e){e.apply=function(e,t,r,i,n,o){return d((t,r,i,n,o,a,l)=>s.applyRadialTreeLayout(e,t,r,i,n,o,a,l),t,r,i,n,o)}}(g||(g={})),function(e){e.apply=function(e,t,r,i,n,o){return d((t,r,i,n,o,a,l)=>s.applySmartTreeLayout(e,t,r,i,n,o,a,l),t,r,i,n,o)}}(m||(m={})),function(e){e.apply=function(e,t,r,i,n,o,a,l,u,c,y,h){return d((t,r,i,a,l,d,g)=>{if(n.length!==t)return{value:1};if(o.length!==t)return{value:1};if(u.length!==l)return{value:1};if(c.length!==l)return{value:1};const m=Float64Array.BYTES_PER_ELEMENT,f=16,b=s._malloc(f+t*m),w=s._malloc(f+t*m),T=s._malloc(f+l*m),C=s._malloc(f+l*m),M=b+f-b%f,I=w+f-w%f,v=T+f-T%f,A=C+f-C%f;try{return s.HEAPF64.subarray(M>>3,(M>>3)+t).set(n),s.HEAPF64.subarray(I>>3,(I>>3)+t).set(o),s.HEAPF64.subarray(v>>3,(v>>3)+l).set(u),s.HEAPF64.subarray(A>>3,(A>>3)+l).set(c),s.applyChronologicalLayout(e,t,r,i,a,M,I,l,d,g,v,A,y,p(h))}finally{s._free(b),s._free(w),s._free(T),s._free(C)}},t,r,i,a,l)}}(f||(f={}))}}]);
//# sourceMappingURL=9232.6089d748.chunk.js.map