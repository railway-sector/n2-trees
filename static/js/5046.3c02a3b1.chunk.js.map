{"version":3,"file":"static/js/5046.3c02a3b1.chunk.js","mappings":"iUAIkhC,MAAMA,EAAE,uBAAuB,MAAMC,EAAEC,WAAAA,GAAcC,KAAKC,kBAAkB,KAAKD,KAAKE,aAAa,KAAKF,KAAKG,qBAAoB,CAAE,CAACC,OAAAA,GAAUJ,KAAKE,cAAcE,UAAUJ,KAAKE,aAAa,IAAI,CAAC,UAAMG,CAAKC,GAAO,IAALC,EAACC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAG,MAAMG,cAAcC,EAAEC,uBAAuBC,EAAEC,OAAOC,EAAEC,aAAaC,EAAEC,YAAYC,EAAEC,eAAeC,EAAEC,oBAAoBC,EAAEC,aAAaC,EAAEC,cAAcC,EAAEC,iBAAiBC,GAAGxB,GAAGyB,iBAAiBC,EAAEC,2BAA2BC,IAAGC,EAAAA,EAAAA,IAAEvB,EAAEQ,EAAEd,EAAEyB,kBAAkB,UAAUK,EAAAA,EAAAA,IAAEF,EAAEF,EAAE,CAAC,MAAM,MAAM,IAAIK,EAAAA,EAAE,yBAAyB,2BAA2B,CAACC,mBAAmBJ,EAAEK,oBAAoBP,GAAG,EAACQ,EAAAA,EAAAA,IAAEjC,GAAGP,KAAKC,kBAAkB6B,EAAE9B,KAAKyC,aAAarB,EAAEpB,KAAK0C,aAAaC,EAAAA,EAAEC,cAAc,CAAC7B,OAAOC,EAAE6B,wBAAwB7B,EAAE8B,KAAKxC,GAAG,sBAAsBA,EAAEyC,MAAM,CAACC,aAAaC,EAAAA,IAAG,OAAOjD,KAAKkD,cAAchC,EAAElB,KAAKmD,eAAevC,EAAEZ,KAAKoD,wBAAwBtC,EAAEd,KAAKqD,4BAA4BnB,EAAElC,KAAKsD,gBAAgBhC,EAAEtB,KAAKuD,qBAAqB/B,EAAExB,KAAKwD,cAAc9B,EAAE1B,KAAKyD,eAAe7B,EAAE5B,KAAK0D,kBAAkB1B,EAAE,IAAI2B,QAAQ3D,KAAK4D,kBAAkBrD,GAAG,GAAGoD,EAAEE,OAAOpD,OAAO,IAAIT,KAAKG,qBAAoB,EAAGwD,QAAQ3D,KAAK4D,kBAAkBrD,GAAGoD,EAAEE,OAAOpD,OAAO,GAAG,MAAMkD,EAAEE,OAAO,GAAG,MAAMhE,EAAE,CAACkD,KAAK,YAAYe,UAAUlC,GAAG,OAAO5B,KAAKE,aAAa,IAAI6D,EAAAA,GAAE,CAACC,YAAYhE,KAAK0C,aAAazB,aAAaC,EAAE+C,MAAK,EAAGC,MAAK,EAAGC,cAActE,EAAEkC,iBAAiBC,EAAEoC,SAAS,KAAKC,aAAa,IAAIC,EAAAA,EAAE,CAACrD,aAAaC,EAAE+C,MAAK,EAAGC,MAAK,MAAOlE,KAAKE,aAAamE,aAAaE,QAAQZ,EAAEa,UAAU,CAACC,SAASC,EAAEf,GAAGgB,cAAc3E,KAAKE,aAAa0E,0BAA0BC,WAAW,CAAC,gBAAMC,GAAa,MAAM,IAAIzC,EAAAA,EAAE,mCAAmC,4CAA4C,CAAC,mBAAM0C,GAAwB,IAAVzE,EAACE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAE6B,EAAC7B,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAG,aAAaR,KAAKgF,wBAAwBhF,KAAKE,aAAa+E,aAAa3E,EAAE+B,EAAE6C,OAAO,CAAC,uBAAMC,GAA4B,IAAV7E,EAACE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAE6B,EAAC7B,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAG,aAAaR,KAAKgF,wBAAwBhF,KAAKE,aAAakF,qBAAqB9E,EAAE+B,EAAE6C,OAAO,CAAC,oBAAMG,GAAyB,IAAV/E,EAACE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAE6B,EAAC7B,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAsC,aAA7BR,KAAKgF,+BAAqChF,KAAKE,aAAaoF,mBAAmBhF,EAAE+B,EAAE6C,SAASK,OAAO5B,EAAAA,GAAE,CAAC,iBAAM6B,GAAsB,IAAVlF,EAACE,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAE6B,EAAC7B,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAG,aAAaR,KAAKgF,wBAAwBhF,KAAKE,aAAauF,sBAAsBnF,EAAE+B,EAAE6C,OAAO,CAAC,mBAAMQ,CAAcpF,GAAO,IAAL+B,EAAC7B,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAG,aAAaR,KAAKgF,8BAA8BhF,KAAKE,aAAayF,wBAAwBrF,EAAE+B,EAAE6C,OAAO,CAAC,wBAAMU,CAAmBtF,GAAO,IAAL+B,EAAC7B,UAAAC,OAAA,QAAAC,IAAAF,UAAA,GAAAA,UAAA,GAAC,CAAC,EAAG,aAAaR,KAAKgF,wBAAwBhF,KAAKE,aAAa2F,0BAA0BvF,EAAE+B,EAAE6C,OAAO,CAAC,aAAMY,CAAQzD,GAAG,OAAOrC,KAAKC,kBAAkBoC,EAAER,iBAAiB7B,KAAKsD,gBAAgBjB,EAAEhB,eAAerB,KAAKuD,qBAAqBlB,EAAEd,oBAAoBvB,KAAKwD,cAAcnB,EAAEZ,aAAazB,KAAK+F,eAAeC,QAAQhG,KAAK+F,eAAczF,EAAAA,EAAAA,IAAEA,GAAGN,KAAK4D,kBAAkB,CAACsB,OAAO5E,KAAKN,KAAK+F,cAAcE,QAAQC,KAAK5F,IAAIN,KAAKE,aAAamE,aAAa8B,QAAQnG,KAAKE,aAAamE,aAAaE,QAAQjE,EAAEkE,UAAU,IAAI,MAAMnC,KAAKqC,EAAEpE,GAAGC,EAAAA,EAAE6F,UAAUvG,GAAGwG,KAAK,IAAIrF,EAAAA,EAAE,4BAA4BqB,EAAEiE,QAAQjE,EAAEkE,UAAUjG,EAAEuD,QAAQpD,QAAQF,EAAAA,EAAE6F,UAAUvG,GAAGwG,KAAK,IAAIrF,EAAAA,EAAE,0BAA0B,gCAAgC,CAAC6C,OAAOvD,EAAEuD,WAAW,KAAK7D,KAAKE,aAAamE,aAAa8B,gBAAgBnG,KAAKgF,wBAAwB,CAACL,cAAc3E,KAAKE,aAAa0E,0BAA0BC,WAAW,CAAC,2BAAMG,GAAwB,GAAGhF,KAAK+F,gBAAgB/F,KAAK+F,cAAcS,SAAS,CAAC,UAAUxG,KAAK+F,cAAcE,OAAO,CAAC,MAAM,CAAC,OAAOjG,KAAKgF,uBAAuB,CAAC,CAAC,uBAAMpB,CAAkBtD,GAAG,MAAM+B,EAAE/B,GAAG4E,OAAO3E,EAAEP,KAAKuD,qBAAqBvC,EAAEhB,KAAKwD,cAActC,EAAElB,KAAKG,qBAAqBa,EAAE,QAAQgB,EAAAA,EAAAA,GAAEhC,KAAKmD,eAAenD,KAAKyC,aAAagE,SAAS,CAAC5E,iBAAiB7B,KAAKC,kBAAkBiF,OAAO7C,SAAI,EAAO,IAAIjB,EAAE,GAAG,MAAME,EAAE,GAAG,GAAG,MAAMJ,EAAE,IAAIE,QAAQpB,KAAK0G,aAAarE,EAAE,CAAC,MAAMiC,IAAGxD,EAAAA,EAAAA,IAAEwD,IAAIhD,EAAEqF,KAAKrC,EAAE,KAAK,CAAC,MAAMhE,EAAEsG,KAAKC,IAAI3F,EAAEX,GAAGiC,EAAs6C,UAAWlC,EAAE+B,EAAE9B,GAAG,IAAI,IAAIK,EAAE,EAAEA,EAAEyB,EAAEzB,UAAUN,EAAEwG,WAAWlG,EAAEL,EAAE,CAAj+CwG,CAAE/G,MAAKY,EAAAA,EAAAA,IAAEgG,KAAKI,KAAK1G,EAAEN,KAAKsD,iBAAiB,EAAEtC,GAAGqB,SAAS4E,QAAQC,WAAWC,MAAMC,KAAK,CAAC3G,OAAO,KAAK4G,IAAI,IAA03CC,eAAiBhH,EAAE+B,EAAE9B,GAAG,IAAIK,EAAEN,EAAEiH,OAAO,MAAM3G,EAAE4G,MAAM,CAAC,IAAI,MAAMlH,QAAQM,EAAE6G,MAAMpF,EAAEsE,QAAQrG,EAAE,CAAC,MAAMkC,IAAG1B,EAAAA,EAAAA,IAAE0B,IAAIjC,EAAEoG,KAAKnE,EAAE,CAAC5B,EAAEN,EAAEiH,MAAM,CAAC,CAAv/CG,CAAElF,EAAEpB,EAAEE,IAAI,CAAC,OAAOkB,EAAAA,EAAAA,IAAEH,GAAG,CAACmC,SAASpD,EAAEuG,iBAAiBzG,EAAEK,oBAAoBhB,EAAEkB,aAAaT,EAAE6C,OAAOvC,EAAE,CAAC,kBAAMoF,CAAapG,GAAG,MAAM+B,EAAEuF,OAAOC,SAAS7H,KAAKsD,kBAAkBtD,KAAKsD,gBAAgB,EAAEtD,KAAKsD,qBAAgB,EAAO/C,QAAQ2B,EAAAA,EAAAA,IAAElC,KAAKmD,eAAenD,KAAKyC,aAAagE,SAASzG,KAAKqD,4BAA4BrD,KAAKoD,wBAAwB,CAACvB,iBAAiB7B,KAAKC,kBAAkB6H,MAAMzF,EAAE6C,OAAO5E,IAAI,OAAON,KAAK+H,gBAAgBxH,EAAE,CAAC2E,OAAO5E,GAAG,CAAC,gBAAMwG,CAAWxG,EAAE+B,GAAG,MAAM9B,EAAED,EAAEN,KAAKsD,gBAAgB1C,QAAQsB,EAAAA,EAAAA,IAAElC,KAAKmD,eAAenD,KAAKyC,aAAagE,SAASzG,KAAKqD,4BAA4BrD,KAAKoD,wBAAwB,CAACvB,iBAAiB7B,KAAKC,kBAAkB+H,WAAWzH,EAAEuH,MAAM9H,KAAKsD,gBAAgB4B,OAAO7C,IAAI,OAAOrC,KAAK+H,gBAAgBnH,EAAE,CAACoH,WAAWzH,EAAE2E,OAAO7C,GAAG,CAAC0F,eAAAA,CAAgBzH,EAAE+B,IAAGX,EAAAA,EAAAA,IAAEpB,EAAEN,KAAKqD,4BAA4B4E,MAAM,MAAMD,WAAWzH,EAAE2E,OAAOtE,GAAGyB,GAAEG,EAAAA,EAAAA,IAAE5B,GAAG,MAAME,GAAEc,EAAAA,EAAAA,IAAEtB,EAAE,CAACW,aAAajB,KAAKkD,cAAcgB,MAAK,EAAGvC,cAAc3B,KAAKyD,iBAAiB,KAAIvC,EAAAA,EAAAA,IAAElB,KAAK0D,kBAAkB1D,KAAKqD,6BAA6B,IAAI,MAAMb,KAAK1B,EAAE,MAAM0B,EAAE0F,WAAW1F,EAAE0F,UAAS9G,EAAAA,EAAAA,KAAEI,EAAAA,EAAAA,KAAEF,EAAAA,EAAAA,IAAEkB,EAAE0F,SAASlI,KAAKkD,eAAc,GAAG,GAAIlD,KAAKqD,4BAA4BrD,KAAK0D,qBAAqB,IAAI1C,EAAET,GAAG,EAAE,IAAI,MAAMiC,KAAK1B,EAAE,CAAC,MAAMR,EAAE,CAAC,GAAEwB,EAAAA,EAAAA,IAAE9B,KAAK0C,aAAapC,EAAEkC,EAAE2F,YAAW,GAAI3F,EAAE2F,WAAW7H,EAAE,MAAMA,EAAEN,KAAKyD,kBAAkBjB,EAAE4F,SAAS9H,EAAEN,KAAKyD,gBAAgBzC,IAAI,CAAC,OAAOF,CAAC,EAAkM,SAAS4D,EAAEpE,GAAG,MAAM+B,EAAE,GAAG,OAAO,MAAM/B,EAAEqH,mBAAmBrH,EAAEkE,SAAS/D,OAAOH,EAAEqH,kBAAkBtF,EAAEsE,KAAK,CAAC0B,KAAK,mCAAmC/B,QAAQ,oBAAoBhG,EAAEkE,SAAS/D,aAAaH,EAAEqH,uBAAuBrH,EAAEmB,6EAA6E8E,QAAQ,CAAC+B,YAAYhI,EAAEkE,SAAS/D,OAAOkH,iBAAiBrH,EAAEqH,oBAAoBrH,EAAEqH,iBAAiBrH,EAAEiB,qBAAqBc,EAAEsE,KAAK,CAAC0B,KAAK,0BAA0B/B,QAAQ,iBAAiBhG,EAAEqH,4DAA4DrH,EAAEiB,uBAAuBgF,QAAQ,CAAC+B,YAAYhI,EAAEkE,SAAS/D,OAAOkH,iBAAiBrH,EAAEqH,iBAAiBpG,oBAAoBjB,EAAEiB,wBAAwBc,CAAC,C,sHCAnnN,MAAMf,EAAEvB,WAAAA,CAAYsC,GAAGrC,KAAKuI,YAAYlG,EAAErC,KAAKwI,KAAK,IAAI,EAAE,MAAM5H,EAAEb,WAAAA,CAAYsC,GAAGrC,KAAKyI,SAAS,KAAKzI,KAAKoI,SAAS,KAAKpI,KAAK0I,SAAQ,EAAG1I,KAAK2I,SAAS,KAAK3I,KAAK4I,MAAM,IAAItH,EAAEe,EAAE,EAAE,SAAS0B,EAAE1B,GAAG,OAAO,IAAIzB,EAAEyB,EAAE,CAAC,MAAMiC,EAAEvE,WAAAA,CAAYsC,GAAGrC,KAAKyI,SAAS,KAAKzI,KAAK0I,SAAQ,EAAG1I,KAAKoI,SAASpI,KAAK2I,SAAStG,CAAC,EAAE,SAASP,EAAEO,GAAG,OAAO,IAAIiC,EAAEjC,EAAE,CAAC,MAAMT,EAAE,IAAIiH,IAAI,SAASnH,EAAEW,EAAE/B,EAAEQ,GAAO,IAAL0B,EAAChC,UAAAC,OAAA,QAAAC,IAAAF,UAAA,IAAAA,UAAA,GAAKoB,EAAEuE,QAAQ,IAAI,MAAMjF,KAAKJ,EAAE,CAAC,MAAMM,EAAEiB,EAAEyG,IAAI5H,GAAG,IAAIE,EAAE,SAAS,MAAME,EAAEE,EAAEJ,EAAEN,EAAEI,IAAI,GAAGU,EAAEmH,IAAI3H,EAAEiH,MAAMjH,IAAIoB,GAAGpB,EAAE4H,UAAU,CAAC,MAAM3G,GAAErB,EAAAA,EAAAA,IAAEI,EAAEE,GAAG,GAAGe,EAAE,OAAO0B,GAAExD,EAAAA,EAAAA,IAAE8B,EAAEjB,EAAEE,IAAIhB,EAAEc,EAAEiH,MAAM/G,CAAC,CAAC,CAAC,IAAI,MAAMN,KAAKqB,EAAE4G,gBAAgB,GAAG,IAAIrH,EAAEsH,IAAIlI,EAAEqH,MAAM,OAAOtE,EAAE,2BAA2B/C,EAAEqH,SAAS,OAAO,IAAI,CAAC,SAAS7G,EAAElB,EAAEU,GAAG,IAAIT,EAAES,EAAE,OAAOF,EAAAA,EAAAA,IAAER,IAAI,iBAAiBU,EAAET,EAAE4I,WAAWnI,IAAGwB,EAAAA,EAAAA,IAAElC,IAAI,MAAMU,GAAG,iBAAiBA,EAAET,EAAE6I,OAAOpI,IAAGE,EAAAA,EAAAA,IAAEZ,IAAI,iBAAiBU,IAAIT,GAAE8B,EAAAA,EAAAA,IAAErB,KAAII,EAAAA,EAAAA,IAAEb,EAAE,CAAC,IAAI4B,EAAE,SAASC,EAAEC,EAAErB,GAAG,IAAIqB,KAAI/B,EAAAA,EAAAA,IAAEU,GAAG,OAAOqB,EAAE,GAAG,UAAUA,GAAG,UAAUA,EAAE,CAAC,GAAG,MAAMF,EAAE,MAAM,IAAIkH,UAAU,8BAA8B,OAAOlH,EAAEmH,SAAStI,EAAEqB,EAAE,CAAC,OAAOA,CAAC,CAAqGiF,eAAe5C,EAAErC,EAAErB,KAAIV,EAAAA,EAAAA,IAAE+B,IAAI,wBAAwBrB,GAAG,yBAAyBA,SAArLsG,iBAAmB,OAAO,MAAMnF,IAAIA,QAAQ,yDAAsDA,CAAC,CAA2FoH,EAAG,CAAC,MAAMzJ,EAAE,CAAC0J,yBAAwB,EAAGC,0BAAyB,EAAGC,4BAA2B,EAAGC,iBAAgB,EAAGC,iBAAgB,EAAGC,iBAAgB,EAAGC,uBAAsB,EAAGC,wBAAwB,CAAC,QAAQ,MAAM,MAAM,MAAM,SAAS,MAAM,MAAM,kBAAkB,kBAAkB,oBAAoB,oBAAoB,uBAAuBC,4BAA4B,CAAC,QAAQ,MAAM,aAAa,iBAAiB,c","sources":["../node_modules/@arcgis/core/layers/graphics/sources/WFSSourceWorker.js","../node_modules/@arcgis/core/layers/graphics/sources/support/sourceUtils.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{createTask as e}from\"../../../core/asyncUtils.js\";import t from\"../../../core/Error.js\";import r from\"../../../core/Logger.js\";import{clamp as a}from\"../../../core/mathUtils.js\";import{throwIfAborted as s,isAbortError as o}from\"../../../core/promiseUtils.js\";import n from\"../../../core/Warning.js\";import{equals as i}from\"../../../geometry/support/spatialReferenceUtils.js\";import{convertFromGeometry as u,convertToGeometry as l}from\"../featureConversionUtils.js\";import c from\"../data/FeatureStore.js\";import{checkProjectionSupport as h,project as m}from\"../data/projectionSupport.js\";import{QueryEngine as p}from\"../data/QueryEngine.js\";import{validateGeoJSON as d,createOptimizedFeatures as g}from\"./geojson/geojson.js\";import{mixAttributes as f}from\"./support/sourceUtils.js\";import{getGetFeatureSpatialReference as y,getFeatureCount as _,getFeature as x}from\"../../ogc/wfsUtils.js\";import C from\"../../support/FieldsIndex.js\";import{isNumber as w}from\"../../../support/guards.js\";import{utc as R}from\"../../../time/constants.js\";const F=\"esri.layers.WFSLayer\";class S{constructor(){this._customParameters=null,this._queryEngine=null,this._supportsPagination=!0}destroy(){this._queryEngine?.destroy(),this._queryEngine=null}async load(e,r={}){const{getFeatureUrl:a,getFeatureOutputFormat:o,fields:n,geometryType:i,featureType:u,maxRecordCount:l,maxTotalRecordCount:m,maxPageCount:d,objectIdField:g,customParameters:f}=e,{spatialReference:_,getFeatureSpatialReference:x}=y(a,u,e.spatialReference);try{await h(x,_)}catch{throw new t(\"unsupported-projection\",\"Projection not supported\",{inSpatialReference:x,outSpatialReference:_})}s(r),this._customParameters=f,this._featureType=u,this._fieldsIndex=C.fromLayerJSON({fields:n,dateFieldsTimeReference:n.some(e=>\"esriFieldTypeDate\"===e.type)?{timeZoneIANA:R}:null}),this._geometryType=i,this._getFeatureUrl=a,this._getFeatureOutputFormat=o,this._getFeatureSpatialReference=x,this._maxRecordCount=l,this._maxTotalRecordCount=m,this._maxPageCount=d,this._objectIdField=g,this._spatialReference=_;let w=await this._snapshotFeatures(r);if(w.errors.length>0&&(this._supportsPagination=!1,w=await this._snapshotFeatures(r),w.errors.length>0))throw w.errors[0];const F={type:\"object-id\",fieldName:g};return this._queryEngine=new p({fieldsIndex:this._fieldsIndex,geometryType:i,hasM:!1,hasZ:!1,featureIdInfo:F,spatialReference:_,timeInfo:null,featureStore:new c({geometryType:i,hasM:!1,hasZ:!1})}),this._queryEngine.featureStore.addMany(w.features),{warnings:E(w),extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async applyEdits(){throw new t(\"wfs-source:editing-not-supported\",\"applyEdits() is not supported on WFSLayer\")}async queryFeatures(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQuery(e,t.signal)}async queryFeatureCount(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForCount(e,t.signal)}async queryObjectIds(e={},t={}){await this._waitSnapshotComplete();return(await this._queryEngine.executeQueryForIds(e,t.signal)).filter(w)}async queryExtent(e={},t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeQueryForExtent(e,t.signal)}async querySnapping(e,t={}){return await this._waitSnapshotComplete(),await this._queryEngine.executeQueryForSnapping(e,t.signal)}async queryAttributeBins(e,t={}){return await this._waitSnapshotComplete(),this._queryEngine.executeAttributeBinsQuery(e,t.signal)}async refresh(t){return this._customParameters=t.customParameters,this._maxRecordCount=t.maxRecordCount,this._maxTotalRecordCount=t.maxTotalRecordCount,this._maxPageCount=t.maxPageCount,this._snapshotTask?.abort(),this._snapshotTask=e(e=>this._snapshotFeatures({signal:e})),this._snapshotTask.promise.then(e=>{this._queryEngine.featureStore.clear(),this._queryEngine.featureStore.addMany(e.features);for(const t of E(e))r.getLogger(F).warn(new n(\"wfs-layer:refresh-warning\",t.message,t.details));e.errors?.length&&r.getLogger(F).warn(new n(\"wfs-layer:refresh-error\",\"Refresh completed with errors\",{errors:e.errors}))},()=>{this._queryEngine.featureStore.clear()}),await this._waitSnapshotComplete(),{extent:(await this._queryEngine.fetchRecomputedExtents()).fullExtent}}async _waitSnapshotComplete(){if(this._snapshotTask&&!this._snapshotTask.finished){try{await this._snapshotTask.promise}catch{}return this._waitSnapshotComplete()}}async _snapshotFeatures(e){const t=e?.signal,r=this._maxTotalRecordCount,n=this._maxPageCount,i=this._supportsPagination&&n>1?await _(this._getFeatureUrl,this._featureType.typeName,{customParameters:this._customParameters,signal:t}):void 0;let u=[];const l=[];if(null==i)try{u=await this._singleQuery(t)}catch(c){o(c)||l.push(c)}else{const e=Math.min(i,r),s=T(this,a(Math.ceil(e/this._maxRecordCount),1,n),t);await Promise.allSettled(Array.from({length:10}).map(()=>j(s,u,l)))}return s(t),{features:u,totalRecordCount:i,maxTotalRecordCount:r,maxPageCount:n,errors:l}}async _singleQuery(e){const t=Number.isFinite(this._maxRecordCount)&&this._maxRecordCount>0?this._maxRecordCount:void 0,r=await x(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,count:t,signal:e});return this._processGeoJSON(r,{signal:e})}async _pageQuery(e,t){const r=e*this._maxRecordCount,a=await x(this._getFeatureUrl,this._featureType.typeName,this._getFeatureSpatialReference,this._getFeatureOutputFormat,{customParameters:this._customParameters,startIndex:r,count:this._maxRecordCount,signal:t});return this._processGeoJSON(a,{startIndex:r,signal:t})}_processGeoJSON(e,t){d(e,this._getFeatureSpatialReference.wkid);const{startIndex:r,signal:a}=t;s(a);const o=g(e,{geometryType:this._geometryType,hasZ:!1,objectIdField:this._objectIdField});if(!i(this._spatialReference,this._getFeatureSpatialReference))for(const s of o)null!=s.geometry&&(s.geometry=u(m(l(s.geometry,this._geometryType,!1,!1),this._getFeatureSpatialReference,this._spatialReference)));let n=r??1;for(const s of o){const e={};f(this._fieldsIndex,e,s.attributes,!0),s.attributes=e,null==e[this._objectIdField]&&(s.objectId=e[this._objectIdField]=n++)}return o}}function*T(e,t,r){for(let a=0;a<t;a++)yield e._pageQuery(a,r)}async function j(e,t,r){let a=e.next();for(;!a.done;){try{const e=await a.value;t.push(...e)}catch(s){o(s)||r.push(s)}a=e.next()}}function E(e){const t=[];return null!=e.totalRecordCount&&(e.features.length<e.totalRecordCount&&t.push({name:\"wfs-layer:maxRecordCount-too-low\",message:`Could only fetch ${e.features.length} of ${e.totalRecordCount} in ${e.maxPageCount} queries. Try increasing the value of WFSLayer.maxRecordCount.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount}}),e.totalRecordCount>e.maxTotalRecordCount&&t.push({name:\"wfs-layer:large-dataset\",message:`The number of ${e.totalRecordCount} features exceeds the maximum allowed of ${e.maxTotalRecordCount}.`,details:{recordCount:e.features.length,totalRecordCount:e.totalRecordCount,maxTotalRecordCount:e.maxTotalRecordCount}})),t}export{S as default};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.34/esri/copyright.txt for details.\n*/\nimport{parseDate as t}from\"../../../../core/date.js\";import{isValid as e}from\"../../../../geometry/support/spatialReferenceUtils.js\";import{validateFieldValue as n,validationErrorToString as r,isNumericField as o,isStringField as s,isDateField as i,sanitizeNullFieldValue as u}from\"../../../support/fieldUtils.js\";class l{constructor(t){this.description=t,this.code=null}}class a{constructor(t){this.globalId=null,this.objectId=null,this.success=!1,this.uniqueId=null,this.error=new l(t)}}function p(t){return new a(t)}class c{constructor(t){this.globalId=null,this.success=!0,this.objectId=this.uniqueId=t}}function f(t){return new c(t)}const g=new Set;function d(t,e,o,s=!1){g.clear();for(const i in o){const u=t.get(i);if(!u)continue;const l=m(u,o[i]);if(g.add(u.name),u&&(s||u.editable)){const t=n(u,l);if(t)return p(r(t,u,l));e[u.name]=l}}for(const n of t.requiredFields??[])if(!g.has(n.name))return p(`missing required field \"${n.name}\"`);return null}function m(e,n){let r=n;return o(e)&&\"string\"==typeof n?r=parseFloat(n):s(e)&&null!=n&&\"string\"!=typeof n?r=String(n):i(e)&&\"string\"==typeof n&&(r=t(n)),u(r)}let y;function h(t,n){if(!t||!e(n))return t;if(\"rings\"in t||\"paths\"in t){if(null==y)throw new TypeError(\"geometry engine not loaded\");return y.simplify(n,t)}return t}async function I(){return null==y&&(y=await import(\"../../../../geometry/geometryEngineJSON.js\")),y}async function E(t,n){!e(t)||\"esriGeometryPolygon\"!==n&&\"esriGeometryPolyline\"!==n||await I()}const S={supportsAutoIntervalBin:!0,supportsFixedIntervalBin:!0,supportsFixedBoundariesBin:!0,supportsDateBin:!0,supportsStackBy:!0,supportsSplitBy:!0,supportsNormalization:!0,supportedStatisticTypes:[\"COUNT\",\"SUM\",\"AVG\",\"VAR\",\"STDDEV\",\"MIN\",\"MAX\",\"PERCENTILE_CONT\",\"PERCENTILE_DISC\",\"CentroidAggregate\",\"EnvelopeAggregate\",\"ConvexHullAggregate\"],supportedNormalizationTypes:[\"field\",\"log\",\"naturalLog\",\"percentOfTotal\",\"squareRoot\"]};export{p as createFeatureEditErrorResult,f as createFeatureEditSuccessResult,E as loadGeometryEngineForSimplify,d as mixAttributes,S as queryBinsCapabilities,h as simplify};\n"],"names":["F","S","constructor","this","_customParameters","_queryEngine","_supportsPagination","destroy","load","e","r","arguments","length","undefined","getFeatureUrl","a","getFeatureOutputFormat","o","fields","n","geometryType","i","featureType","u","maxRecordCount","l","maxTotalRecordCount","m","maxPageCount","d","objectIdField","g","customParameters","f","spatialReference","_","getFeatureSpatialReference","x","y","h","t","inSpatialReference","outSpatialReference","s","_featureType","_fieldsIndex","C","fromLayerJSON","dateFieldsTimeReference","some","type","timeZoneIANA","R","_geometryType","_getFeatureUrl","_getFeatureOutputFormat","_getFeatureSpatialReference","_maxRecordCount","_maxTotalRecordCount","_maxPageCount","_objectIdField","_spatialReference","w","_snapshotFeatures","errors","fieldName","p","fieldsIndex","hasM","hasZ","featureIdInfo","timeInfo","featureStore","c","addMany","features","warnings","E","extent","fetchRecomputedExtents","fullExtent","applyEdits","queryFeatures","_waitSnapshotComplete","executeQuery","signal","queryFeatureCount","executeQueryForCount","queryObjectIds","executeQueryForIds","filter","queryExtent","executeQueryForExtent","querySnapping","executeQueryForSnapping","queryAttributeBins","executeAttributeBinsQuery","refresh","_snapshotTask","abort","promise","then","clear","getLogger","warn","message","details","finished","typeName","_singleQuery","push","Math","min","_pageQuery","T","ceil","Promise","allSettled","Array","from","map","async","next","done","value","j","totalRecordCount","Number","isFinite","count","_processGeoJSON","startIndex","wkid","geometry","attributes","objectId","name","recordCount","description","code","globalId","success","uniqueId","error","Set","get","add","editable","requiredFields","has","parseFloat","String","TypeError","simplify","I","supportsAutoIntervalBin","supportsFixedIntervalBin","supportsFixedBoundariesBin","supportsDateBin","supportsStackBy","supportsSplitBy","supportsNormalization","supportedStatisticTypes","supportedNormalizationTypes"],"sourceRoot":""}