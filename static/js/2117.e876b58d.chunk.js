"use strict";(self.webpackChunkn2_trees=self.webpackChunkn2_trees||[]).push([[2117],{2687:(t,e,r)=>{r.d(e,{N5:()=>a});var n=r(50076),i=(r(81806),r(76460));const s=()=>i.A.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");class o{constructor(){this._includedModules=new Map}include(t,e){this._includedModules.has(t)?this._includedModules.get(t):(this._includedModules.set(t,e),t(this.builder,e))}}class a extends o{constructor(){super(...arguments),this.vertex=new l,this.fragment=new l,this.attributes=new d,this.varyings=new p,this.extensions=new f,this.outputs=new m}get fragmentUniforms(){return this.fragment.uniforms.entries}get attributeNames(){return this.attributes.names}get builder(){return this}generate(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this.extensions.generateSource(t),n=this.attributes.generateSource(t),i=this.varyings.generateSource(t),s="vertex"===t?this.vertex:this.fragment,o=s.uniforms.generateSource(),a=s.code.generateSource(),c=s.main.generateSource(e),u="vertex"===t?_:y,h=s.constants.generateSource(),l=this.outputs.generateSource(t);return`#version 300 es\n${r.join("\n")}\n${u}\n${h.join("\n")}\n${o.join("\n")}\n${n.join("\n")}\n${i.join("\n")}\n${l.join("\n")}\n${a.join("\n")}\n${c.join("\n")}`}generateBind(t){const e=new Map;this.vertex.uniforms.entries.forEach(t=>{const r=t.bind[0];r&&e.set(t.name,r)}),this.fragment.uniforms.entries.forEach(t=>{const r=t.bind[0];r&&e.set(t.name,r)});const r=Array.from(e.values()),n=r.length;return e=>{for(let i=0;i<n;++i)r[i](t,e)}}generateBindPass(t){const e=new Map;this.vertex.uniforms.entries.forEach(t=>{const r=t.bind[1];r&&e.set(t.name,r)}),this.fragment.uniforms.entries.forEach(t=>{const r=t.bind[1];r&&e.set(t.name,r)});const r=Array.from(e.values()),n=r.length;return(e,i)=>{for(let s=0;s<n;++s)r[s](t,e,i)}}generateBindDraw(t){const e=new Map;this.vertex.uniforms.entries.forEach(t=>{const r=t.bind[2];r&&e.set(t.name,r)}),this.fragment.uniforms.entries.forEach(t=>{const r=t.bind[2];r&&e.set(t.name,r)});const r=Array.from(e.values()),n=r.length;return(e,i,s)=>{for(let o=0;o<n;++o)r[o](t,s,e,i)}}}class c{constructor(t){this._stage=t,this._entries=new Map}add(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];for(const n of e)this._add(n);return this._stage}get(t){return this._entries.get(t)}_add(t){if(null!=t){if(this._entries.has(t.name)&&!this._entries.get(t.name).equals(t))throw new n.A("shaderbuilder:duplicate-uniform",`Duplicate uniform name ${t.name} for different uniform type`);this._entries.set(t.name,t)}else s().error(`Trying to add null Uniform from ${(new Error).stack}.`)}generateSource(){return Array.from(this._entries.values()).map(t=>{let{name:e,arraySize:r,type:n}=t;return null!=r?`uniform ${n} ${e}[${r}];`:`uniform ${n} ${e};`})}get entries(){return Array.from(this._entries.values())}}class u{constructor(t){this._stage=t,this._bodies=new Array}add(t){return this._bodies.push(t),this._stage}generateSource(t){if(this._bodies.length>0)return[`void main() {\n ${this._bodies.join("\n")||""} \n}`];if(t)throw new n.A("shaderbuilder:missing-main","Shader does not contain main function body.");return[]}}class h{constructor(t){this._stage=t,this._entries=new Array}add(t){return this._entries.push(t),this._stage}generateSource(){return this._entries}}class l extends o{constructor(){super(...arguments),this.uniforms=new c(this),this.main=new u(this),this.code=new h(this),this.constants=new g(this)}get builder(){return this}}class d{constructor(){this._entries=new Array}add(t,e){this._entries.push([t,e])}generateSource(t){return"fragment"===t?[]:this._entries.map(t=>`in ${t[1]} ${t[0]};`)}get names(){return this._entries.map(t=>{let[e]=t;return e})}}class p{constructor(){this._entries=new Map}add(t,e,r){this._entries.has(t)?s().warn(`Ignoring duplicate varying ${e} ${t}`):this._entries.set(t,{type:e,invariant:r?.invariant??!1})}generateSource(t){const e=new Array;return this._entries.forEach((r,n)=>e.push((r.invariant&&"vertex"===t?"invariant ":"")+("int"===r.type?"flat ":"")+("vertex"===t?"out":"in")+` ${r.type} ${n};`)),e}}class f{constructor(){this._entries=new Set}add(t){this._entries.add(t)}generateSource(t){const e="vertex"===t?f.ALLOWLIST_VERTEX:f.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(t=>e.includes(t)).map(t=>`#extension ${t} : enable`)}static#t=(()=>this.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"])();static#e=(()=>this.ALLOWLIST_VERTEX=[])()}class m{constructor(){this._entries=new Map}add(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this._entries.get(r);n?.name!==t||n?.type!==e?this._entries.set(r,{name:t,type:e}):s().warn(`Fragment shader output location ${r} occupied`)}static#t=(()=>this.DEFAULT_TYPE="vec4")();static#e=(()=>this.DEFAULT_NAME="fragColor")();generateSource(t){if("vertex"===t)return[];0===this._entries.size&&this._entries.set(0,{name:m.DEFAULT_NAME,type:m.DEFAULT_TYPE});const e=new Array;return this._entries.forEach((t,r)=>e.push(`layout(location = ${r}) out ${t.type} ${t.name};`)),e}}class g{constructor(t){this._stage=t,this._entries=new Set}add(t,e,r){let n="ERROR_CONSTRUCTOR_STRING";switch(e){case"float":n=g._numberToFloatStr(r);break;case"int":n=g._numberToIntStr(r);break;case"bool":n=r.toString();break;case"vec2":n=`vec2(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])})`;break;case"vec3":n=`vec3(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])})`;break;case"vec4":n=`vec4(${g._numberToFloatStr(r[0])},                            ${g._numberToFloatStr(r[1])},                            ${g._numberToFloatStr(r[2])},                            ${g._numberToFloatStr(r[3])})`;break;case"ivec2":n=`ivec2(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])})`;break;case"ivec3":n=`ivec3(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])})`;break;case"ivec4":n=`ivec4(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])},                             ${g._numberToIntStr(r[3])})`;break;case"uvec2":n=`uvec2(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])})`;break;case"uvec3":n=`uvec3(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])})`;break;case"uvec4":n=`uvec4(${g._numberToIntStr(r[0])},                             ${g._numberToIntStr(r[1])},                             ${g._numberToIntStr(r[2])},                             ${g._numberToIntStr(r[3])})`;break;case"mat2":case"mat3":case"mat4":n=`${e}(${Array.prototype.map.call(r,t=>g._numberToFloatStr(t)).join(", ")})`}return this._entries.add(`const ${e} ${t} = ${n};`),this._stage}static _numberToIntStr(t){return t.toFixed(0)}static _numberToFloatStr(t){return Number.isInteger(t)?t.toFixed(1):t.toString()}generateSource(){return Array.from(this._entries)}}const y="#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp int;\n  precision highp sampler2D;\n  precision highp usampler2D;\n  precision highp sampler2DArray;\n  precision highp sampler2DShadow;\n#else\n  precision mediump float;\n  precision mediump int;\n  precision mediump sampler2D;\n  precision mediump usampler2D;\n  precision mediump sampler2DArray;\n  precision mediump sampler2DShadow;\n#endif",_="precision highp float;\n precision highp sampler2D;\n precision highp usampler2D;\n precision highp sampler2DArray;\n precision highp sampler2DShadow;\n\n\n invariant gl_Position;\n "},6951:(t,e,r)=>{r.d(e,{Y7:()=>S,HS:()=>A,mm:()=>$,A:()=>I,k2:()=>N,ZA:()=>T,E8:()=>w,hF:()=>_,C5:()=>y,uK:()=>v,Pi:()=>b});var n=r(6326),i=(r(81806),r(76460)),s=r(60984);function o(t,e,r){const n=e.split("\n");for(const i of n)if(i.trim().length){{let e="";null!=r&&(e+=`/*id:${r??"000"}*/   `),t.body+=e.padEnd(14)}t.body+=" ".repeat(t.indent)+i+"\n"}}class a{write(t){for(const e of t.rootOutputNodes())t.shouldPruneOutputNode(e)||(e.variableName=this._write(t,e.node));return t}_createVarName(t,e){let r="";return"boolean"!=typeof e&&"number"!=typeof e&&e.debugInfo.name&&(r=`${e.debugInfo.name}_`),`${r}v${t.varCount++}`}_write(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("number"==typeof e)return e.toString();if("boolean"==typeof e)return e.toString();let n=t.getEmit(e);if(n)return n;switch(e.shaderType){case"scope-node":n=this._writeScopeNode(t,e);break;case"primitive-node":n=this._writePrimitiveNode(t,e,r);break;case"function-node":n=this._writeFunctionNode(t,e);break;case"property-access-node":n=this._writePropertyAccessNode(t,e);break;case"property-access-2d-node":n=this._writePropertyAccess2DNode(t,e);break;case"text-node":n=e.text;break;case"block-node":n=this._writeBlockNode(t,e);break;case"condition-node":n=this._writeConditionNode(t,e)}return t.setEmit(e,n),n}_writeScopeNode(t,e){const r=new e.child.constructor;r.setDebugName(e.debugInfo.name);const n=this._write(t,r,!0);return o(t,`{ /*ScopeStart: ${e.uid} ${e.debugInfo.name}*/`),t.indent+=2,o(t,`${n} = ${this._write(t,e.child)};`),t.indent-=2,o(t,`} /*ScopeEnd: ${e.uid} ${e.debugInfo.name}*/`),n}_writeConditionNode(t,e){const r=new e.ifTrue.constructor,n=this._write(t,r,!0);o(t,`if (${this._write(t,e.condition)}) {`),t.indent+=2;const i=t.createSubgraphContext(),s=this._write(i,e.ifTrue);if(t.body+=i.body,s&&o(t,`${n} = ${s};`),t.indent-=2,o(t,"}"),e.ifFalse){o(t,"else {"),t.indent+=2;const r=t.createSubgraphContext(),i=this._write(r,e.ifFalse);t.body+=r.body,i&&o(t,`${n} = ${i};`),t.indent-=2,o(t,"}")}return n}_writeBlockNode(t,e){const{captureList:r,generator:n,returnType:i}=e,s={};for(const o in r){if(!r[o])continue;const e=this._write(t,r[o]);s[o]=e}const a=new i,c=this._write(t,a,!0);if(s.out=c,e.subgraph){const r=t.createSubgraphContext(),n=this._write(r,e.subgraph.child),i=r.body;s.subgraph={varName:n,body:i}}const u=n(s);return o(t,"{\n"),t.indent+=2,o(t,u),t.indent-=2,o(t,"}\n"),c}_writePropertyAccessNode(t,e){const r=this._write(t,e.target);return"string"==typeof e.property&&e.property.includes("[")?`${r}${e.property}`:"string"!=typeof e.property?`${r}[${this._write(t,e.property)}]`:`${r}.${e.property}`}_writePropertyAccess2DNode(t,e){return`${this._write(t,e.target)}[${this._write(t,e.x)}][${this._write(t,e.y)}]`}_writeFunctionNode(t,e){const r=e.returnType.type;if(e.isInfix){const[n,i]=e.children.map(e=>this._write(t,e)),s=this._createVarName(t,e);return o(t,`${r.padEnd(5)} ${s} = ${n} ${e.token} ${i};`,e.uid),s}const n=e.children.map(e=>this._write(t,e)).join(", "),i=this._createVarName(t,e);return o(t,`${r.padEnd(5)} ${i} = ${e.token}(${n});`,e.uid),i}_writePrimitiveNode(t,e){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=t.getInput(e);if(n)return n.isUsed=!0,n.variableName;const i=1===e.children.length&&e.children[0]?.type===e.type;if(!e.isMutable&&(e.isImplicit||i))return this._write(t,e.children[0]);const s=this._createVarName(t,e);if(r)return o(t,`${e.type.padEnd(5)} ${s};`,e.uid),s;const a=!e.debugInfo.name&&!e.isMutable;if(a&&"float"===e.type&&"number"==typeof e.children[0])return Number.isInteger(e.children[0])?e.children[0].toFixed(1):e.children[0].toString();if(a&&"int"===e.type&&"number"==typeof e.children[0]&&Number.isInteger(e.children[0]))return e.children[0].toString();const c=e.children.map(e=>this._write(t,e)).join(", ");return"array"===e.type?(o(t,`${e.type.padEnd(5)} ${s} = [${c}];`,e.uid),s):a?`${e.type}(${c})`:(o(t,`${e.type.padEnd(5)} ${s} = ${e.type}(${c});`,e.uid),s)}}var c=r(22881);class u{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.variableName=t,this.variableInputType=e,this.node=r,this.qualifiers=n,this.type="shader-input",this.isUsed=!1}clone(){return new u(this.variableName,this.variableInputType,(0,c.vA)(this.node),[...this.qualifiers])}}class h{constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];this.outVariableName=t,this.outVariableType=e,this.node=r,this.qualifiers=n,this.type="shader-output"}clone(){const t=new h(this.outVariableName,this.outVariableType,(0,c.vA)(this.node),[...this.qualifiers]);return t.variableName=this.variableName,t}}class l{static createVertex(t,e,r,n,i,s){const o=[];for(const c in t){const e=t[c],n=r.get(c);n?o.push(new u(n,"builtin",e)):o.push(new u("a_"+c,"in",e))}for(const c of n){const t=c.uniformHydrated;o.push(new u(c.uniformName,"uniform",t))}const a=[];for(const c in e){const t=e[c];if("glPosition"===c)a.push(new h("gl_Position","builtin",t));else if("glPointSize"===c)a.push(new h("gl_PointSize","builtin",t));else{const e=d(t),r=[];e&&r.push(e),a.push(new h("v_"+c,"out",t,r))}}return new l(o,a,i,s)}static createFragment(t,e,r,n,i,s){const o=[],a=Array.from(i.rootOutputNodes());for(const h in t){const e=t[h],n=r.get(h);if(n){o.push(new u(n,"builtin",e));continue}const i=a.find(t=>t.node===e);i&&o.push(new u(i.outVariableName,"in",e))}for(const h of n){const t=h.uniformHydrated;o.push(new u(h.uniformName,"uniform",t))}const c=[];for(const u in e){const t=e[u],n=r.get(u);switch(u){case"discard":c.push(new h(null,"discard",t));break;case"fragData0":c.push(new h("fragData0","fragData0",t));break;case"fragData1":c.push(new h("fragData1","fragData1",t));break;case"fragData2":c.push(new h("fragData2","fragData2",t));break;case"fragData3":c.push(new h("fragData3","fragData3",t));break;default:n?c.push(new h(n,"builtin",t)):c.push(new h(u,"out",t))}}return new l(o,c,s)}constructor(t,e,r,n){this.type="shader-graph-context",this.indent=0,this.body="",this.varCount=0,this._inputShaderTypesByNodeUid=new Map,this._nodeEmitMap=new Map;for(const i of t)this._inputShaderTypesByNodeUid.set(i.node.uid,i);this._outputShaderTypes=e,this._transformFeedbackBindings=r,this._transformFeedbackNames=new Set(r.map(t=>"v_"+t.propertyKey)),this._usedInFragmentShader=n}shouldPruneOutputNode(t){return!!this._usedInFragmentShader&&"builtin"!==t.outVariableType&&!this._transformFeedbackNames.has(t.outVariableName)&&!this._usedInFragmentShader.has(t.node.uid)}setEmit(t,e){this._nodeEmitMap.set(t.uid,e)}getEmit(t){return this._nodeEmitMap.get(t.uid)}inputs(){return this._inputShaderTypesByNodeUid.values()}getInput(t){return this._inputShaderTypesByNodeUid.get(t.uid)}*rootOutputNodes(){for(const t of this._outputShaderTypes)yield t}*nodes(){const t=[];for(const e of this._outputShaderTypes.values())t.push(e.node);for(;t.length;){const e=t.pop();"number"!=typeof e&&"boolean"!=typeof e&&t.push(...e.children.filter(Boolean)),yield e}}*nodesOfTypeOrFunction(){for(const t of this.nodes())"number"!=typeof t&&"boolean"!=typeof t&&(yield t)}createSubgraphContext(){const t=this.clone();return t.body="",t.indent=this.indent+2,t._nodeEmitMap=new Map(this._nodeEmitMap),t}clone(){const t=new l([],this._outputShaderTypes,this._transformFeedbackBindings,this._usedInFragmentShader);return t._inputShaderTypesByNodeUid=this._inputShaderTypesByNodeUid,t.indent=this.indent,t.body=this.body,t.varCount=this.varCount,t._nodeEmitMap=this._nodeEmitMap,t}insertVertexShader(t){t.vertex.code.add(""),this._insertInputs(t,"vertex"),t.vertex.code.add(""),t.vertex.code.add("// OUTPUTS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this.rootOutputNodes()){const r="builtin"===e.outVariableType;if(!this.shouldPruneOutputNode(e))if(r)t.vertex.code.add(`// ${e.outVariableType.padEnd(7)} ${e.node.type.padEnd(9)} ${e.outVariableName};`);else{const r=[...e.qualifiers,e.outVariableType].join(" ");t.vertex.code.add(`${r.padEnd(10)} ${e.node.type.padEnd(9)} ${e.outVariableName};`)}}t.vertex.code.add(""),t.vertex.code.add("void main() {"),t.vertex.code.add("  "+this.body.split("\n").join("\n  "));for(const e of this.rootOutputNodes())this.shouldPruneOutputNode(e)||t.vertex.code.add(`  ${e.outVariableName} = ${e.variableName};`);t.vertex.code.add("}")}insertFragmentShader(t){this._insertInputs(t,"fragment"),t.fragment.code.add(""),t.fragment.code.add("// OUTPUTS: "),t.fragment.code.add("// --------------------------------------------------------- ");let e=0;for(const r of this.rootOutputNodes())"builtin"===r.outVariableType?t.fragment.code.add(`// ${r.outVariableType.padEnd(7)} ${r.node.type.padEnd(9)} ${r.outVariableName};`):t.outputs.add(r.outVariableName,r.node.type,e++);t.fragment.code.add(""),t.fragment.code.add("void main() {"),t.fragment.code.add("  "+this.body.split("\n").join("\n  "));for(const r of this.rootOutputNodes())"discard"===r.outVariableType?(t.fragment.code.add("  // TODO: Should ensure codegen for discard appears first in fragment shader"),t.fragment.code.add(`  if (${r.variableName}) {`),t.fragment.code.add("    discard;"),t.fragment.code.add("  }"),t.fragment.code.add("  ")):t.fragment.code.add(`  ${r.outVariableName} = ${r.variableName};`);t.fragment.code.add("}")}_insertInputs(t,e){t[e].code.add("// INPUTS: "),t[e].code.add("// --------------------------------------------------------- ");for(const r of this.inputs())if(r.isUsed&&"builtin"!==r.variableInputType)if("array"===r.node.type)t[e].code.add(`${r.variableInputType.padEnd(10)} ${r.node.elementType.type.padEnd(9)} ${r.variableName}[${r.node.size}];`);else if("array-2d"===r.node.type)t[e].code.add(`${r.variableInputType.padEnd(10)} ${r.node.elementType.type.padEnd(9)} ${r.variableName}[${r.node.size}]; // Emulated 2D Array. Not supported by ES3.0`);else{const n=[...r.qualifiers,r.variableInputType].join(" ");t[e].code.add(` ${n.padEnd(10)} ${r.node.type.padEnd(9)} ${r.variableName};`)}}}function d(t){switch(t.type){case"float":case"vec2":case"vec3":case"vec4":return null;case"int":case"ivec2":case"ivec3":case"ivec4":case"uint":case"uvec2":case"uvec3":case"uvec4":case"bool":case"bvec2":case"bvec3":case"bvec4":return"flat";case"mat2":case"mat3":case"mat4":case"array":case"sampler2D":case"array-2d":throw new Error(`InternalError: ${t.type} is not a valid output type`)}}var p=r(78492),f=r(2687);function m(t){return new t}function g(t,e,r){const n=t.constructor[e]??[];t.constructor.hasOwnProperty(e)||Object.defineProperty(t.constructor,e,{value:n.slice()}),t.constructor[e].push(r)}function y(t,e){return(r,n)=>{g(r,"locations",{typeCtor:e,propertyKey:n,parameterIndex:null,index:t})}}const _=t=>(e,r,n)=>{g(e,"inputs",{inputCtor:t,propertyKey:r,parameterIndex:n})},b=t=>(e,r)=>{g(e,"uniforms",{typeCtor:t,propertyKey:r})},v=t=>(e,r)=>{g(e,"options",{typeCtor:t,propertyKey:r})},w=(t,e)=>{g(t,"defines",{propertyKey:e})};const x=(t,e)=>(r,n)=>{r.constructor.builtins.push({builtin:t,propertyKey:n,typeCtor:e})};class T{static#t=(()=>this.builtins=[])()}(0,n.Cg)([x("gl_VertexID",s.Ai)],T.prototype,"glVertexID",void 0);class S{}class A{static#t=(()=>this.builtins=[])()}(0,n.Cg)([x("gl_FragCoord",s.Zb)],A.prototype,"glFragCoord",void 0),(0,n.Cg)([x("gl_PointCoord",s.ZY)],A.prototype,"glPointCoord",void 0);class ${}(0,n.Cg)([(t=>(e,r)=>{g(e,"builtins",{builtin:t,propertyKey:r})})("gl_FragDepth")],$.prototype,"glFragDepth",void 0);class N{constructor(){this.type="uniform-group"}get _uniforms(){return this.constructor.uniforms??[]}}class I{constructor(){this.logShader=!1,this.computeAttributes={}}get vertexInput(){const t=this._shaderModuleClass.inputs.findLast(t=>"vertex"===t.propertyKey&&0===t.parameterIndex);if(!t)throw new Error("Unable to find vertex input parameter");return t}get computeInput(){return this._shaderModuleClass.inputs.findLast(t=>"vertex"===t.propertyKey&&1===t.parameterIndex)}get fragmentInput(){const t=this._shaderModuleClass.inputs.findLast(t=>"fragment"===t.propertyKey);if(!t)throw new Error("Unable to find fragment input parameter");return t}get transformFeedbackBindings(){return this.fragmentInput.inputCtor.transformFeedbackBindings??[]}get locations(){return[...this.vertexInput.inputCtor.locations,...this.computeInput?.inputCtor.locations??[]]}get locationsMap(){const t=new Map,e=new Set;for(const r of this.locations)e.has(r.index)?i.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.GraphShaderModule").warnOnce("mapview-rendering",`Unable to assigned attribute ${r.propertyKey} to ${r.index}. Index already in use`,{locationsMap:t}):(t.set(r.propertyKey,r.index),e.add(r.index));return t}get locationInfo(){if(!this._locationInfo){const t=this.locationsMap,e=Array.from(t.entries()).map(t=>{let[e,r]=t;return`${e}.${r}`}).join("."),r=this.computeAttributes;this._locationInfo={stringHash:e,locations:t,computeAttributeMap:r}}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const e of this.locations)t.set("a_"+e.propertyKey,e.index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set;for(const e of this._options)t.add(e.propertyKey);this._optionPropertyKeys=t}return this._optionPropertyKeys}get _shaderModuleClass(){return this.constructor}get _defines(){return this._shaderModuleClass.defines??[]}get _options(){return this._shaderModuleClass.options??[]}get _uniforms(){return this._shaderModuleClass.uniforms??[]}getProgram(t,e,r,n){try{const{vertex:i,fragment:s,uniformBindings:o}=this._generateShaders(t,e,r,n);return new p.K(i,s,this.renamedLocationsMap,o,this.transformFeedbackBindings)}catch(i){return new p.K("","",this.renamedLocationsMap,[],this.transformFeedbackBindings)}}getDebugUniformClassInfo(t){const e=this._options.find(e=>e.propertyKey===t);if(e)return{type:"option",className:e.typeCtor};const r=this._uniforms.find(e=>e.propertyKey===t);if(!r)throw new Error(`Unable to find uniform class type for property: ${t}`);return{type:"required",className:r.typeCtor}}getShaderKey(t,e,r,n){const i=Object.keys(t).map(e=>`${e}.${t[e]}`).join("."),s=Object.keys(r).map(t=>`${t}.${r[t]}`).join("."),o=Object.keys(n).map(t=>`${t}.${n[t]}`).join("."),a=Object.keys(e).filter(t=>this.optionPropertyKeys.has(t)&&e[t]).join(".");return`${this.type}.${i}.${s}.${o}.${a}`}_generateShaders(t,e,r,n){const i=[];this._setDefines(r),this._setOptionalUniforms(i,e),this._setRequiredUniforms(i);const s=this._hydrateVertexInput(n),o=this._injectPackPrecisionFactor(s,t),u=this._hydrateComputeInput(),h=u&&this._injectComputePackPrecisionFactor(u,t),d=this.vertex(o,h),p=this._hydrateFragmentInput(d),f=this.fragment(p),m=new Set;for(const a in f){const t=f[a];(0,c.rz)(m,t)}const g=this._getVertexInputBuiltins(),y={};for(const[a,c]of Object.entries(s))y[a]=c;if(null!=u)for(const[a,c]of Object.entries(u))y[a]=c;const _=l.createVertex(y,d,g,i,this.transformFeedbackBindings,m);(new a).write(_);const b=this._getFragmentInputBuiltins(f);b.set("glPointCoord","gl_PointCoord"),b.set("glFragCoord","gl_FragCoord");const v=l.createFragment(p,f,b,i,_,this.transformFeedbackBindings);(new a).write(v);const w=this._createShaderBuilder(_,v),x=w.generate("vertex"),T=w.generate("fragment");return this.logShader&&(console.log(x),console.log(T)),{vertex:x,fragment:T,uniformBindings:i}}_setDefines(t){for(const e in t)this[e]=t[e]}_setOptionalUniforms(t,e){for(const r of this._options)e[r.propertyKey]?this[r.propertyKey]=this._hydrateUniformGroup(t,r):this[r.propertyKey]=null}_setRequiredUniforms(t){for(const e of this._uniforms)this[e.propertyKey]=this._hydrateUniformGroup(t,e)}_hydrateUniformGroup(t,e){const r=new(0,e.typeCtor);for(const n of r._uniforms??[]){const i=m(n.typeCtor),s=`u_${e.propertyKey}_${n.propertyKey}`,o=i.type,a=[e.propertyKey,n.propertyKey].join(".");if("type"in n.typeCtor&&"array"===n.typeCtor.type){const e=i;t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:i})}else if("type"in n.typeCtor&&"array-2d"===n.typeCtor.type){const e=i;t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformArrayLength:e.size,uniformArrayElementType:e.elementType.type,uniformHydrated:i})}else t.push({shaderModulePath:a,uniformName:s,uniformType:o,uniformHydrated:i});r[n.propertyKey]=i}return r}_hydrateVertexInput(t){const e=this.vertexInput.inputCtor,r=e.locations.reduce((e,r)=>!1===t[r.propertyKey]?e:{...e,[r.propertyKey]:m(r.typeCtor)},{});for(const{propertyKey:n,typeCtor:i}of e.builtins){const t=m(i);r[n]=t}return r}_hydrateComputeInput(){return null==this.computeInput?null:this.computeInput.inputCtor.locations.reduce((t,e)=>({...t,[e.propertyKey]:m(e.typeCtor)}),{})}_injectPackPrecisionFactor(t,e){const r={};for(const n in t){const i=t[n],o=e[n];if(o){if("float"!==i.type&&"vec2"!==i.type&&"vec3"!==i.type&&"vec4"!==i.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${i.type}`);r[n]=i.divide(new s.nt(o))}else r[n]=i}return r}_injectComputePackPrecisionFactor(t,e){const r={},n=new Map;for(const i in this.computeAttributes)for(const t of this.computeAttributes[i]??[])n.set(t,i);for(const i in t){const o=t[i],a=n.get(i);if(!a)continue;const c=e[a];if(c){if("float"!==o.type&&"vec2"!==o.type&&"vec3"!==o.type&&"vec4"!==o.type)throw new Error(`InternalError: packPrecisionFactor requires GenType, but found ${o.type}`);r[i]=o.divide(new s.nt(c))}else r[i]=o}return r}_hydrateFragmentInput(t){const e={};for(const r in t)e[r]=t[r];for(const{propertyKey:r,typeCtor:n}of A.builtins){const t=m(n);e[r]=t}return e}_getVertexInputBuiltins(){const t=this.vertexInput.inputCtor,e=new Map;for(const{builtin:r,propertyKey:n}of t.builtins)e.set(n,r);return e}_getFragmentInputBuiltins(t){const e=t.constructor,r=new Map;for(const n of e.builtins??[])r.set(n.propertyKey,n.builtin);return r}_createShaderBuilder(t,e){const r=new f.N5;return this._insertDebugInfo(r),t.insertVertexShader(r),e.insertFragmentShader(r),r}_insertDebugInfo(t){t.vertex.code.add("// DEFINES: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._defines)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`);t.vertex.code.add(""),t.vertex.code.add("// OPTIONS: "),t.vertex.code.add("// --------------------------------------------------------- ");for(const e of this._options)this[e.propertyKey]?t.vertex.code.add(`//   ${e.propertyKey}: true`):t.vertex.code.add(`//   ${e.propertyKey}: false`)}}},12331:(t,e,r)=>{r.d(e,{H:()=>h});r(81806);var n=r(76460),i=r(30726),s=r(76718),o=r(61678),a=r(93345),c=r(62881),u=r(80895);class h{constructor(t,e,r){if(this._context=t,this._glName=null,this._colorAttachments=new Map,this._depthStencilBuffer=null,this._depthStencilTexture=null,this._initialized=!1,t.instanceCounter.increment(a.vt.FramebufferObject,this),null!=e){const r=function(t,e){return l(e)||d(e)?e:p(e)?new u.g(t,e):function(t){return 3===f(t)||null!=t&&"samples"in t}(e)?new c.l(t,e):null}(t,e);null!=r&&(this._colorAttachments.set(a.r6,r),l(r)?this._validateTextureDescriptor(r.descriptor):this._validateRenderbufferDescriptor(r.descriptor)),this._validateColorAttachmentPoint(a.r6)}if(null!=r)if(function(t){return l(t)||p(t)}(r))this._depthStencilTexture=l(r)?r:new u.g(t,r),this._validateTextureDescriptor(this._depthStencilTexture.descriptor);else{const e=d(r)?r:new c.l(t,r);this._depthStencilBuffer=e,this._validateRenderbufferDescriptor(e.descriptor)}}dispose(){const{_colorAttachments:t,_glName:e}=this;if(0===t.size&&!this._depthStencilBuffer&&!this._depthStencilTexture&&!e)return;const{_context:r}=this,n=r.getBoundFramebufferObject();t.forEach((t,e)=>this.detachColorTexture(e)?.dispose()),this.detachDepthStencilBuffer()?.dispose(),this.detachDepthStencilTexture()?.dispose(),r.gl.deleteFramebuffer(e),this._glName=null,r.bindFramebuffer(n===this?null:n),r.instanceCounter.decrement(a.vt.FramebufferObject,this)}get glName(){return this._glName}get colorTexture(){const t=this._colorAttachments.get(a.r6);return l(t)?t:null}get depthStencil(){return this._depthStencilTexture||this._depthStencilBuffer}get depthStencilTexture(){return this._depthStencilTexture}get width(){const t=this._colorAttachments.get(a.r6)??this._depthStencilTexture??this._depthStencilBuffer;return t?.descriptor?.width??0}get height(){const t=this._colorAttachments.get(a.r6)??this._depthStencilTexture??this._depthStencilBuffer;return t?.descriptor?.height??0}get usedMemory(){return[...this._colorAttachments].reduce((t,e)=>{let[r,n]=e;return t+n.usedMemory},this.depthStencil?.usedMemory??0)}static#t=(()=>this._MAX_COLOR_ATTACHMENTS=-1)();getColorTexture(t){const e=this._colorAttachments.get(t);return e&&l(e)?e:null}get colorAttachments(){return[...this._colorAttachments.keys()]}attachColorTexture(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.r6;if(!t)return;this._validateColorAttachmentPoint(e);const{descriptor:r}=t;this._validateTextureDescriptor(r),this.detachColorTexture(e)?.dispose(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,e)),this._colorAttachments.set(e,t)}detachColorTexture(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.r6;const e=this._colorAttachments.get(t);if(!e)return;const r=l(e);return this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{if(r)this._framebufferTexture2D(null,t);else{const e=this._context.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,t,e.RENDERBUFFER,null)}}),this._colorAttachments.delete(t),r?e:void 0}setColorTextureTarget(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.r6,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const n=this._colorAttachments.get(e);n&&(35866===t?this._framebufferTextureLayer(n.glName,e,36160,0,r):this._framebufferTexture2D(n.glName,e,t,36160,0))}attachDepthStencil(t){if(t)switch(t.type){case 1:return this._attachDepthStencilTexture(t);case 2:return this._attachDepthStencilBuffer(t)}}_attachDepthStencilTexture(t){if(null==t)return;const{descriptor:e}=t,{pixelFormat:r,dataType:n}=e;34041===r||6402===r?34041!==r||n===a.ld.UNSIGNED_INT_24_8?6402!==r||n===a.ld.UNSIGNED_INT||n===a.ld.UNSIGNED_SHORT?(this._validateTextureDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(t.glName,y(r))),this._depthStencilTexture?.dispose(),this._depthStencilTexture=t):console.error("Depth texture must have data type of UNSIGNED_INT or UNSIGNED_SHORT!"):console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!"):console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!")}detachDepthStencilTexture(){const t=this._depthStencilTexture;return t&&this._initialized&&this._context.temporaryBindFramebufferObject(this,()=>{this._framebufferTexture2D(null,y(t.descriptor.pixelFormat))}),this._depthStencilTexture=null,t}_attachDepthStencilBuffer(t){if(null==t)return;const e=t.descriptor;if(this._validateRenderbufferDescriptor(e),this._disposeDepthStencilAttachments(),this._initialized){this._context.bindFramebuffer(this);const{gl:r}=this._context,n=this._getGLAttachmentPoint(e);r.framebufferRenderbuffer(36160,n,r.RENDERBUFFER,t.glName)}this._depthStencilBuffer=t}detachDepthStencilBuffer(){const t=this._depthStencilBuffer;if(t&&this._initialized){const{_context:e}=this,r=e.getBoundFramebufferObject();e.bindFramebuffer(this);const{gl:n}=e,i=this._getGLAttachmentPoint(t.descriptor);n.framebufferRenderbuffer(36160,i,n.RENDERBUFFER,null),e.bindFramebuffer(r)}return this._depthStencilBuffer=null,t}invalidateAttachments(t){const{_context:e}=this;e.temporaryBindFramebufferObject(this,()=>e.gl.invalidateFramebuffer(36160,t),!0)}copyToTexture(t,e,r,n,i,s,o){(t<0||e<0||i<0||s<0)&&console.error("Offsets cannot be negative!"),(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!");const a=o.descriptor;3553!==o.descriptor.target&&console.error("Texture target must be TEXTURE_2D!"),(null==a?.width||null==a?.height||t+r>this.width||e+n>this.height||i+r>a.width||s+n>a.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");const c=this._context,h=c.bindTexture(o,u.g.TEXTURE_UNIT_FOR_UPDATES);c.setActiveTexture(u.g.TEXTURE_UNIT_FOR_UPDATES),c.bindFramebuffer(this),c.gl.copyTexSubImage2D(3553,0,i,s,t,e,r,n),c.bindTexture(h,u.g.TEXTURE_UNIT_FOR_UPDATES)}readPixels(t,e,r,n,i,s,o){(r<=0||n<=0)&&console.error("Copy width and height must be greater than zero!"),o||console.error("Target memory is not initialized!"),this._context.bindFramebuffer(this),this._context.gl.readPixels(t,e,r,n,i,s,o)}async readPixelsAsync(t,e,r,n,i,o,a){const{gl:c}=this._context,u=s.g.createPixelPack(this._context,35041,a.byteLength);this._context.bindBuffer(u);const h=this._context.getBoundFramebufferObject();this._context.bindFramebuffer(this),c.readPixels(t,e,r,n,i,o,0),this._context.unbindBuffer(35051),this._context.bindFramebuffer(h),await u.getSubDataAsync(a),u.dispose()}resize(t,e){if(this.width===t&&this.height===e)return;const r={width:t,height:e};if(m(r,this._context.parameters.maxTextureSize),this._colorAttachments.forEach(t=>t.resize(r.width,r.height)),this._depthStencilTexture?.resize(r.width,r.height),this._initialized&&(m(r,this._context.parameters.maxRenderbufferSize),this._depthStencilBuffer?.resize(r.width,r.height),(0,o.en)())){const{gl:t}=this._context;t.checkFramebufferStatus(36160)!==t.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!")}}initializeAndBind(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:36160;const{gl:e}=this._context;if(this._initialized)return void e.bindFramebuffer(t,this.glName);this._glName&&e.deleteFramebuffer(this._glName);const r=e.createFramebuffer();if(e.bindFramebuffer(t,r),this._colorAttachments.forEach((e,r)=>{if(l(e)){const n=g(e);35866===n?this._framebufferTextureLayer(e.glName,r,t,0,0):this._framebufferTexture2D(e.glName,r,n,t)}else if(d(e)){const n=this._context.gl;n.framebufferRenderbuffer(t,r,n.RENDERBUFFER,e.glName)}}),this._depthStencilBuffer){const r=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);e.framebufferRenderbuffer(t,r,e.RENDERBUFFER,this._depthStencilBuffer.glName)}else if(this._depthStencilTexture){const e=y(this._depthStencilTexture.descriptor.pixelFormat);this._framebufferTexture2D(this._depthStencilTexture.glName,e,g(this._depthStencilTexture),t)}(0,o.en)()&&e.checkFramebufferStatus(t)!==e.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!"),this._glName=r,this._initialized=!0}_framebufferTexture2D(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.r6,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3553,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:36160,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this._context.gl.framebufferTexture2D(n,e,r,t,i)}_framebufferTextureLayer(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a.r6,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:36160,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this._context.gl.framebufferTextureLayer(r,e,t,n,i)}_disposeDepthStencilAttachments(){const t=this._context.gl;if(this._depthStencilBuffer){if(this._initialized){this._context.bindFramebuffer(this);const e=this._getGLAttachmentPoint(this._depthStencilBuffer.descriptor);t.framebufferRenderbuffer(36160,e,t.RENDERBUFFER,null)}this._depthStencilBuffer=(0,i.WD)(this._depthStencilBuffer)}this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,y(this._depthStencilTexture.descriptor.pixelFormat))),this._depthStencilTexture=(0,i.WD)(this._depthStencilTexture))}_validateTextureDescriptor(t){3553!==t.target&&34067!==t.target&&35866!==t.target&&console.error("Texture type must be TEXTURE_2D, TEXTURE_2D_ARRAY or TEXTURE_CUBE_MAP!"),m(t,this._context.parameters.maxTextureSize),this._validateBufferDimensions(t)}_validateRenderbufferDescriptor(t){m(t,this._context.parameters.maxRenderbufferSize),this._validateBufferDimensions(t)}_validateBufferDimensions(t){t.width<=0&&(t.width=this.width),t.height<=0&&(t.height=this.height),this.width>0&&this.height>0&&(this.width===t.width&&this.height===t.height||console.error("Attachment size must match framebuffer size!"))}_getGLAttachmentPoint(t){switch(t.internalFormat){case a.SB.DEPTH_COMPONENT16:case a.SB.DEPTH_COMPONENT24:case a.SB.DEPTH_COMPONENT32F:return a.xL;case a.iE.DEPTH24_STENCIL8:case a.iE.DEPTH32F_STENCIL8:return a.nI;case 36168:return a.uH;default:return a.r6}}_validateColorAttachmentPoint(t){if(-1===h._MAX_COLOR_ATTACHMENTS){const{gl:t}=this._context;h._MAX_COLOR_ATTACHMENTS=t.getParameter(t.MAX_COLOR_ATTACHMENTS)}const e=t-a.r6;e+1>h._MAX_COLOR_ATTACHMENTS&&n.A.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${e+1}. Implementation supports up to ${h._MAX_COLOR_ATTACHMENTS} color attachments`)}}function l(t){return 1===f(t)}function d(t){return 2===f(t)}function p(t){return 0===f(t)}function f(t){return null!=t&&"type"in t?t.type:null}function m(t,e){const r=Math.max(t.width,t.height);if(r>e){n.A.getLogger("esri.views.webgl.FramebufferObject").warnOnce(`Resizing FBO attachment size ${t.width}x${t.height} to device limit ${e}`);const i=e/r;return t.width=Math.round(t.width*i),t.height=Math.round(t.height*i),!1}return!0}function g(t){return 34067===t.descriptor.target?34069:35866===t.descriptor.target?35866:3553}function y(t){return 6402===t?a.xL:a.nI}},22881:(t,e,r)=>{function n(t,e){const r=[];for(r.push(e);r.length;){const e=r.pop();if("object"==typeof e&&!t.has(e.uid)){t.add(e.uid);for(const t of e.children)r.push(t)}}}r.d(e,{XL:()=>h,aw:()=>d,ff:()=>u,rR:()=>l,rz:()=>n,vA:()=>s,vL:()=>o,zg:()=>c});class i{constructor(){this.uid=i.NodeCount++,this._debugName=null,this._isMutable=!1,this.isImplicit=!1}static#t=(()=>this.NodeCount=0)();get isMutable(){return this._isMutable}setMutable(){return this._isMutable=!0,this}setDebugName(t){return t=function(t){return t.split(" ").map((t,e)=>e>0?t.charAt(0).toUpperCase()+t.slice(1):t).join("")}(t),this._debugName=t,this.isImplicit&&this.children[0]instanceof i&&this.children[0].setDebugName(t),this}get debugInfo(){return{name:this._debugName??""}}cloneInto(t){t._debugName=this._debugName,t._isMutable=this._isMutable,t.isImplicit=this.isImplicit,t.uid=this.uid}}function s(t){return"object"==typeof t?t.clone():t}class o extends i{constructor(){super(...arguments),this.shaderType="primitive-node"}}class a extends i{constructor(t){super(),this.child=t,this.shaderType="scope-node"}get children(){return[this.child]}clone(){const t=new a(s(this.child));return this.cloneInto(t),t}}class c extends i{constructor(t,e,r){super(),this.property=t,this.target=e,this.returnType=r,this.shaderType="property-access-node"}get children(){const t=[this.target];return"string"!=typeof this.property&&t.push(this.property),t}clone(){const t=new c(this.property,s(this.target),this.returnType);return this.cloneInto(t),t}}class u extends i{constructor(t,e,r,n){super(),this.x=t,this.y=e,this.target=r,this.returnType=n,this.shaderType="property-access-2d-node"}get children(){return[this.target,this.x,this.y]}clone(){const t=new u(this.x,this.y,s(this.target),this.returnType);return this.cloneInto(t),t}}class h extends i{constructor(t,e,r){super(),this.condition=t,this.ifTrue=e,this.ifFalse=r,this.shaderType="condition-node"}get children(){return[this.condition,this.ifTrue,this.ifFalse]}clone(){const t=s(this.ifTrue),e=this.ifFalse?s(this.ifFalse):null,r=new h(this.condition,t,e);return this.cloneInto(r),r}}class l extends i{constructor(t,e,r,n){super(),this.captureList=t,this.returnType=e,this.generator=n,this.shaderType="block-node",r&&(this.subgraph=new a(r))}get children(){return Object.keys(this.captureList).map(t=>this.captureList[t]).concat(this.subgraph??[])}clone(){const t={};for(const r in this.captureList)t[r]=s(this.captureList[r]);const e=new l(t,this.returnType,this.subgraph?s(this.subgraph.child):this.subgraph,this.generator);return this.cloneInto(e),e}}class d extends i{constructor(t,e,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];super(),this.token=t,this._children=e,this.isInfix=r,this.isPropertyAccess=n,this.returnType=i,this.isTernary=s,this.shaderType="function-node"}get children(){return this._children}clone(){const t=new d(this.token,this._children.map(s),this.isInfix,this.isPropertyAccess,this.returnType,this.isTernary);return this.cloneInto(t),t}}},60984:(t,e,r)=>{r.d(e,{$5:()=>xt,$I:()=>V,$T:()=>pe,AU:()=>te,Ai:()=>L,Bw:()=>Ht,Cq:()=>U,Ec:()=>vt,F8:()=>ie,FM:()=>_t,Gb:()=>dt,HQ:()=>Et,I8:()=>$t,Io:()=>zt,L0:()=>se,LC:()=>bt,LI:()=>re,MM:()=>Tt,Ml:()=>ue,My:()=>x,Ny:()=>j,Om:()=>jt,PM:()=>ce,RI:()=>Vt,RZ:()=>ae,Rm:()=>Xt,S8:()=>Jt,Sj:()=>ft,T9:()=>Yt,TF:()=>oe,Tk:()=>ot,U:()=>K,US:()=>de,Uo:()=>Nt,Wh:()=>H,Xe:()=>wt,YN:()=>Ft,ZY:()=>$,Zb:()=>I,Zc:()=>q,_S:()=>ne,_i:()=>T,aX:()=>St,eB:()=>N,eR:()=>Y,fV:()=>X,gn:()=>Ut,hC:()=>yt,j1:()=>at,jc:()=>Gt,jh:()=>Zt,jk:()=>Wt,ln:()=>W,lw:()=>ct,mk:()=>kt,n7:()=>ee,nP:()=>le,nf:()=>mt,nt:()=>A,oN:()=>Kt,om:()=>st,or:()=>At,p6:()=>qt,pu:()=>gt,qE:()=>Lt,qR:()=>Ct,rY:()=>Pt,rf:()=>Bt,tn:()=>It,w0:()=>Z,wH:()=>pt,x:()=>C,yH:()=>Rt,yI:()=>Ot,ym:()=>he,z7:()=>S,ze:()=>it,zi:()=>Qt});var n,i,s,o,a,c,u,h,l,d,p,f,m,g,y=r(6326),_=r(22881);function b(t){return new Proxy(t,{get(e,r){if("constructor"===r)return new Proxy(e.constructor,{construct:(t,e,r)=>b(new t(...e))});if(r in e)return e[r];if("string"==typeof r){const e=function(t){const e=[["float","vec2","vec3","vec4"],["int","ivec2","ivec3","ivec4"],["uint","uvec2","uvec3","uvec4"],["bool","bvec2","bvec3","bvec4"]];for(const r of e)if(r.includes(t))return r.map(t=>G[t]);throw new Error("Unable to find type family")}(t.type);return Q(t,r,e[r.length-1])}}})}function v(t){return new Proxy(t,{construct:(t,e,r)=>b(new t(...e))})}class w extends Error{}let x=class extends _.vL{static#t=(()=>n=this)();static#e=(()=>this.type="array")();constructor(t,e){super(),this.elementType=t,this.size=e,this.children=[],this.type="array"}clone(){const t=new n(this.elementType,this.size);return super.cloneInto(t),t}get(t,e){const r=new L(t),n=null!=e?new L(e):null;return null!=n?J(this,r,n,function(t){switch(t.type){case"bool":case"bvec2":case"bvec3":case"bvec4":return C;case"float":case"vec2":case"vec3":case"vec4":return A;case"int":case"ivec2":case"ivec3":case"ivec4":return L;case"uint":case"uvec2":case"uvec3":case"uvec4":return E;default:throw new Error("Unable to handle type")}}(this.elementType.constructor)):Q(this,r,this.elementType.constructor)}last(){return this.get(this.size-1)}first(){return this.get(0)}findIndex(t,e,r){return function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.size;const i=new L(r).setMutable().setDebugName("FindIndexIterator"),s=e(t.get(i)).setDebugName("FindIndexPredicate"),o=st({iter:i},L,s,t=>{let{out:e,iter:r,subgraph:i}=t;return`\n${e} = -1;\n\nfor (; ${r} < ${n}; ${r}++) {\n\n${i.body}\n\n  if (${i.varName}) {\n    ${e} = ${r};\n    break;\n  }\n\n}\n`}).setDebugName("FindIndexBlock");return o}(this,t,e,r)}glslFindIndex(t,e,r){return function(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.size;const i=st({array:t},L,null,t=>{let{out:i,array:s}=t;return`\n${i} = -1;\nfor (int i = ${r}; i < ${n}; i++) {\n  bool condition;\n  ${e({array:s,i:"i",out:"condition"})}\n  if (condition) {\n    ${i} = i;\n    break;\n  }\n}\n`}).setDebugName("GlslFindIndexBlock");return i}(this,t,e,r)}static ofType(t,e){const r={construct:(r,i)=>new n(new t,e)};return new Proxy(n,r)}};x=n=(0,y.Cg)([function(t){return new Proxy(t,{construct:(t,e,r)=>function(t){return new Proxy(t,{get(e,r){if(r in e)return e[r];if("string"==typeof r){const e=parseInt(r,10);if(!isNaN(e))return Q(t,`[${e}]`,t.elementType.constructor)}}})}(new t(...e))})}],x);class T extends _.vL{static#t=(()=>this.type="array-2d")();constructor(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];super(),this.elementType=t,this.xSize=e,this.ySize=r,this.isRowMajor=n,this.children=[],this.type="array-2d"}clone(){const t=new T(this.elementType,this.xSize,this.ySize,this.isRowMajor);return super.cloneInto(t),t}get size(){return this.xSize*this.ySize}get(t,e){return this.isRowMajor?this._getRowMajor(t,e):this._getColumnMajor(t,e)}_getColumnMajor(t,e){const r=new L(t);return Q(this,new L(e).add(r.multiply(this.xSize)),this.elementType.constructor)}_getRowMajor(t,e){const r=new L(t),n=new L(e);return Q(this,r.add(n.multiply(this.ySize)),this.elementType.constructor)}static ofType(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Proxy(x,{construct:(i,s)=>new T(new t,e,r,n)})}}class S extends _.vL{constructor(){super(...arguments),this.type="sampler2D",this.children=[]}static#t=(()=>this.type="sampler2D")();clone(){const t=new S;return t.children=this.children.map(_.vA),super.cloneInto(t),t}}class A extends _.vL{static#t=(()=>this.type="float")();constructor(t){super(),this.type="float",this.children=[t]}clone(){const t=new A((0,_.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return ct(this,"number"==typeof t?B(t,A):t)}divide(t){return ut(this,"number"==typeof t?B(t,A):t)}add(t){return ht(this,"number"==typeof t?B(t,A):t)}subtract(t){return lt(this,"number"==typeof t?B(t,A):t)}}let $=class extends _.vL{static#t=(()=>i=this)();static#e=(()=>this.type="vec2")();constructor(t,e){super(),this.type="vec2",this.children=[t,e].filter(t=>null!=t)}clone(){const t=new i((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",A)}get 1(){return Q(this,"[1]",A)}get 2(){throw new w}get 3(){throw new w}multiply(t){return ct(this,"number"==typeof t?B(t,A):t)}divide(t){return ut(this,"number"==typeof t?B(t,A):t)}add(t){return ht(this,"number"==typeof t?B(t,A):t)}subtract(t){return lt(this,"number"==typeof t?B(t,A):t)}};$=i=(0,y.Cg)([v],$);let N=class extends _.vL{static#t=(()=>s=this)();static#e=(()=>this.type="vec3")();constructor(t,e,r){super(),this.type="vec3",this.children=[t,e,r].filter(t=>null!=t)}get 0(){return Q(this,"[0]",A)}get 1(){return Q(this,"[1]",A)}get 2(){return Q(this,"[2]",A)}get 3(){throw new w}clone(){const t=new s((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]));return super.cloneInto(t),t}multiply(t){return ct(this,"number"==typeof t?B(t,A):t)}divide(t){return ut(this,"number"==typeof t?B(t,A):t)}add(t){return ht(this,"number"==typeof t?B(t,A):t)}subtract(t){return lt(this,"number"==typeof t?B(t,A):t)}};N=s=(0,y.Cg)([v],N);let I=class extends _.vL{static#t=(()=>o=this)();static#e=(()=>this.type="vec4")();constructor(t,e,r,n){super(),this.type="vec4",this.children=[t,e,r,n].filter(t=>null!=t)}clone(){const t=new o((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",A)}get 1(){return Q(this,"[1]",A)}get 2(){return Q(this,"[2]",A)}get 3(){return Q(this,"[3]",A)}multiply(t){return ct(this,"number"==typeof t?B(t,A):t)}divide(t){return ut(this,"number"==typeof t?B(t,A):t)}add(t){return ht(this,"number"==typeof t?B(t,A):t)}subtract(t){return lt(this,"number"==typeof t?B(t,A):t)}};I=o=(0,y.Cg)([v],I);let E=class extends _.vL{static#t=(()=>a=this)();static#e=(()=>this.type="uint")();constructor(t){super(),this.type="uint",this.children=[t]}clone(){const t=new a((0,_.vA)(this.children[0]));return super.cloneInto(t),t}multiply(t){return ct(this,B(t,a))}add(t){return ht(this,B(t,a))}subtract(t){return lt(this,B(t,a))}divide(t){return ut(this,B(t,a))}};E=a=(0,y.Cg)([v],E);let F=class extends _.vL{static#t=(()=>c=this)();static#e=(()=>this.type="uvec2")();constructor(t,e){super(),this.type="uvec2",this.children=[t,e].filter(t=>null!=t)}clone(){const t=new c((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",L)}get 1(){return Q(this,"[1]",L)}get 2(){throw new w}get 3(){throw new w}multiply(t){return ct(this,"number"==typeof t?B(t,E):t)}divide(t){return ut(this,"number"==typeof t?B(t,E):t)}add(t){return ht(this,"number"==typeof t?B(t,E):t)}subtract(t){return lt(this,"number"==typeof t?B(t,E):t)}};F=c=(0,y.Cg)([v],F);let D=class extends _.vL{static#t=(()=>u=this)();static#e=(()=>this.type="uvec3")();constructor(t,e,r){super(),this.type="uvec3",this.children=[t,e,r].filter(t=>null!=t)}clone(){const t=new u((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",E)}get 1(){return Q(this,"[1]",E)}get 2(){return Q(this,"[2]",E)}get 3(){throw new w}multiply(t){return ct(this,"number"==typeof t?B(t,E):t)}divide(t){return ut(this,"number"==typeof t?B(t,E):t)}add(t){return ht(this,"number"==typeof t?B(t,E):t)}subtract(t){return lt(this,"number"==typeof t?B(t,E):t)}};D=u=(0,y.Cg)([v],D);let M=class extends _.vL{static#t=(()=>h=this)();static#e=(()=>this.type="uvec4")();constructor(t,e,r,n){super(),this.type="uvec4",this.children=[t,e,r,n].filter(t=>null!=t)}clone(){const t=new h((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",E)}get 1(){return Q(this,"[1]",E)}get 2(){return Q(this,"[2]",E)}get 3(){return Q(this,"[3]",E)}multiply(t){return ct(this,"number"==typeof t?B(t,E):t)}divide(t){return ut(this,"number"==typeof t?B(t,E):t)}add(t){return ht(this,"number"==typeof t?B(t,E):t)}subtract(t){return lt(this,"number"==typeof t?B(t,E):t)}};M=h=(0,y.Cg)([v],M);class C extends _.vL{static#t=(()=>this.type="bool")();constructor(t){super(),this.type="bool",this.children=[t]}and(t){return Nt(this,t)}or(t){return At(this,t)}xor(t){return $t(this,t)}clone(){const t=new C((0,_.vA)(this.children[0]));return super.cloneInto(t),t}}let R=class extends _.vL{static#t=(()=>l=this)();static#e=(()=>this.type="bvec2")();constructor(t,e){super(),this.type="bvec2",this.children=[t,e].filter(t=>null!=t)}all(){return Dt(this)}any(){return Mt(this)}clone(){const t=new l((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]));return super.cloneInto(t),t}};R=l=(0,y.Cg)([v],R);let P=class extends _.vL{static#t=(()=>d=this)();static#e=(()=>this.type="bvec3")();constructor(t,e,r){super(),this.type="bvec3",this.children=[t,e,r].filter(t=>null!=t)}all(){return Dt(this)}any(){return Mt(this)}clone(){const t=new d((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]));return super.cloneInto(t),t}};function B(t,e){return"number"==typeof t?new e(t):t}P=d=(0,y.Cg)([v],P);let k=class extends _.vL{static#t=(()=>p=this)();static#e=(()=>this.type="bvec4")();constructor(t,e,r,n){super(),this.type="bvec4",this.children=[t,e,r,n].filter(t=>null!=t)}all(){return Dt(this)}any(){return Mt(this)}clone(){const t=new p((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]));return super.cloneInto(t),t}};k=p=(0,y.Cg)([v],k);class L extends _.vL{static#t=(()=>this.type="int")();constructor(t){super(),this.type="int",this.children=[t]}multiply(t){return ct(this,B(t,L))}add(t){return ht(this,B(t,L))}subtract(t){return lt(this,B(t,L))}divide(t){return ut(this,B(t,L))}clone(){const t=new L((0,_.vA)(this.children[0]));return super.cloneInto(t),t}}let U=class extends _.vL{static#t=(()=>f=this)();static#e=(()=>this.type="ivec2")();constructor(t,e){super(),this.type="ivec2",this.children=[t,e].filter(t=>null!=t)}clone(){const t=new f((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",L)}get 1(){return Q(this,"[1]",L)}get 2(){throw new w}get 3(){throw new w}multiply(t){return ct(this,"number"==typeof t?B(t,L):t)}divide(t){return ut(this,"number"==typeof t?B(t,L):t)}add(t){return ht(this,"number"==typeof t?B(t,L):t)}subtract(t){return lt(this,"number"==typeof t?B(t,L):t)}};U=f=(0,y.Cg)([v],U);let O=class extends _.vL{static#t=(()=>m=this)();static#e=(()=>this.type="ivec3")();constructor(t,e,r){super(),this.type="ivec3",this.children=[t,e,r].filter(t=>null!=t)}clone(){const t=new m((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",L)}get 1(){return Q(this,"[1]",L)}get 2(){return Q(this,"[2]",L)}get 3(){throw new w}multiply(t){return ct(this,"number"==typeof t?B(t,L):t)}divide(t){return ut(this,"number"==typeof t?B(t,L):t)}add(t){return ht(this,"number"==typeof t?B(t,L):t)}subtract(t){return lt(this,"number"==typeof t?B(t,L):t)}};O=m=(0,y.Cg)([v],O);let z=class extends _.vL{static#t=(()=>g=this)();static#e=(()=>this.type="ivec4")();constructor(t,e,r,n){super(),this.type="ivec4",this.children=[t,e,r,n].filter(t=>null!=t)}clone(){const t=new g((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]));return super.cloneInto(t),t}get 0(){return Q(this,"[0]",L)}get 1(){return Q(this,"[1]",L)}get 2(){return Q(this,"[2]",L)}get 3(){return Q(this,"[3]",L)}multiply(t){return ct(this,"number"==typeof t?B(t,L):t)}divide(t){return ut(this,"number"==typeof t?B(t,L):t)}add(t){return ht(this,"number"==typeof t?B(t,L):t)}subtract(t){return lt(this,"number"==typeof t?B(t,L):t)}};z=g=(0,y.Cg)([v],z);class j extends _.vL{static#t=(()=>this.type="mat2")();constructor(t,e,r,n){super(),this.type="mat2",this.children=[t,e,r,n]}clone(){const t=new j((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]));return super.cloneInto(t),t}get(t,e){return J(this,new L(t),new L(e),A)}multiply(t){return ct(this,t)}}class K extends _.vL{static#t=(()=>this.type="mat3")();static identity(){return new K(1,0,0,0,1,0,0,0,1)}static fromRotation(t){const e=ie(t),r=Ut(t);return new K(r,e,0,it(e),r,0,0,0,1)}constructor(t,e,r,n,i,s,o,a,c){super(),this.type="mat3",this.children=[t,e,r,n,i,s,o,a,c]}add(t){return ht(this,t)}multiply(t){return ct(this,t)}get(t,e){return J(this,new L(t),new L(e),A)}clone(){const t=new K((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]),(0,_.vA)(this.children[4]),(0,_.vA)(this.children[5]),(0,_.vA)(this.children[6]),(0,_.vA)(this.children[7]),(0,_.vA)(this.children[8]));return super.cloneInto(t),t}}class V extends _.vL{static#t=(()=>this.type="mat4")();static identity(){return new V(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)}constructor(t,e,r,n,i,s,o,a,c,u,h,l,d,p,f,m){super(),this.type="mat4",this.children=[t,e,r,n,i,s,o,a,c,u,h,l,d,p,f,m]}static fromColumns(t,e,r,n){return new V(t.x,t.y,t.z,t.w,e.x,e.y,e.z,e.w,r.x,r.y,r.z,r.w,n.x,n.y,n.z,n.w)}multiply(t){return ct(this,t)}get(t,e){return J(this,new L(t),new L(e),A)}clone(){const t=new V((0,_.vA)(this.children[0]),(0,_.vA)(this.children[1]),(0,_.vA)(this.children[2]),(0,_.vA)(this.children[3]),(0,_.vA)(this.children[4]),(0,_.vA)(this.children[5]),(0,_.vA)(this.children[6]),(0,_.vA)(this.children[7]),(0,_.vA)(this.children[8]),(0,_.vA)(this.children[9]),(0,_.vA)(this.children[10]),(0,_.vA)(this.children[11]),(0,_.vA)(this.children[12]),(0,_.vA)(this.children[13]),(0,_.vA)(this.children[14]),(0,_.vA)(this.children[15]));return super.cloneInto(t),t}}const G={float:A,vec2:$,vec3:N,vec4:I,int:L,ivec2:U,ivec3:O,ivec4:z,uint:E,uvec2:F,uvec3:D,uvec4:M,bool:C,bvec2:R,bvec3:P,bvec4:k},H=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new L(...e)},X=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new A(...e)},q=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new $(...e)},Y=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new N(...e)},W=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new I(...e)},Z=function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return new K(...e)};function Q(t,e,r){const n=new r(new _.zg(e,t,r));return n.isImplicit=!0,n}function J(t,e,r,n){const i=new n(new _.ff(e,r,t,n));return i.isImplicit=!0,i}function tt(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(n){const i=new n,s=new n(new _.aw(t,[e,r],!0,!1,i));return s.isImplicit=!0,s}if("float"===e.type||"int"===e.type){const n=new r.constructor(new _.aw(t,[e,r],!0,!1,r.constructor));return n.isImplicit=!0,n}if(("mat2"===e.type||"mat3"===e.type||"mat4"===e.type)&&"float"!==r.type){const n=new r.constructor(new _.aw(t,[e,r],!0,!1,r.constructor));return n.isImplicit=!0,n}const i=new e.constructor(new _.aw(t,[e,r],!0,!1,e.constructor));return i.isImplicit=!0,i}function et(t,e){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.constructor;const n=new r(new _.aw(t,[e],!1,!1,r));return n.isImplicit=!0,n}function rt(t,e,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.constructor;const i=new n(new _.aw(t,[e,r],!1,!1,n));return i.isImplicit=!0,i}function nt(t,e,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.constructor;const s=new i(new _.aw(t,[e,r,n],!1,!1,i));return s.isImplicit=!0,s}function it(t){return ct(t,X(-1))}function st(t,e,r,n){return new e(new _.rR(t,e,r,n))}function ot(t,e,r){const n="function"==typeof e?e():e,i="function"==typeof r?r():r,s=new n.constructor(new _.XL(t,n,i));return s.isImplicit=!0,s}function at(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];const n=e.map(t=>{let[e,r]=t;return"function"==typeof r?[e,r()]:[e,r]}),i=n[0][1].constructor,s=n.findIndex(t=>!0===t[0]);if(-1===s)throw new Error("A cond must have a fallthrough case with `true`/; ");const o=n.slice(0,s),a=n[s][1],c=new i(o.reduceRight((t,e)=>ot(e[0],e[1],t),a));return c.isImplicit=!0,c}function ct(t,e){return tt("*",t,e)}function ut(t,e){return tt("/",t,e)}function ht(t,e){return tt("+",t,e)}function lt(t,e){return tt("-",t,e)}function dt(t,e){return tt("%",t,e)}function pt(t,e){return tt("<<",t,e)}function ft(t,e){return tt(">>",t,e)}function mt(t,e){return tt("&",t,e)}function gt(t,e){return tt("|",t,e)}function yt(t,e){return tt("^",t,e)}function _t(t){return et("~",t)}function bt(t,e){return tt("==",t,e,C)}function vt(t,e){return tt("!=",t,e,C)}function wt(t,e){return tt("<",t,e,C)}function xt(t,e){return tt("<=",t,e,C)}function Tt(t,e){return tt(">",t,e,C)}function St(t,e){return tt(">=",t,e,C)}function At(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length<=1?e[0]:e.slice(1).reduce((t,e)=>function(t,e){return tt("||",t,e,C)}(t,e),e[0])}function $t(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length<=1?e[0]:e.slice(1).reduce((t,e)=>function(t,e){return tt("^^",t,e,C)}(t,e),e[0])}function Nt(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.length<=1?e[0]:e.slice(1).reduce((t,e)=>function(t,e){return tt("&&",t,e,C)}(t,e),e[0])}function It(t){return et("abs",t)}function Et(t){return et("acos",t)}function Ft(t){return et("acosh",t)}function Dt(t){return et("all",t,C)}function Mt(t){return et("any",t,C)}function Ct(t){return et("asin",t)}function Rt(t){return et("asinh",t)}function Pt(t,e){return null==e?et("atan",t):rt("atan",t,e,t.constructor)}function Bt(t){return et("atanh",t)}function kt(t){return et("ceil",t)}function Lt(t,e,r){return nt("clamp",t,e,r,t.constructor)}function Ut(t){return et("cos",t)}function Ot(t){return et("cosh",t)}function zt(t,e){return rt("distance",t,e,A)}function jt(t,e){return rt("dot",t,e,A)}function Kt(t){return et("exp",t)}function Vt(t){return et("floor",t)}function Gt(t){return et("fract",t)}function Ht(t){return et("length",t,A)}function Xt(t){return et("log",t)}function qt(t){return et("log2",t)}function Yt(t,e){return rt("max",t,e)}function Wt(t,e){return rt("min",t,e)}function Zt(t,e,r){return nt("mix",t,e,r)}function Qt(t,e){return rt("mod",t,e)}function Jt(t){return et("normalize",t)}function te(t){return"bool"===t.type?et("!",t):et("not",t)}function ee(t,e){return rt("pow",t,e)}function re(t){return et("round",t)}function ne(t){return et("sign",t)}function ie(t){return et("sin",t)}function se(t){return et("sinh",t)}function oe(t,e,r){return nt("smoothstep",t,e,r)}function ae(t){return et("sqrt",t)}function ce(t,e){return rt("step",t,e,e.constructor)}function ue(t){return et("tan",t)}function he(t){return et("tanh",t)}function le(t,e,r){return nt("texelFetch",t,e,r,I)}function de(t,e){return rt("texture",t,e,I)}function pe(t,e){const{initialValue:r,xRange:n,yRange:i,callback:s}=e,[o,a]=n,[c,u]=i,h=new L(0).setMutable().setDebugName("iterX"),l=new L(0).setMutable().setDebugName("iterY"),d=r.setMutable().setDebugName("accumulator"),p=s(d,t.get(h,l),h,l).setDebugName("callback"),f=st({iterX:h,iterY:l,accumulator:d},r.constructor,p,t=>{let{out:e,iterX:r,iterY:n,accumulator:i,subgraph:s}=t;return`\nfor (${n} = ${c}; ${n} < ${u}; ${n}++) {\n  for (${r} = ${o}; ${r} < ${a}; ${r}++) {\n\n  ${s.body}\n\n  ${i} = ${s.varName};\n  }\n}\n${e} = ${i};\n`}).setDebugName("reduce2DBody");return f}},62881:(t,e,r)=>{r.d(e,{l:()=>a});var n=r(81806),i=r(93345),s=r(88800);const o=!!(0,n.A)("esri-tests-disable-gpu-memory-measurements");class a{constructor(t,e){this._context=t,this._descriptor=e,this.type=2,this._context.instanceCounter.increment(i.vt.Renderbuffer,this);const r=this._context.gl;this.glName=r.createRenderbuffer(),this._context.bindRenderbuffer(this);const{width:n,height:s,internalFormat:o,multisampled:a}=e;a?r.renderbufferStorageMultisample(r.RENDERBUFFER,this.samples,o,n,s):r.renderbufferStorage(r.RENDERBUFFER,o,n,s),this._context.bindRenderbuffer(null)}get descriptor(){return this._descriptor}get samples(){const t=this._descriptor.samples,e=this._context.parameters.maxSamples;return t?Math.min(t,e):e}get usedMemory(){return o?0:(0,s.e)(this._descriptor)}resize(t,e){const r=this._descriptor;if(r.width===t&&r.height===e)return;r.width=t,r.height=e;const n=this._context.gl;this._context.bindRenderbuffer(this),r.multisampled?n.renderbufferStorageMultisample(n.RENDERBUFFER,this.samples,r.internalFormat,r.width,r.height):n.renderbufferStorage(n.RENDERBUFFER,r.internalFormat,r.width,r.height),this._context.bindRenderbuffer(null)}dispose(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(i.vt.Renderbuffer,this),this._context=null)}}},70479:(t,e,r)=>{r.d(e,{j:()=>n});class n{constructor(){this.drawPhase=89}startup(){}shutdown(t){}}},78492:(t,e,r)=>{r.d(e,{K:()=>d});var n=r(50076),i=r(76460),s=r(30726),o=r(48611),a=(r(76718),r(12331),r(44488)),c=(r(81806),r(62881),r(80895)),u=(r(93345),r(61678),r(96673));function h(t,e,r){const n=new u.R(e.width,e.height);return n.dataType=e.dataType,e.depth&&(n.depth=e.depth),e.flipped&&(n.flipped=e.flipped),e.hasMipmap&&(n.hasMipmap=e.hasMipmap),n.internalFormat=e.internalFormat,e.isImmutable&&(n.isImmutable=e.isImmutable),e.isOpaque&&(n.isOpaque=e.isOpaque),e.maxAnisotropy&&(n.maxAnisotropy=e.maxAnisotropy),n.pixelFormat=e.pixelFormat,e.preMultiplyAlpha&&(n.preMultiplyAlpha=e.preMultiplyAlpha),e.samplingMode&&(n.samplingMode=e.samplingMode),e.target&&(n.target=e.target),n.uniform=e.uniform,e.unpackAlignment&&(n.unpackAlignment=e.unpackAlignment),e.wrapMode&&(n.wrapMode=e.wrapMode),new c.g(t,n,r)}function l(t,e,r){const s=e.length;if(s!==r){const o=new n.A("Invalid Uniform",`Invalid length, expected ${r} but got ${s}`,{uniformName:t,values:e});i.A.getLogger("esri.views.2d.engine.webgl.shaderGraph.typed.TypedShaderProgram").errorOnce(o)}}class d{constructor(t,e,r,n,i){this.vertexShader=t,this.fragmentShader=e,this._locations=r,this._uniformBindings=n,this._transformFeedbackBindings=i,this._vao=null,this._temporaryTextures=[]}destroy(){this._program=(0,s.WD)(this._program),this.cleanupTemporaryTextures()}setUniforms(t){this._uniforms=t}cleanupTemporaryTextures(){for(const t of this._temporaryTextures)t.dispose();this._temporaryTextures=[]}bind(t){const e=this._uniforms;if(!this._program){const e=[];for(const t of this._transformFeedbackBindings??[]){const{index:r,propertyKey:n}=t;e[r]=`v_${n}`}this._program=new a.B(t,this.vertexShader,this.fragmentShader,this._locations,new Map,e)}const r=this._program;t.useProgram(r);for(const n of this._uniformBindings){const{shaderModulePath:i,uniformName:s,uniformType:a,uniformArrayLength:c}=n,u=(0,o.wc)(i,e);if(null==u){if("sampler2D"===a)continue;throw new Error(`Failed to find uniform value for ${i}`)}switch("array"===a||"array-2d"===a?n.uniformArrayElementType:a){case"sampler2D":{const{unit:e,texture:n}=u;if(r.setUniform1i(s,e),"type"in n)t.bindTexture(n,e);else{const r=h(t,n.descriptor,n.data);t.bindTexture(r,e)}break}case"int":if(!c){r.setUniform1i(s,u);break}l(n.uniformName,u,c),r.setUniform1iv(s,u);break;case"float":if(!c){r.setUniform1f(s,u);break}l(n.uniformName,u,c),r.setUniform1fv(s,u);break;case"vec2":if(!c){r.setUniform2f(s,u[0],u[1]);break}l(n.uniformName,u,c),r.setUniform2fv(s,u.flat());break;case"vec3":if(!c){r.setUniform3f(s,u[0],u[1],u[2]);break}l(n.uniformName,u,c),r.setUniform3fv(s,u.flat());break;case"vec4":if(!c){r.setUniform4f(s,u[0],u[1],u[2],u[3]);break}l(n.uniformName,u,c),r.setUniform4fv(s,u.flat());break;case"mat3":r.setUniformMatrix3fv(s,u);break;case"mat4":r.setUniformMatrix4fv(s,u);break;default:throw new Error(`Unable to set uniform for type ${a}`)}}}}},88800:(t,e,r)=>{r.d(e,{e:()=>s,q:()=>i});var n=r(27207);class i{constructor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;this.internalFormat=t,this.width=e,this.height=r,this.multisampled=n,this.samples=i}}function s(t){return t.width<=0||t.height<=0||null==t.internalFormat?0:t.width*t.height*(0,n.MW)(t.internalFormat)}}}]);
//# sourceMappingURL=2117.e876b58d.chunk.js.map