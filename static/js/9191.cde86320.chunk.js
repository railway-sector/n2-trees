"use strict";(self.webpackChunkn2_trees=self.webpackChunkn2_trees||[]).push([[4429,7995,9191],{19208:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(6326),i=s(42553),n=s(46053),o=(s(81806),s(76460),s(47249),s(87990));let l=class extends i.o{constructor(e){super(e),this.type="wkb",this.primaryFieldName=null}};(0,r.Cg)([(0,n.MZ)({type:["wkb"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),(0,r.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"orientation",void 0),(0,r.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"primaryFieldName",void 0),l=(0,r.Cg)([(0,o.$)("esri.layers.support.ParquetEncodingWkb")],l)},20176:(e,t,s)=>{s.d(t,{N3:()=>l,Om:()=>o});var r=s(97255),i=s(90321),n=s(1484);class o{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;this.geometry=e,this.attributes=t,this.centroid=s,this.objectId=r,this.displayId=i}static fromJSON(e){const t=e.geometry?n.A.fromJSON(e.geometry):null,s=e.centroid?n.A.fromJSON(e.centroid):null,r=e.objectId;return new o(t,e.attributes,s,r)}weakClone(){const e=new o(this.geometry,this.attributes,this.centroid,this.objectId);return e.displayId=this.displayId,e}clone(){const e=this.geometry?.clone(),t=new o(e,{...this.attributes},this.centroid?.clone(),this.objectId);return t.displayId=this.displayId,t}ensureCentroid(e){return this.centroid??=(0,i.Q)(new n.A,this.geometry,e.hasZ,e.hasM),this.centroid}get usedMemory(){return 128+(0,r.lM)(this.attributes)+(this.geometry?.usedMemory??0)}}function l(e){return!!e.geometry?.coords?.length}},30178:(e,t,s)=>{s.d(t,{hG:()=>h,nc:()=>f,sA:()=>d});s(19276);var r=s(50076),i=s(45802),n=s(13312),o=s(44135),l=s(36035),u=s(98141),a=s(19208),c=s(67103);const p=new i.J({esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint"});function d(e){return p.toJSON(e)}function h(e){return p.fromJSON(e)}async function f(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e.geometryType&&e.spatialReference&&e.encoding&&e.fields)return e;if(e.urls.length<1)throw new r.A("parquet:bad-input","At least one url must be specified",e);const s=await(0,c.DV)(e.urls.getItemAt(0),{getCustomParameters:()=>t.customParameters}),i=(0,c.hD)(s),p={...e,file:s};null==p.fields&&(p.fields=s.fields().map(e=>o.A.fromJSON({name:e.name,type:e.type}))),null==p.encoding&&(p.encoding=function(e,t){if(null!=e){const t=e.primary_column,s=e.columns[t];return new a.A({primaryFieldName:t,orientation:s.orientation??null})}const s=(0,l.i_)(t.map(e=>e.name));return s.latitudeFieldName&&s.latitudeFieldName?new u.A({latitudeFieldName:s.latitudeFieldName,longitudeFieldName:s.longitudeFieldName}):null}(i,p.fields));const d=(0,c.Hj)(s);if(d)switch(d.mode){case"z":p.displayOptimization={mode:"z"};break;case"xz":{const e=d.multiscale;if(!e)throw new r.A("bad-format","XZ display optimization requires multiscale geometries");p.displayOptimization={mode:"xz",multiscale:e};break}}if(!p.encoding)return p;switch(p.encoding.type){case"location":null==p.spatialReference&&(p.spatialReference=n.A.WGS84),null==p.geometryType&&(p.geometryType="point");break;case"wkb":{if(!i)return p;const e=i.primary_column,t=i.columns[e];if(p.geometryType||(p.geometryType=function(e){const{geometry_types:t}=e,s=new Set;for(const r of t){const e=m(r);e&&s.add(e)}if(s.size>1)throw new r.A("unsupported","Parquet mixed geometry types are not support",{geometryTypes:s});return 1===s.size?s.values().next().value:void 0}(t)),p.spatialReference||(p.spatialReference=function(e){const t=e.crs?.id?.code;return t&&"number"==typeof t?new n.A({wkid:t}):void 0}(t)),p.fields)for(const s of Object.keys(i.columns))p.fields=p.fields.filter(e=>e.name!==s)}}return p}function m(e){switch(e){case"Point":return"point";case"Polygon":case"MultiPolygon":return"polygon";case"LineString":return"polyline";case"MultiPoint":return"multipoint";default:return null}}},34429:(e,t,s)=>{s.d(t,{QueueProcessor:()=>c});var r=s(30726),i=s(50346),n=s(59649),o=s(67993),l=s(52394),u=s(75540);class a{constructor(e,t){this.item=e,this.controller=t,this.promise=null}}class c{constructor(e){this._schedule=null,this._deferreds=new o.A,this._controllers=new o.A,this._processingItems=new o.A,this._pausedSignal=(0,u.v)(!1),this.concurrency=1,e.concurrency&&(this.concurrency=e.concurrency),this._queue=new n.A(e.peeker),this.process=e.process}destroy(){this.clear(),this._schedule=(0,r.xt)(this._schedule)}get updating(){return this.running}get length(){return this._processingItems.size+this._queue.length}get running(){return!this._pausedSignal.value&&this._queue.length>0&&this._processingItems.size<this.concurrency}abort(e){const t=this._controllers.get(e);t&&t.abort()}clear(){this._queue.clear();const e=[];this._controllers.forEach(t=>e.push(t)),this._controllers.clear(),e.forEach(e=>e.abort()),this._processingItems.clear(),this._cancelNext()}forEach(e){this._deferreds.forEach((t,s)=>e(s))}get(e){const t=this._deferreds.get(e);return t?t.promise:void 0}isOngoing(e){return this._processingItems.has(e)}has(e){return this._deferreds.has(e)}pause(){this._pausedSignal.value||(this._pausedSignal.value=!0,this._cancelNext())}push(e,t){const s=this.get(e);if(s)return s;const r=new AbortController;let n=null;t&&(n=(0,i.u7)(t,()=>r.abort()));const o=()=>{l.remove(),null!=n&&n.remove(),this._removeItem(e),this._queue.remove(e),this._scheduleNext()},l=(0,i.NY)(r.signal,()=>{const t=this._processingItems.get(e);t&&t.controller.abort(),o(),u.reject((0,i.NK)())}),u=(0,i.Tw)();return this._deferreds.set(e,u),this._controllers.set(e,r),u.promise.then(o,o),this._queue.push(e),this._scheduleNext(),u.promise}last(){return this._queue.last()}lastPromise(){const e=this.last();return e?this.get(e):null}peek(){return this._queue.peek()}popLast(){const e=this._queue.popLast();return e&&(this._deferreds.get(e)?.reject((0,i.NK)()),this._removeItem(e)),e}reset(){const e=Array.from(this._processingItems.values());this._processingItems.clear();for(const t of e)this._queue.push(t.item),t.controller.abort();this._scheduleNext()}resume(){this._pausedSignal.value&&(this._pausedSignal.value=!1,this._scheduleNext())}takeAll(){const e=[];for(;this._queue.length;)e.push(this._queue.pop());return this.clear(),e}_removeItem(e){this._deferreds.delete(e),this._controllers.delete(e),this._processingItems.delete(e)}_scheduleNext(){this._pausedSignal.value||this._schedule||(this._schedule=(0,l._)(()=>{this._schedule=null,this._next()}))}_next(){for(;this._queue.length>0&&this._processingItems.size<this.concurrency;)this._process(this._queue.pop())}_cancelNext(){this._schedule&&(this._schedule.remove(),this._schedule=null)}_processResult(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).resolve(t))}_processError(e,t){this._canProcessFulfillment(e)&&(this._scheduleNext(),this._deferreds.get(e.item).reject(t))}_canProcessFulfillment(e){return!!this._deferreds.get(e.item)&&this._processingItems.get(e.item)===e}_process(e){if(null==e)return;let t;const s=new AbortController,r=new a(e,s);this._processingItems.set(e,r);try{t=this.process(e,s.signal)}catch(n){this._processError(r,n)}(0,i.$X)(t)?(r.promise=t,t.then(e=>this._processResult(r,e),e=>this._processError(r,e))):this._processResult(r,t)}}},36035:(e,t,s)=>{s.d(t,{i_:()=>i});var r=s(53430);function i(e,t,s){t=(0,r.rS)(t)?.toLowerCase(),s=(0,r.rS)(s)?.toLowerCase();const i=e.map(e=>e.toLowerCase()),l=t?e[i.indexOf(t)]:null,u=s?e[i.indexOf(s)]:null;return{longitudeFieldName:l||e[i.indexOf(o.find(e=>i.includes(e)))],latitudeFieldName:u||e[i.indexOf(n.find(e=>i.includes(e)))]}}const n=["lat","lat83","latitude","latitude83","latdecdeg","lat_dd","y","ycenter","point_y"],o=["lon","lng","lng83","long","long83","longitude","longitude83","longdecdeg","long_dd","x","xcenter","point_x"]},75146:(e,t,s)=>{s.d(t,{A:()=>r});class r{constructor(){this.globalIdFieldName=null,this.geohashFieldName=null,this.geometryProperties=null,this.geometryType=null,this.spatialReference=null,this.hasZ=!1,this.hasM=!1,this.features=[],this.fields=[],this.transform=null,this.exceededTransferLimit=!1,this.uniqueIdField=null,this.queryGeometryType=null,this.queryGeometry=null}weakClone(){const e=new r;return e.globalIdFieldName=this.globalIdFieldName,e.geohashFieldName=this.geohashFieldName,e.geometryProperties=this.geometryProperties,e.geometryType=this.geometryType,e.spatialReference=this.spatialReference,e.hasZ=this.hasZ,e.hasM=this.hasM,e.features=this.features,e.fields=this.fields,e.transform=this.transform,e.exceededTransferLimit=this.exceededTransferLimit,e.uniqueIdField=this.uniqueIdField,e.queryGeometry=this.queryGeometry,e.queryGeometryType=this.queryGeometryType,e}}},77408:(e,t,s)=>{s.d(t,{h:()=>o,i:()=>n});var r=s(13312),i=s(1900);class n{static minimal(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return new n({geometryType:e,fieldsIndex:new i.A(s).toJSON(),featureIdInfo:{type:"object-id",fieldName:t},subtypes:null,subtypeField:null,types:null,globalIdField:null,spatialReference:null,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null,typeIdField:null})}static createFeature(e){return new n(e)}constructor(e){let t;this._options=e,this._fieldsIndex=i.A.fromJSON(e.fieldsIndex),e.spatialReference&&(e.spatialReference instanceof r.A?this._spatialReference=e.spatialReference:this._spatialReference=r.A.fromJSON(e.spatialReference)),e.outSpatialReference&&(e.outSpatialReference instanceof r.A?this._outSpatialReference=e.outSpatialReference:this._outSpatialReference=r.A.fromJSON(e.outSpatialReference)),"object-id"===e.featureIdInfo.type&&(t=e.featureIdInfo.fieldName),this._arcadeSchema={fields:this.fieldsIndex.fields,fieldsIndex:this.fieldsIndex,geometryType:this.geometryType,objectIdField:t,globalIdField:this._options.globalIdField,spatialReference:this._spatialReference,timeInfo:this._options.timeInfo,typeIdField:this._options.typeIdField??void 0,types:this._options.types??void 0,subtypeField:this._options.subtypeField,subtypes:this._options.subtypes??void 0,datesInUnknownTimezone:this._options.timeReferenceUnknownClient??void 0,dateFieldsTimeZone:this._options.dateFieldsTimeZone??void 0}}get fieldsIndex(){return this._fieldsIndex}get geometryType(){return"esriGeometryMultiPatch"===this._options.geometryType?"esriGeometryPolygon":this._options.geometryType}get serviceGeometryType(){return this._options.geometryType}get subtypeField(){return this._options.subtypeField}get timeInfo(){return this._options.timeInfo}get featureIdInfo(){return this._options.featureIdInfo}get globalIdField(){return this._options.globalIdField}get arcadeSchema(){return this._arcadeSchema}get spatialReference(){return this._spatialReference}get outSpatialReference(){return this._outSpatialReference}get timeReferenceUnknownClient(){return this._options.timeReferenceUnknownClient}weakCloneWithAdditionalFields(e){return new n({fieldsIndex:{fields:[...this._fieldsIndex.fields,...e],timeZoneByFieldName:null},geometryType:this.geometryType,globalIdField:this.globalIdField,featureIdInfo:this.featureIdInfo,spatialReference:this.spatialReference,outSpatialReference:this.outSpatialReference,subtypeField:this.subtypeField,subtypes:this._options.subtypes,timeInfo:this.timeInfo,timeReferenceUnknownClient:this.timeReferenceUnknownClient,dateFieldsTimeZone:this._options.dateFieldsTimeZone,typeIdField:this._options.typeIdField,types:this._options.types})}}class o extends n{static createGraphics(e){return new o({fieldsIndex:(new i.A).toJSON(),featureIdInfo:{type:"object-id",fieldName:"uid"},geometryType:null,spatialReference:e,outSpatialReference:e,globalIdField:null,subtypeField:null,subtypes:null,timeInfo:null,typeIdField:null,types:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null})}}},90321:(e,t,s)=>{function r(e,t){return e?t?4:3:t?3:2}function i(e,t,s,i){if(!t?.lengths.length)return null;e.lengths.length&&(e.lengths.length=0),e.coords.length&&(e.coords.length=0);const l=e.coords,u=[],a=s?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:c,coords:p}=t,d=r(s,i);let h=0;for(const r of c){const e=n(a,p,h,r,s,i);e&&u.push(e),h+=r*d}if(u.sort((e,t)=>{let r=e[2]-t[2];return 0===r&&s&&(r=e[4]-t[4]),r}),u.length){let e=6*u[0][2];l[0]=u[0][0]/e,l[1]=u[0][1]/e,s&&(e=6*u[0][4],l[2]=0!==e?u[0][3]/e:0),(l[0]<a[0]||l[0]>a[1]||l[1]<a[2]||l[1]>a[3]||s&&(l[2]<a[4]||l[2]>a[5]))&&(l.length=0)}if(!l.length){const e=t.lengths[0]?o(p,0,c[0],s,i):null;if(!e)return null;l[0]=e[0],l[1]=e[1],s&&e.length>2&&(l[2]=e[2])}return e}function n(e,t,s,i,n,o){const l=r(n,o);let u=s,a=s+l,c=0,p=0,d=0,h=0,f=0;for(let r=0,y=i-1;r<y;r++,u+=l,a+=l){const s=t[u],r=t[u+1],i=t[u+2],o=t[a],l=t[a+1],m=t[a+2];let y=s*l-o*r;h+=y,c+=(s+o)*y,p+=(r+l)*y,n&&(y=s*m-o*i,d+=(i+m)*y,f+=y),s<e[0]&&(e[0]=s),s>e[1]&&(e[1]=s),r<e[2]&&(e[2]=r),r>e[3]&&(e[3]=r),n&&(i<e[4]&&(e[4]=i),i>e[5]&&(e[5]=i))}if(h>0&&(h*=-1),f>0&&(f*=-1),!h)return null;const m=[c,p,.5*h];return n&&(m[3]=d,m[4]=.5*f),m}function o(e,t,s,i,n){const o=r(i,n);let p=t,d=t+o,h=0,f=0,m=0,y=0;for(let r=0,g=s-1;r<g;r++,p+=o,d+=o){const t=e[p],s=e[p+1],r=e[p+2],n=e[d],o=e[d+1],g=e[d+2],_=i?u(t,s,r,n,o,g):l(t,s,n,o);if(_)if(h+=_,i){const e=c(t,s,r,n,o,g);f+=_*e[0],m+=_*e[1],y+=_*e[2]}else{const e=a(t,s,n,o);f+=_*e[0],m+=_*e[1]}}return h>0?i?[f/h,m/h,y/h]:[f/h,m/h]:s>0?i?[e[t],e[t+1],e[t+2]]:[e[t],e[t+1]]:null}function l(e,t,s,r){const i=s-e,n=r-t;return Math.sqrt(i*i+n*n)}function u(e,t,s,r,i,n){const o=r-e,l=i-t,u=n-s;return Math.sqrt(o*o+l*l+u*u)}function a(e,t,s,r){return[e+.5*(s-e),t+.5*(r-t)]}function c(e,t,s,r,i,n){return[e+.5*(r-e),t+.5*(i-t),s+.5*(n-s)]}s.d(t,{Q:()=>i})},95341:(e,t,s)=>{s.r(t),s.d(t,{default:()=>C});var r=s(6326),i=s(19276),n=s(4212),o=s(50076),l=s(81806),u=s(76460),a=s(34429),c=s(13312),p=s(42294),d=s(12034),h=s(9345),f=s(40296),m=s(44135),y=s(1900),g=s(53430),_=s(98141),I=s(19208);function w(e){switch(e.type){case"wkb":return I.A.fromJSON(e);case"location":return _.A.fromJSON(e)}}var F=s(30178),b=s(67103),R=s(77859),x=s(61137),N=s(21666),S=s(77408),v=s(27428);const A=new R.Z,T=8e3,q="__OBJECTID";class C{constructor(){this._fileInfos=new Map,this._queue=new a.QueueProcessor({concurrency:4,process:(e,t)=>this._executeQuery(e,t)})}async load(e){const t=e.spatialReference?c.A.fromJSON(e.spatialReference):void 0;if(t&&!t.isWGS84&&!t.isWebMercator)throw new o.A("parquet:unsupported-projection","Only WGS84 and Web Mercator are supported");const s=await(0,F.nc)({urls:new i.A(e.urls),fields:e.fields?.map(e=>m.A.fromJSON(e)),encoding:e.encoding?w(e.encoding):e.encoding,geometryType:e.geometryType?(0,F.hG)(e.geometryType):null,spatialReference:t},{customParameters:e.customParameters});let n;if(s.geometryType&&s.encoding){if(!s.spatialReference)throw new o.A("parquet:unsupported","SpatialReference must be defined");if(!s.spatialReference.isGeographic&&!s.spatialReference.isWebMercator)throw new o.A("parquet:unsupported-projection","Only WGS84 and Web Mercator are supported");s.spatialReference.isGeographic&&!s.spatialReference.isWGS84&&(u.A.getLogger("parquet:unsupported-projection").warn("Found a geographic projection that is not WGS84. Handling as WGS84.",{spatialReference:s.spatialReference}),s.spatialReference=c.A.WGS84),n={geometryType:(0,F.sA)(s.geometryType),spatialReference:s.spatialReference.toJSON(),encoding:s.encoding.toJSON(),displayOptimization:s.displayOptimization}}this.setCustomParameters(e.customParameters),this._geometryInfo=n;const l=e.urls;for(const r of l){const e=await(0,b.DV)(r,{geometryInfo:n,outSpatialReference:null,getCustomParameters:()=>this._customParameters});this._fileInfos.set(r,{index:this._fileInfos.size,file:e})}this._capabilities=E(await this.getFileStatistics());const a=this._fileInfos.values().next().value?.file;if(!a)return{layerDefinition:{},capabilities:E(null)};const{fields:d}=s;if(null==d)throw new o.A("parquet-layer:missing-metadata","Unable to create parquet source: cannot infer fields",d);d.push(new m.A({name:q,type:"oid",alias:q}));const h={fields:d.map(e=>({...e.toJSON(),column:a.columnForFieldName(e.name)})),timeZoneByFieldName:null},g=y.A.fromJSON(h);this._fieldsIndex=g;const _=(0,F.sA)(s.geometryType??"point");if(this._metadata=S.i.createFeature({fieldsIndex:h,geometryType:_,featureIdInfo:{type:"object-id",fieldName:"rowId"},subtypes:null,subtypeField:null,types:null,typeIdField:null,globalIdField:null,spatialReference:s.spatialReference,outSpatialReference:null,timeInfo:null,timeReferenceUnknownClient:null,dateFieldsTimeZone:null}),this._queryEngineParams={fieldsIndex:this._metadata.fieldsIndex,geometryType:n?.geometryType??"esriGeometryPoint",featureIdInfo:{type:"object-id",fieldName:"rowId"},hasM:!1,hasZ:!1,spatialReference:n?.spatialReference??{wkid:4326},aggregateAdapter:null,timeInfo:null,definitionExpression:null},s.spatialReference&&(this._fullExtent=function(e,t){const s=(0,p.hZ)((0,p.vt)(),p.qv);for(const r of e){const e=(0,b.hD)(r.file);if(!e)return null;const t=e.columns[e.primary_column];if(!t.bbox)return null;const i=G(t.bbox);(0,p.RF)(s,i)}return{xmin:s[0],ymin:s[1],xmax:s[3],ymax:s[4],spatialReference:t}}(this._fileInfos.values(),s.spatialReference.toJSON())),null==this._fullExtent&&"location"===s.encoding?.type){const{latitudeFieldName:e,longitudeFieldName:t}=s.encoding,i=this._fieldsIndex.get(e)?.column,n=this._fieldsIndex.get(t)?.column,o=(0,p.hZ)((0,p.vt)(),p.qv);for(const s of this._fileInfos.values())for(const e of s.file.rowGroups()){const t={stack:[],error:void 0,hasError:!1};try{const s=(0,r.mS)(t,e.columnDescriptorForAttribute(i),!1),l=(0,r.mS)(t,e.columnDescriptorForAttribute(n),!1),u=[l.minValue(),s.minValue(),l.maxValue(),s.maxValue()];(0,p.DC)(o,u),e.free()}catch(I){t.error=I,t.hasError=!0}finally{(0,r.hk)(t)}}this._fullExtent={xmin:o[0],ymin:o[1],xmax:o[3],ymax:o[4],spatialReference:s.spatialReference?.toJSON()}}return{capabilities:this._capabilities,layerDefinition:{fields:s.fields?.map(e=>e.toJSON()),drawingInfo:(0,f.F0)(_),extent:this._fullExtent??void 0,geometryType:_,encoding:s.encoding?.toJSON(),displayOptimization:s.displayOptimization}}}destroy(){for(const e of this._fileInfos.values())e.file.free();this._fileInfos.clear(),this._queue.destroy()}setCustomParameters(e){this._customParameters=e}getFileStatistics(){if(!this._fileInfos.size)return null;const e=Array.from(this._fileInfos.values()).reduce((e,t)=>e+t.file.byteLength(),0);return{featureCount:this._getFeatureCount(),byteLength:e}}async updateFiles(e){const t=new Set(e);for(const[s,r]of this._fileInfos.entries())t.has(s)?t.delete(s):(r.file.free(),this._fileInfos.delete(s));for(const s of t){const e=await(0,b.DV)(s,{geometryInfo:this._geometryInfo,outSpatialReference:null,getCustomParameters:()=>this._customParameters});this._fileInfos.set(s,{index:this._fileInfos.size,file:e})}}async queryFeatures(e,t){return this._validateQuery(e),function(e){return!!(e.objectIds?.length||e.outStatistics||e.orderByFields?.length||e.returnDistinctValues)}(e)||(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=e.resultOffset??0),(e.outStatistics||e.returnDistinctValues)&&delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponse()}async queryFeatureCount(e,t){return this._validateQuery(e),O(e)?(delete e.outFields,delete e.returnGeometry,(await this._enqueueQuery(e,t)).createQueryResponseForCount()):this._getFeatureCount()}async queryObjectIds(e,t){return this._validateQuery(e),O(e)?(e.resultRecordCount=e.resultRecordCount?Math.min(e.resultRecordCount,8e3):8e3,e.resultOffset=e.resultOffset??0,delete e.returnGeometry,delete e.outFields,(await this._enqueueQuery(e,t)).items.map(e=>e.getObjectId())):Array.from({length:this._getFeatureCount()},(e,t)=>t)}async queryExtent(e,t){if(this._validateQuery(e),this._fullExtent&&!O(e))return{count:this._getFeatureCount(),extent:this._fullExtent};const s=(0,n.zI)(this._metadata.spatialReference);e.returnGeometry=!0,delete e.outFields;const r=(0,p.hZ)((0,p.vt)(),p.qv),i=(0,p.vt)(),o=await this._enqueueQuery(e,t);let l=0;for(const n of o.items)n.getBounds(i)&&((0,p.RF)(r,i),l+=1);return{count:l,extent:(0,d.Wc)(r,s,e.outSR?(0,n.zI)(e.outSR):s,s,!1)}}_getFeatureCount(){return Array.from(this._fileInfos.values()).reduce((e,t)=>e+t.file.numRows(),0)}_validateQuery(e){if(!this._capabilities.query.supportsStatistics&&e.outStatistics)throw new o.A("parquet:unsupported","Statistics queries are not supported",{query:e});if(!this._capabilities.query.supportsOrderBy&&e.orderByFields?.length)throw new o.A("parquet:unsupported","Queries using orderBy are not supported",{query:e});if(!this._capabilities.query.supportsDistinct&&e.returnDistinctValues)throw new o.A("parquet:unsupported","Queries using returnDistinctValues are not supported",{query:e})}async*_fetchChunks(e,t){for(const s of this._fileInfos.values()){const r=s.file.numRows(),i=Math.ceil(r/T);for(let n=0;n<i;n++){const r=n*T,i=await s.file.readChunk(r,T,e.fields,e.returnGeometry,t);for(const e of i){const t=new v.s(this._metadata,this._fieldsIndex,e,0,s.index),r=P([new x.j(t,null,0,!1)],this._queryEngineParams);yield r}}}}_enqueueQuery(e,t){return this._queue.push(e,t)}async _executeQuery(e,t){const s=await this._getReadParams(e);if(e.objectIds?.length)for(const o of this._fileInfos.values()){const r=[],i=P((await o.file.readChunksByRowId(new Uint32Array(e.objectIds),s.fields,s.returnGeometry,t)).map((e,t)=>new v.s(this._metadata,this._fieldsIndex,e,t,o.index)).map((e,t)=>new x.j(e,null,t,!1)),this._queryEngineParams),n=await i.executeQueryForOpaqueFeatures(e,t);for(const e of n)r.push(e);return new h.G(r,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:A})}let r=e.resultRecordCount??this._getFeatureCount(),i=e.resultOffset??0;delete e.resultRecordCount,delete e.resultOffset;const n=[];for await(const o of this._fetchChunks(s,t)){const s=await o.executeQueryForOpaqueFeatures(e,t);if(s.length>i){const t=s.slice(i,Math.min(i+r,s.length));for(const e of t)n.push(e);if(i=0,r-=t.length,0===r)return new h.G(n,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:A})}else i-=s.length}return new h.G(n,e,{fieldsIndex:this._fieldsIndex,geometryType:this._metadata.geometryType,spatialReference:this._queryEngineParams.spatialReference,objectIdField:"rowId",hasM:!1,hasZ:!1,featureAdapter:A})}async _getReadParams(e){const t=new Set;if(e.where&&await(0,g.hz)(t,this._fieldsIndex,e.where),e.outStatistics)for(const s of e.outStatistics)null!=s.onStatisticField&&t.add(s.onStatisticField);if(e.outFields)for(const s of e.outFields)t.add(s);return{fields:this._getAttributeIds(Array.from(t)),returnGeometry:!!e.returnGeometry||!!e.geometry}}_getAttributeIds(e){if(null==e)return new Uint32Array;if(e.includes("*"))return new Uint32Array(this._fieldsIndex.fields.map(e=>e.column).filter(e=>null!=e));const t=[];for(const s of e){const e=this._fieldsIndex.get(s);if(null==e)throw new o.A("unknown-field",`Field ${s} does not exist`);null==e.column||t.push(e.column)}return new Uint32Array(t)}}function O(e){return Object.keys(e).some(e=>function(e){switch(e){case"resultOffset":case"resultRecordCount":case"aggregateIds":case"distance":case"gdbVersion":case"geometry":case"having":case"timeExtent":case"where":case"objectIds":case"historicMoment":return!0;default:return!1}}(e))}function P(e,t){const s=new N.I;for(const r of e)s.insert(r);return new d.do({...t,featureStore:s})}function G(e){switch(e.length){case 4:return(0,p.Jt)((0,p.vt)(),e);case 6:return e;default:throw new o.A("parquet:protocol-violation","Invalid Geoparquet file. BoundingBox size must be 4 or 6.",{bbox:e})}}function E(e){const t=e?.featureCount;let s=!1;return null!=t&&t<(0,l.A)("parquetlayer-full-query-feature-count")&&(s=!0),{analytics:{supportsCacheHint:!1},attachment:null,data:{isVersioned:!1,isBranchVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!0,supportsQueryBins:!1,supportsQueryPivot:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1,supportsAsyncConvert3D:!1},query:{maxRecordCount:8e3,maxRecordCountFactor:void 0,maxUniqueIDCount:void 0,standardMaxRecordCount:void 0,supportsCacheHint:!1,supportsCentroid:!0,supportsCentroidOnDegeneratedQuantizedGeometry:!1,supportsCurrentUser:!1,supportsDegeneratedQuantizedGeometry:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:s,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:s,supportsPagination:!0,supportsPaginationOnAggregatedQueries:!1,supportsPercentileStatistics:!1,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryByAnonymous:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsReturnMesh:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsStatistics:s,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsCompactGeometry:!1,supportsSqlExpression:!1,supportsTrueCurve:!1,tileMaxRecordCount:void 0},queryAttributeBins:{supportsDate:!1,supportsFixedInterval:!1,supportsAutoInterval:!1,supportsFixedBoundaries:!1,supportsStackBy:!1,supportsSplitBy:!1,supportsSnapToData:!1,supportsReturnFullIntervalBin:!1,supportsFirstDayOfWeek:!1,supportsNormalization:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUploadWithItemId:!1,supportsUpdateWithoutM:!1,supportsAsyncApplyEdits:!1,zDefault:void 0}}}},98141:(e,t,s)=>{s.d(t,{A:()=>l});var r=s(6326),i=s(42553),n=s(46053),o=(s(81806),s(76460),s(47249),s(87990));let l=class extends i.o{constructor(e){super(e),this.type="location",this.latitudeFieldName=null,this.longitudeFieldName=null}};(0,r.Cg)([(0,n.MZ)({type:["location"],readOnly:!0,json:{write:!0}})],l.prototype,"type",void 0),(0,r.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"latitudeFieldName",void 0),(0,r.Cg)([(0,n.MZ)({json:{write:!0}})],l.prototype,"longitudeFieldName",void 0),l=(0,r.Cg)([(0,o.$)("esri.layers.support.ParquetEncodingLocation")],l)}}]);
//# sourceMappingURL=9191.cde86320.chunk.js.map